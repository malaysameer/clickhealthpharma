2025-06-01 00:09:03 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 00:09:03 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 00:09:03 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 00:09:17 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 00:09:17 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 12625 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 00:09:17 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 00:09:18 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 00:09:18 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 85 ms. Found 6 JPA repository interfaces.
2025-06-01 00:09:19 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 00:09:19 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 00:09:19 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 00:09:19 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 00:09:19 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 00:09:19 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1749 ms
2025-06-01 00:09:19 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 00:09:19 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 9651b1f4-d5a8-4878-ac35-3ff7ea2b07a5
2025-06-01 00:09:19 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 00:09:19 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flyway' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Unsupported Database: Microsoft SQL Server 16.0
2025-06-01 00:09:19 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 00:09:19 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 00:09:19 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 00:09:19 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 00:09:19 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flyway' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Unsupported Database: Microsoft SQL Server 16.0
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:648)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:636)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1335)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1165)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.flywaydb.core.Flyway]: Factory method 'flyway' threw exception with message: Unsupported Database: Microsoft SQL Server 16.0
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:177)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:644)
	... 28 common frames omitted
Caused by: org.flywaydb.core.api.FlywayException: Unsupported Database: Microsoft SQL Server 16.0
	at org.flywaydb.core.internal.database.DatabaseTypeRegister.getDatabaseTypeForConnection(DatabaseTypeRegister.java:105)
	at org.flywaydb.core.api.configuration.ClassicConfiguration.setDataSource(ClassicConfiguration.java:1095)
	at org.flywaydb.core.api.configuration.FluentConfiguration.dataSource(FluentConfiguration.java:624)
	at org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration$FlywayConfiguration.configureDataSource(FlywayAutoConfiguration.java:185)
	at org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration$FlywayConfiguration.flyway(FlywayAutoConfiguration.java:172)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:140)
	... 29 common frames omitted
2025-06-01 01:51:08 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 01:51:08 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 23200 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 01:51:08 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 01:51:09 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 01:51:09 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 72 ms. Found 6 JPA repository interfaces.
2025-06-01 01:51:09 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 01:51:09 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 01:51:09 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 01:51:09 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 01:51:10 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 01:51:10 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1746 ms
2025-06-01 01:51:10 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 01:51:10 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: cfb6810a-9ffb-40f1-9619-8a00254a5f0e
2025-06-01 01:51:10 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 01:51:10 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Unsupported Database: Microsoft SQL Server 16.0
2025-06-01 01:51:10 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 01:51:10 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 01:51:10 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 01:51:10 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 01:51:10 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Unsupported Database: Microsoft SQL Server 16.0
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.flywaydb.core.api.FlywayException: Unsupported Database: Microsoft SQL Server 16.0
	at org.flywaydb.core.internal.database.DatabaseTypeRegister.lambda$getDatabaseTypeForConnection$7(DatabaseTypeRegister.java:122)
	at java.base/java.util.Optional.orElseThrow(Optional.java:403)
	at org.flywaydb.core.internal.database.DatabaseTypeRegister.getDatabaseTypeForConnection(DatabaseTypeRegister.java:122)
	at org.flywaydb.core.internal.jdbc.JdbcConnectionFactory.<init>(JdbcConnectionFactory.java:77)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:138)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:156)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 25 common frames omitted
2025-06-01 01:52:29 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 01:52:29 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 23414 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 01:52:29 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 01:52:31 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 01:52:31 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 71 ms. Found 6 JPA repository interfaces.
2025-06-01 01:52:31 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 01:52:31 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 01:52:31 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 01:52:31 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 01:52:31 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 01:52:31 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 2066 ms
2025-06-01 01:52:32 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 01:52:32 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: c686f488-263d-4e8b-96bc-2de4234468c8
2025-06-01 01:52:32 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 01:52:32 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Unsupported Database: Microsoft SQL Server 16.0
2025-06-01 01:52:32 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 01:52:32 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 01:52:32 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 01:52:32 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 01:52:32 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Unsupported Database: Microsoft SQL Server 16.0
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.flywaydb.core.api.FlywayException: Unsupported Database: Microsoft SQL Server 16.0
	at org.flywaydb.core.internal.database.DatabaseTypeRegister.getDatabaseTypeForConnection(DatabaseTypeRegister.java:105)
	at org.flywaydb.core.internal.jdbc.JdbcConnectionFactory.<init>(JdbcConnectionFactory.java:73)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:134)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:147)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 25 common frames omitted
2025-06-01 01:55:36 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 01:55:37 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 24067 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 01:55:37 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 01:55:39 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 01:55:39 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 180 ms. Found 6 JPA repository interfaces.
2025-06-01 01:55:41 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 01:55:41 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 01:55:41 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 01:55:41 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 01:55:41 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 01:55:41 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3878 ms
2025-06-01 01:55:41 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 01:55:42 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 39cd64c8-786d-44ef-8ba4-6932f11b8fee
2025-06-01 01:55:42 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 01:55:42 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 01:55:42 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 01:55:42 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 01:55:42 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 01:55:43 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Schema history table [clickhealthpharma].[dbo].[flyway_schema_history] does not exist yet
2025-06-01 01:55:43 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 1 migration (execution time 00:00.103s)
2025-06-01 01:55:43 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Creating Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] with baseline ...
2025-06-01 01:55:43 [main] INFO  o.f.core.internal.command.DbBaseline - Successfully baselined schema with version: 1
2025-06-01 01:55:43 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 1
2025-06-01 01:55:43 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 01:55:43 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 01:55:43 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 01:55:43 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 01:55:44 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 01:55:44 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 01:55:46 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 01:55:46 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 01:55:48 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 01:55:49 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 01:55:49 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 01:55:49 [main] INFO  com.clickhealth.pharma.Application - Started Application in 13.122 seconds (process running for 13.586)
2025-06-01 02:02:27 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 02:02:27 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 02:02:27 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 02:02:45 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 02:02:45 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 24926 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 02:02:45 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 02:02:48 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 02:02:48 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 211 ms. Found 6 JPA repository interfaces.
2025-06-01 02:02:50 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 02:02:50 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 02:02:50 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 02:02:50 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 02:02:50 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 02:02:50 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4380 ms
2025-06-01 02:02:50 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 02:02:51 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 3e36c110-a30d-4cda-915c-77ae5a74191d
2025-06-01 02:02:51 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 02:02:51 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 02:02:51 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 02:02:51 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 02:02:51 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 02:02:51 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.097s)
2025-06-01 02:02:51 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 1
2025-06-01 02:02:51 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 02:02:52 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 02:02:52 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 02:02:52 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 02:02:53 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 02:02:53 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 02:02:56 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 02:02:56 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 02:02:57 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 02:02:58 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 02:02:58 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 02:02:58 [main] INFO  com.clickhealth.pharma.Application - Started Application in 14.351 seconds (process running for 14.776)
2025-06-01 02:17:50 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 02:17:50 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 02:17:50 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 02:18:09 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 02:18:09 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 26594 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 02:18:09 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 02:18:12 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 02:18:12 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 178 ms. Found 6 JPA repository interfaces.
2025-06-01 02:18:13 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 02:18:13 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 02:18:13 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 02:18:13 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 02:18:13 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 02:18:13 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4306 ms
2025-06-01 02:18:14 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 02:18:14 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 2a23f70a-2d79-4b9a-a7f8-f750a7ef8711
2025-06-01 02:18:14 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 02:18:15 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 02:18:15 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 02:18:15 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 02:18:15 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 02:18:15 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Schema history table [clickhealthpharma].[dbo].[flyway_schema_history] does not exist yet
2025-06-01 02:18:15 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 1 migration (execution time 00:00.055s)
2025-06-01 02:18:15 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Creating Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] ...
2025-06-01 02:18:15 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: << Empty Schema >>
2025-06-01 02:18:15 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "1 - init schema"
2025-06-01 02:18:15 [main] INFO  o.f.core.internal.command.DbMigrate - Successfully applied 1 migration to schema [dbo], now at version v1 (execution time 00:00.067s)
2025-06-01 02:18:16 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 02:18:16 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 02:18:16 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 02:18:16 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 02:18:17 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 02:18:20 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 02:18:20 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 02:18:21 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 02:18:22 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 02:18:22 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 02:18:22 [main] INFO  com.clickhealth.pharma.Application - Started Application in 14.56 seconds (process running for 15.037)
2025-06-01 02:22:16 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 02:22:16 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 02:22:16 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 02:22:19 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 02:22:19 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 27069 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 02:22:19 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 02:22:20 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 02:22:20 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 88 ms. Found 6 JPA repository interfaces.
2025-06-01 02:22:21 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 02:22:21 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 02:22:21 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 02:22:21 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 02:22:21 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 02:22:21 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1688 ms
2025-06-01 02:22:21 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 02:22:21 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 114ddeeb-e319-44cf-ac36-a46e400029a6
2025-06-01 02:22:21 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 02:22:21 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 02:22:21 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 02:22:21 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 02:22:21 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 02:22:21 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 1 migration (execution time 00:00.033s)
2025-06-01 02:22:21 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 1
2025-06-01 02:22:21 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 02:22:22 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 02:22:22 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 02:22:22 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 02:22:22 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 02:22:22 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 02:22:23 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 02:22:23 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 02:22:24 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 02:22:24 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 02:22:24 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 02:22:24 [main] INFO  com.clickhealth.pharma.Application - Started Application in 5.941 seconds (process running for 6.325)
2025-06-01 02:26:09 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 02:26:09 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 02:26:09 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 02:26:22 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 02:26:22 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 27572 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 02:26:22 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 02:26:23 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 02:26:24 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 81 ms. Found 6 JPA repository interfaces.
2025-06-01 02:26:24 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 02:26:24 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 02:26:24 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 02:26:24 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 02:26:24 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 02:26:24 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 2006 ms
2025-06-01 02:26:24 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 02:26:25 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: d0a0d22c-8a63-47d9-9863-02d613211e3f
2025-06-01 02:26:25 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 02:26:25 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 02:26:25 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 02:26:25 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 02:26:25 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 02:26:25 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.036s)
2025-06-01 02:26:25 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 1
2025-06-01 02:26:25 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "2 - insert demo data"
2025-06-01 02:26:25 [main] INFO  o.f.core.internal.command.DbMigrate - Successfully applied 1 migration to schema [dbo], now at version v2 (execution time 00:00.033s)
2025-06-01 02:26:25 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 02:26:25 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 02:26:25 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 02:26:25 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 02:26:25 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 02:26:27 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 02:26:27 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 02:26:27 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 02:26:28 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 02:26:28 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 02:26:28 [main] INFO  com.clickhealth.pharma.Application - Started Application in 6.412 seconds (process running for 6.863)
2025-06-01 02:27:20 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-01 02:27:20 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-01 02:27:20 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-01 02:27:20 [http-nio-8080-exec-1] INFO  c.c.p.controller.CustomerController - Request recieved to fetch complete customer list
2025-06-01 02:27:40 [http-nio-8080-exec-2] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 207, SQLState: S0001
2025-06-01 02:27:40 [http-nio-8080-exec-2] ERROR o.h.e.jdbc.spi.SqlExceptionHelper - Invalid column name 'customer_id'.
2025-06-01 02:27:40 [http-nio-8080-exec-2] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.springframework.dao.InvalidDataAccessResourceUsageException: JDBC exception executing SQL [    SELECT s.sale_date, s.id, c.name, s.total_amount
    FROM sales s
    JOIN customers c ON s.customer_id = c.id
    WHERE s.sale_date BETWEEN ? AND ?
] [Invalid column name 'customer_id'.] [n/a]; SQL [n/a]] with root cause
com.microsoft.sqlserver.jdbc.SQLServerException: Invalid column name 'customer_id'.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.doExecutePreparedStatement(SQLServerPreparedStatement.java:648)
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement$PrepStmtExecCmd.doExecute(SQLServerPreparedStatement.java:567)
	at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:7675)
	at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:4137)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLServerStatement.java:272)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLServerStatement.java:246)
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.executeQueryInternal(SQLServerPreparedStatement.java:499)
	at com.microsoft.sqlserver.jdbc.SQLServerParameterMetaData.<init>(SQLServerParameterMetaData.java:354)
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.getParameterMetaData(SQLServerPreparedStatement.java:3305)
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.getParameterMetaData(SQLServerPreparedStatement.java:3316)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.getParameterMetaData(HikariProxyPreparedStatement.java)
	at org.hibernate.type.descriptor.jdbc.ObjectNullResolvingJdbcType$1.doBindNull(ObjectNullResolvingJdbcType.java:45)
	at org.hibernate.type.descriptor.jdbc.BasicBinder.bind(BasicBinder.java:51)
	at org.hibernate.sql.exec.internal.AbstractJdbcParameter.bindParameterValue(AbstractJdbcParameter.java:130)
	at org.hibernate.sql.exec.internal.AbstractJdbcParameter.bindParameterValue(AbstractJdbcParameter.java:101)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.bindParameters(DeferredResultSetAccess.java:203)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:233)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.getResultSet(DeferredResultSetAccess.java:167)
	at org.hibernate.sql.results.jdbc.internal.AbstractResultSetAccess.getMetaData(AbstractResultSetAccess.java:36)
	at org.hibernate.sql.results.jdbc.internal.AbstractResultSetAccess.getColumnCount(AbstractResultSetAccess.java:52)
	at org.hibernate.query.results.ResultSetMappingImpl.resolve(ResultSetMappingImpl.java:193)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.resolveJdbcValuesSource(JdbcSelectExecutorStandardImpl.java:325)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:115)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:83)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:76)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:65)
	at org.hibernate.query.sql.internal.NativeSelectQueryPlanImpl.performList(NativeSelectQueryPlanImpl.java:138)
	at org.hibernate.query.sql.internal.NativeQueryImpl.doList(NativeQueryImpl.java:621)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:427)
	at org.hibernate.query.Query.getResultList(Query.java:120)
	at com.clickhealth.pharma.repository.impl.ReportRepositoryImpl.getSalesReport(ReportRepositoryImpl.java:36)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:354)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.clickhealth.pharma.repository.impl.ReportRepositoryImpl$$SpringCGLIB$$0.getSalesReport(<generated>)
	at com.clickhealth.pharma.services.impl.ReportServiceImpl.getSalesReport(ReportServiceImpl.java:35)
	at com.clickhealth.pharma.controller.ReportController.getSalesReport(ReportController.java:38)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:354)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.clickhealth.pharma.controller.ReportController$$SpringCGLIB$$0.getSalesReport(<generated>)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1736)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-06-01 02:33:13 [http-nio-8080-exec-3] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 207, SQLState: S0001
2025-06-01 02:33:13 [http-nio-8080-exec-3] ERROR o.h.e.jdbc.spi.SqlExceptionHelper - Invalid column name 'batch_number'.
2025-06-01 02:33:13 [http-nio-8080-exec-3] INFO  o.h.e.i.DefaultLoadEventListener - HHH000327: Error performing load command
org.hibernate.exception.SQLGrammarException: JDBC exception executing SQL [select me1_0.id,me1_0.batch_number,me1_0.created_at,me1_0.created_by,me1_0.expiry_date,me1_0.name,me1_0.price,me1_0.quantity,me1_0.supplier_id,me1_0.updated_at,me1_0.updated_by from medicines me1_0 where me1_0.id=?] [Invalid column name 'batch_number'.] [n/a]
	at org.hibernate.exception.internal.SQLStateConversionDelegate.convert(SQLStateConversionDelegate.java:91)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:94)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:265)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.getResultSet(DeferredResultSetAccess.java:167)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.advanceNext(JdbcValuesResultSetImpl.java:218)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.processNext(JdbcValuesResultSetImpl.java:98)
	at org.hibernate.sql.results.jdbc.internal.AbstractJdbcValues.next(AbstractJdbcValues.java:19)
	at org.hibernate.sql.results.internal.RowProcessingStateStandardImpl.next(RowProcessingStateStandardImpl.java:66)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:187)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:33)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:209)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:83)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:76)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:65)
	at org.hibernate.loader.ast.internal.SingleIdLoadPlan.load(SingleIdLoadPlan.java:145)
	at org.hibernate.loader.ast.internal.SingleIdLoadPlan.load(SingleIdLoadPlan.java:117)
	at org.hibernate.loader.ast.internal.SingleIdEntityLoaderStandardImpl.load(SingleIdEntityLoaderStandardImpl.java:75)
	at org.hibernate.persister.entity.AbstractEntityPersister.doLoad(AbstractEntityPersister.java:3748)
	at org.hibernate.persister.entity.AbstractEntityPersister.load(AbstractEntityPersister.java:3737)
	at org.hibernate.event.internal.DefaultLoadEventListener.loadFromDatasource(DefaultLoadEventListener.java:604)
	at org.hibernate.event.internal.DefaultLoadEventListener.loadFromCacheOrDatasource(DefaultLoadEventListener.java:590)
	at org.hibernate.event.internal.DefaultLoadEventListener.load(DefaultLoadEventListener.java:560)
	at org.hibernate.event.internal.DefaultLoadEventListener.doLoad(DefaultLoadEventListener.java:544)
	at org.hibernate.event.internal.DefaultLoadEventListener.load(DefaultLoadEventListener.java:207)
	at org.hibernate.event.internal.DefaultLoadEventListener.loadWithRegularProxy(DefaultLoadEventListener.java:290)
	at org.hibernate.event.internal.DefaultLoadEventListener.proxyOrLoad(DefaultLoadEventListener.java:242)
	at org.hibernate.event.internal.DefaultLoadEventListener.doOnLoad(DefaultLoadEventListener.java:111)
	at org.hibernate.event.internal.DefaultLoadEventListener.onLoad(DefaultLoadEventListener.java:68)
	at org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:138)
	at org.hibernate.internal.SessionImpl.fireLoadNoChecks(SessionImpl.java:1222)
	at org.hibernate.internal.SessionImpl.fireLoad(SessionImpl.java:1210)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.load(IdentifierLoadAccessImpl.java:209)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.doLoad(IdentifierLoadAccessImpl.java:160)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.lambda$load$1(IdentifierLoadAccessImpl.java:149)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.perform(IdentifierLoadAccessImpl.java:112)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.load(IdentifierLoadAccessImpl.java:149)
	at org.hibernate.internal.SessionImpl.find(SessionImpl.java:2424)
	at org.hibernate.internal.SessionImpl.find(SessionImpl.java:2395)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.orm.jpa.ExtendedEntityManagerCreator$ExtendedEntityManagerInvocationHandler.invoke(ExtendedEntityManagerCreator.java:364)
	at jdk.proxy2/jdk.proxy2.$Proxy147.find(Unknown Source)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:319)
	at jdk.proxy2/jdk.proxy2.$Proxy147.find(Unknown Source)
	at org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById(SimpleJpaRepository.java:313)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:354)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker$RepositoryFragmentMethodInvoker.lambda$new$0(RepositoryMethodInvoker.java:277)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.doInvoke(RepositoryMethodInvoker.java:170)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.invoke(RepositoryMethodInvoker.java:158)
	at org.springframework.data.repository.core.support.RepositoryComposition$RepositoryFragments.invoke(RepositoryComposition.java:516)
	at org.springframework.data.repository.core.support.RepositoryComposition.invoke(RepositoryComposition.java:285)
	at org.springframework.data.repository.core.support.RepositoryFactorySupport$ImplementationMethodExecutionInterceptor.invoke(RepositoryFactorySupport.java:628)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.doInvoke(QueryExecutorMethodInterceptor.java:168)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.invoke(QueryExecutorMethodInterceptor.java:143)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.projection.DefaultMethodInvokingMethodInterceptor.invoke(DefaultMethodInvokingMethodInterceptor.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:392)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.jpa.repository.support.CrudMethodMetadataPostProcessor$CrudMethodMetadataPopulatingMethodInterceptor.invoke(CrudMethodMetadataPostProcessor.java:164)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:223)
	at jdk.proxy2/jdk.proxy2.$Proxy158.findById(Unknown Source)
	at com.clickhealth.pharma.services.impl.MedicineServiceImpl.getById(MedicineServiceImpl.java:37)
	at com.clickhealth.pharma.controller.MedicineController.getMedicineById(MedicineController.java:39)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:354)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.clickhealth.pharma.controller.MedicineController$$SpringCGLIB$$0.getMedicineById(<generated>)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1736)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: Invalid column name 'batch_number'.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.doExecutePreparedStatement(SQLServerPreparedStatement.java:648)
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement$PrepStmtExecCmd.doExecute(SQLServerPreparedStatement.java:567)
	at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:7675)
	at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:4137)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLServerStatement.java:272)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLServerStatement.java:246)
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.executeQuery(SQLServerPreparedStatement.java:485)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeQuery(ProxyPreparedStatement.java:52)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeQuery(HikariProxyPreparedStatement.java)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:246)
	... 142 common frames omitted
2025-06-01 02:33:13 [http-nio-8080-exec-3] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.springframework.dao.InvalidDataAccessResourceUsageException: JDBC exception executing SQL [select me1_0.id,me1_0.batch_number,me1_0.created_at,me1_0.created_by,me1_0.expiry_date,me1_0.name,me1_0.price,me1_0.quantity,me1_0.supplier_id,me1_0.updated_at,me1_0.updated_by from medicines me1_0 where me1_0.id=?] [Invalid column name 'batch_number'.] [n/a]; SQL [n/a]] with root cause
com.microsoft.sqlserver.jdbc.SQLServerException: Invalid column name 'batch_number'.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.doExecutePreparedStatement(SQLServerPreparedStatement.java:648)
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement$PrepStmtExecCmd.doExecute(SQLServerPreparedStatement.java:567)
	at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:7675)
	at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:4137)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLServerStatement.java:272)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLServerStatement.java:246)
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.executeQuery(SQLServerPreparedStatement.java:485)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeQuery(ProxyPreparedStatement.java:52)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeQuery(HikariProxyPreparedStatement.java)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:246)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.getResultSet(DeferredResultSetAccess.java:167)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.advanceNext(JdbcValuesResultSetImpl.java:218)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.processNext(JdbcValuesResultSetImpl.java:98)
	at org.hibernate.sql.results.jdbc.internal.AbstractJdbcValues.next(AbstractJdbcValues.java:19)
	at org.hibernate.sql.results.internal.RowProcessingStateStandardImpl.next(RowProcessingStateStandardImpl.java:66)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:187)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:33)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:209)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:83)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:76)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:65)
	at org.hibernate.loader.ast.internal.SingleIdLoadPlan.load(SingleIdLoadPlan.java:145)
	at org.hibernate.loader.ast.internal.SingleIdLoadPlan.load(SingleIdLoadPlan.java:117)
	at org.hibernate.loader.ast.internal.SingleIdEntityLoaderStandardImpl.load(SingleIdEntityLoaderStandardImpl.java:75)
	at org.hibernate.persister.entity.AbstractEntityPersister.doLoad(AbstractEntityPersister.java:3748)
	at org.hibernate.persister.entity.AbstractEntityPersister.load(AbstractEntityPersister.java:3737)
	at org.hibernate.event.internal.DefaultLoadEventListener.loadFromDatasource(DefaultLoadEventListener.java:604)
	at org.hibernate.event.internal.DefaultLoadEventListener.loadFromCacheOrDatasource(DefaultLoadEventListener.java:590)
	at org.hibernate.event.internal.DefaultLoadEventListener.load(DefaultLoadEventListener.java:560)
	at org.hibernate.event.internal.DefaultLoadEventListener.doLoad(DefaultLoadEventListener.java:544)
	at org.hibernate.event.internal.DefaultLoadEventListener.load(DefaultLoadEventListener.java:207)
	at org.hibernate.event.internal.DefaultLoadEventListener.loadWithRegularProxy(DefaultLoadEventListener.java:290)
	at org.hibernate.event.internal.DefaultLoadEventListener.proxyOrLoad(DefaultLoadEventListener.java:242)
	at org.hibernate.event.internal.DefaultLoadEventListener.doOnLoad(DefaultLoadEventListener.java:111)
	at org.hibernate.event.internal.DefaultLoadEventListener.onLoad(DefaultLoadEventListener.java:68)
	at org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:138)
	at org.hibernate.internal.SessionImpl.fireLoadNoChecks(SessionImpl.java:1222)
	at org.hibernate.internal.SessionImpl.fireLoad(SessionImpl.java:1210)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.load(IdentifierLoadAccessImpl.java:209)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.doLoad(IdentifierLoadAccessImpl.java:160)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.lambda$load$1(IdentifierLoadAccessImpl.java:149)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.perform(IdentifierLoadAccessImpl.java:112)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.load(IdentifierLoadAccessImpl.java:149)
	at org.hibernate.internal.SessionImpl.find(SessionImpl.java:2424)
	at org.hibernate.internal.SessionImpl.find(SessionImpl.java:2395)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.orm.jpa.ExtendedEntityManagerCreator$ExtendedEntityManagerInvocationHandler.invoke(ExtendedEntityManagerCreator.java:364)
	at jdk.proxy2/jdk.proxy2.$Proxy147.find(Unknown Source)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:319)
	at jdk.proxy2/jdk.proxy2.$Proxy147.find(Unknown Source)
	at org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById(SimpleJpaRepository.java:313)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:354)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker$RepositoryFragmentMethodInvoker.lambda$new$0(RepositoryMethodInvoker.java:277)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.doInvoke(RepositoryMethodInvoker.java:170)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.invoke(RepositoryMethodInvoker.java:158)
	at org.springframework.data.repository.core.support.RepositoryComposition$RepositoryFragments.invoke(RepositoryComposition.java:516)
	at org.springframework.data.repository.core.support.RepositoryComposition.invoke(RepositoryComposition.java:285)
	at org.springframework.data.repository.core.support.RepositoryFactorySupport$ImplementationMethodExecutionInterceptor.invoke(RepositoryFactorySupport.java:628)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.doInvoke(QueryExecutorMethodInterceptor.java:168)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.invoke(QueryExecutorMethodInterceptor.java:143)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.projection.DefaultMethodInvokingMethodInterceptor.invoke(DefaultMethodInvokingMethodInterceptor.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:392)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.jpa.repository.support.CrudMethodMetadataPostProcessor$CrudMethodMetadataPopulatingMethodInterceptor.invoke(CrudMethodMetadataPostProcessor.java:164)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:223)
	at jdk.proxy2/jdk.proxy2.$Proxy158.findById(Unknown Source)
	at com.clickhealth.pharma.services.impl.MedicineServiceImpl.getById(MedicineServiceImpl.java:37)
	at com.clickhealth.pharma.controller.MedicineController.getMedicineById(MedicineController.java:39)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:354)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.clickhealth.pharma.controller.MedicineController$$SpringCGLIB$$0.getMedicineById(<generated>)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1736)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-06-01 02:45:58 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 02:45:58 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 02:45:58 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 02:47:39 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 02:47:39 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 29722 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 02:47:39 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 02:47:40 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 02:47:40 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 71 ms. Found 6 JPA repository interfaces.
2025-06-01 02:47:41 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 02:47:41 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 02:47:41 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 02:47:41 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 02:47:41 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 02:47:41 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1674 ms
2025-06-01 02:47:41 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 02:47:42 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: fd32f76d-0a31-4d94-a5d4-27f2edb03aad
2025-06-01 02:47:42 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 02:47:42 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 02:47:42 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 02:47:42 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 02:47:42 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 02:47:42 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Schema history table [clickhealthpharma].[dbo].[flyway_schema_history] does not exist yet
2025-06-01 02:47:42 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.113s)
2025-06-01 02:47:42 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Creating Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] ...
2025-06-01 02:47:42 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: << Empty Schema >>
2025-06-01 02:47:42 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "1 - init schema"
2025-06-01 02:47:42 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "2 - insert demo data"
2025-06-01 02:47:42 [main] INFO  o.f.core.internal.command.DbMigrate - Successfully applied 2 migrations to schema [dbo], now at version v2 (execution time 00:00.045s)
2025-06-01 02:47:42 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 02:47:42 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 02:47:42 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 02:47:43 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 02:47:43 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 02:47:44 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 02:47:44 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 02:47:45 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 02:47:45 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 02:47:45 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 02:47:45 [main] INFO  com.clickhealth.pharma.Application - Started Application in 6.405 seconds (process running for 6.805)
2025-06-01 03:04:56 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-01 03:04:56 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-01 03:04:56 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-06-01 03:04:57 [http-nio-8080-exec-1] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 207, SQLState: S0001
2025-06-01 03:04:57 [http-nio-8080-exec-1] ERROR o.h.e.jdbc.spi.SqlExceptionHelper - Invalid column name 'batch_number'.
2025-06-01 03:04:57 [http-nio-8080-exec-1] INFO  o.h.e.i.DefaultLoadEventListener - HHH000327: Error performing load command
org.hibernate.exception.SQLGrammarException: JDBC exception executing SQL [select me1_0.id,me1_0.batch_number,me1_0.created_at,me1_0.created_by,me1_0.expiry_date,me1_0.name,me1_0.price,me1_0.quantity,me1_0.supplier_id,me1_0.updated_at,me1_0.updated_by from medicines me1_0 where me1_0.id=?] [Invalid column name 'batch_number'.] [n/a]
	at org.hibernate.exception.internal.SQLStateConversionDelegate.convert(SQLStateConversionDelegate.java:91)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:94)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:265)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.getResultSet(DeferredResultSetAccess.java:167)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.advanceNext(JdbcValuesResultSetImpl.java:218)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.processNext(JdbcValuesResultSetImpl.java:98)
	at org.hibernate.sql.results.jdbc.internal.AbstractJdbcValues.next(AbstractJdbcValues.java:19)
	at org.hibernate.sql.results.internal.RowProcessingStateStandardImpl.next(RowProcessingStateStandardImpl.java:66)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:187)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:33)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:209)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:83)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:76)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:65)
	at org.hibernate.loader.ast.internal.SingleIdLoadPlan.load(SingleIdLoadPlan.java:145)
	at org.hibernate.loader.ast.internal.SingleIdLoadPlan.load(SingleIdLoadPlan.java:117)
	at org.hibernate.loader.ast.internal.SingleIdEntityLoaderStandardImpl.load(SingleIdEntityLoaderStandardImpl.java:75)
	at org.hibernate.persister.entity.AbstractEntityPersister.doLoad(AbstractEntityPersister.java:3748)
	at org.hibernate.persister.entity.AbstractEntityPersister.load(AbstractEntityPersister.java:3737)
	at org.hibernate.event.internal.DefaultLoadEventListener.loadFromDatasource(DefaultLoadEventListener.java:604)
	at org.hibernate.event.internal.DefaultLoadEventListener.loadFromCacheOrDatasource(DefaultLoadEventListener.java:590)
	at org.hibernate.event.internal.DefaultLoadEventListener.load(DefaultLoadEventListener.java:560)
	at org.hibernate.event.internal.DefaultLoadEventListener.doLoad(DefaultLoadEventListener.java:544)
	at org.hibernate.event.internal.DefaultLoadEventListener.load(DefaultLoadEventListener.java:207)
	at org.hibernate.event.internal.DefaultLoadEventListener.loadWithRegularProxy(DefaultLoadEventListener.java:290)
	at org.hibernate.event.internal.DefaultLoadEventListener.proxyOrLoad(DefaultLoadEventListener.java:242)
	at org.hibernate.event.internal.DefaultLoadEventListener.doOnLoad(DefaultLoadEventListener.java:111)
	at org.hibernate.event.internal.DefaultLoadEventListener.onLoad(DefaultLoadEventListener.java:68)
	at org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:138)
	at org.hibernate.internal.SessionImpl.fireLoadNoChecks(SessionImpl.java:1222)
	at org.hibernate.internal.SessionImpl.fireLoad(SessionImpl.java:1210)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.load(IdentifierLoadAccessImpl.java:209)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.doLoad(IdentifierLoadAccessImpl.java:160)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.lambda$load$1(IdentifierLoadAccessImpl.java:149)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.perform(IdentifierLoadAccessImpl.java:112)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.load(IdentifierLoadAccessImpl.java:149)
	at org.hibernate.internal.SessionImpl.find(SessionImpl.java:2424)
	at org.hibernate.internal.SessionImpl.find(SessionImpl.java:2395)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.orm.jpa.ExtendedEntityManagerCreator$ExtendedEntityManagerInvocationHandler.invoke(ExtendedEntityManagerCreator.java:364)
	at jdk.proxy2/jdk.proxy2.$Proxy147.find(Unknown Source)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:319)
	at jdk.proxy2/jdk.proxy2.$Proxy147.find(Unknown Source)
	at org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById(SimpleJpaRepository.java:313)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:354)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker$RepositoryFragmentMethodInvoker.lambda$new$0(RepositoryMethodInvoker.java:277)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.doInvoke(RepositoryMethodInvoker.java:170)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.invoke(RepositoryMethodInvoker.java:158)
	at org.springframework.data.repository.core.support.RepositoryComposition$RepositoryFragments.invoke(RepositoryComposition.java:516)
	at org.springframework.data.repository.core.support.RepositoryComposition.invoke(RepositoryComposition.java:285)
	at org.springframework.data.repository.core.support.RepositoryFactorySupport$ImplementationMethodExecutionInterceptor.invoke(RepositoryFactorySupport.java:628)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.doInvoke(QueryExecutorMethodInterceptor.java:168)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.invoke(QueryExecutorMethodInterceptor.java:143)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.projection.DefaultMethodInvokingMethodInterceptor.invoke(DefaultMethodInvokingMethodInterceptor.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:392)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.jpa.repository.support.CrudMethodMetadataPostProcessor$CrudMethodMetadataPopulatingMethodInterceptor.invoke(CrudMethodMetadataPostProcessor.java:164)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:223)
	at jdk.proxy2/jdk.proxy2.$Proxy158.findById(Unknown Source)
	at com.clickhealth.pharma.services.impl.MedicineServiceImpl.getById(MedicineServiceImpl.java:37)
	at com.clickhealth.pharma.controller.MedicineController.getMedicineById(MedicineController.java:39)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:354)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.clickhealth.pharma.controller.MedicineController$$SpringCGLIB$$0.getMedicineById(<generated>)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1736)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: Invalid column name 'batch_number'.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.doExecutePreparedStatement(SQLServerPreparedStatement.java:648)
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement$PrepStmtExecCmd.doExecute(SQLServerPreparedStatement.java:567)
	at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:7675)
	at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:4137)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLServerStatement.java:272)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLServerStatement.java:246)
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.executeQuery(SQLServerPreparedStatement.java:485)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeQuery(ProxyPreparedStatement.java:52)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeQuery(HikariProxyPreparedStatement.java)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:246)
	... 142 common frames omitted
2025-06-01 03:04:57 [http-nio-8080-exec-1] ERROR o.a.c.c.C.[.[.[.[dispatcherServlet] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.springframework.dao.InvalidDataAccessResourceUsageException: JDBC exception executing SQL [select me1_0.id,me1_0.batch_number,me1_0.created_at,me1_0.created_by,me1_0.expiry_date,me1_0.name,me1_0.price,me1_0.quantity,me1_0.supplier_id,me1_0.updated_at,me1_0.updated_by from medicines me1_0 where me1_0.id=?] [Invalid column name 'batch_number'.] [n/a]; SQL [n/a]] with root cause
com.microsoft.sqlserver.jdbc.SQLServerException: Invalid column name 'batch_number'.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.doExecutePreparedStatement(SQLServerPreparedStatement.java:648)
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement$PrepStmtExecCmd.doExecute(SQLServerPreparedStatement.java:567)
	at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:7675)
	at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:4137)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLServerStatement.java:272)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLServerStatement.java:246)
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.executeQuery(SQLServerPreparedStatement.java:485)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeQuery(ProxyPreparedStatement.java:52)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeQuery(HikariProxyPreparedStatement.java)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:246)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.getResultSet(DeferredResultSetAccess.java:167)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.advanceNext(JdbcValuesResultSetImpl.java:218)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.processNext(JdbcValuesResultSetImpl.java:98)
	at org.hibernate.sql.results.jdbc.internal.AbstractJdbcValues.next(AbstractJdbcValues.java:19)
	at org.hibernate.sql.results.internal.RowProcessingStateStandardImpl.next(RowProcessingStateStandardImpl.java:66)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:187)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:33)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:209)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:83)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:76)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:65)
	at org.hibernate.loader.ast.internal.SingleIdLoadPlan.load(SingleIdLoadPlan.java:145)
	at org.hibernate.loader.ast.internal.SingleIdLoadPlan.load(SingleIdLoadPlan.java:117)
	at org.hibernate.loader.ast.internal.SingleIdEntityLoaderStandardImpl.load(SingleIdEntityLoaderStandardImpl.java:75)
	at org.hibernate.persister.entity.AbstractEntityPersister.doLoad(AbstractEntityPersister.java:3748)
	at org.hibernate.persister.entity.AbstractEntityPersister.load(AbstractEntityPersister.java:3737)
	at org.hibernate.event.internal.DefaultLoadEventListener.loadFromDatasource(DefaultLoadEventListener.java:604)
	at org.hibernate.event.internal.DefaultLoadEventListener.loadFromCacheOrDatasource(DefaultLoadEventListener.java:590)
	at org.hibernate.event.internal.DefaultLoadEventListener.load(DefaultLoadEventListener.java:560)
	at org.hibernate.event.internal.DefaultLoadEventListener.doLoad(DefaultLoadEventListener.java:544)
	at org.hibernate.event.internal.DefaultLoadEventListener.load(DefaultLoadEventListener.java:207)
	at org.hibernate.event.internal.DefaultLoadEventListener.loadWithRegularProxy(DefaultLoadEventListener.java:290)
	at org.hibernate.event.internal.DefaultLoadEventListener.proxyOrLoad(DefaultLoadEventListener.java:242)
	at org.hibernate.event.internal.DefaultLoadEventListener.doOnLoad(DefaultLoadEventListener.java:111)
	at org.hibernate.event.internal.DefaultLoadEventListener.onLoad(DefaultLoadEventListener.java:68)
	at org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:138)
	at org.hibernate.internal.SessionImpl.fireLoadNoChecks(SessionImpl.java:1222)
	at org.hibernate.internal.SessionImpl.fireLoad(SessionImpl.java:1210)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.load(IdentifierLoadAccessImpl.java:209)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.doLoad(IdentifierLoadAccessImpl.java:160)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.lambda$load$1(IdentifierLoadAccessImpl.java:149)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.perform(IdentifierLoadAccessImpl.java:112)
	at org.hibernate.loader.internal.IdentifierLoadAccessImpl.load(IdentifierLoadAccessImpl.java:149)
	at org.hibernate.internal.SessionImpl.find(SessionImpl.java:2424)
	at org.hibernate.internal.SessionImpl.find(SessionImpl.java:2395)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.orm.jpa.ExtendedEntityManagerCreator$ExtendedEntityManagerInvocationHandler.invoke(ExtendedEntityManagerCreator.java:364)
	at jdk.proxy2/jdk.proxy2.$Proxy147.find(Unknown Source)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:319)
	at jdk.proxy2/jdk.proxy2.$Proxy147.find(Unknown Source)
	at org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById(SimpleJpaRepository.java:313)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:354)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker$RepositoryFragmentMethodInvoker.lambda$new$0(RepositoryMethodInvoker.java:277)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.doInvoke(RepositoryMethodInvoker.java:170)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.invoke(RepositoryMethodInvoker.java:158)
	at org.springframework.data.repository.core.support.RepositoryComposition$RepositoryFragments.invoke(RepositoryComposition.java:516)
	at org.springframework.data.repository.core.support.RepositoryComposition.invoke(RepositoryComposition.java:285)
	at org.springframework.data.repository.core.support.RepositoryFactorySupport$ImplementationMethodExecutionInterceptor.invoke(RepositoryFactorySupport.java:628)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.doInvoke(QueryExecutorMethodInterceptor.java:168)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.invoke(QueryExecutorMethodInterceptor.java:143)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.projection.DefaultMethodInvokingMethodInterceptor.invoke(DefaultMethodInvokingMethodInterceptor.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:392)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.jpa.repository.support.CrudMethodMetadataPostProcessor$CrudMethodMetadataPopulatingMethodInterceptor.invoke(CrudMethodMetadataPostProcessor.java:164)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:223)
	at jdk.proxy2/jdk.proxy2.$Proxy158.findById(Unknown Source)
	at com.clickhealth.pharma.services.impl.MedicineServiceImpl.getById(MedicineServiceImpl.java:37)
	at com.clickhealth.pharma.controller.MedicineController.getMedicineById(MedicineController.java:39)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:354)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.validation.beanvalidation.MethodValidationInterceptor.invoke(MethodValidationInterceptor.java:174)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:768)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:720)
	at com.clickhealth.pharma.controller.MedicineController$$SpringCGLIB$$0.getMedicineById(<generated>)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:926)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:831)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:175)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:150)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1736)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-06-01 03:08:12 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 03:08:12 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 03:08:12 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 03:09:28 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 03:09:29 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 31935 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 03:09:29 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 03:09:31 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 03:09:32 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 158 ms. Found 6 JPA repository interfaces.
2025-06-01 03:09:33 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 03:09:33 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 03:09:33 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 03:09:33 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 03:09:33 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 03:09:33 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4233 ms
2025-06-01 03:09:33 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 03:09:34 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 74ece942-7d84-46b5-a13d-4f177c3cc6bf
2025-06-01 03:09:34 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 03:09:34 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 03:09:34 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 03:09:34 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 03:09:35 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 03:09:35 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Schema history table [clickhealthpharma].[dbo].[flyway_schema_history] does not exist yet
2025-06-01 03:09:35 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.061s)
2025-06-01 03:09:35 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Creating Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] with baseline ...
2025-06-01 03:09:35 [main] INFO  o.f.core.internal.command.DbBaseline - Successfully baselined schema with version: 1
2025-06-01 03:09:35 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 1
2025-06-01 03:09:35 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "2 - insert demo data"
2025-06-01 03:09:35 [main] ERROR o.f.core.internal.command.DbMigrate - Migration of schema [dbo] to version "2 - insert demo data" failed! Changes successfully rolled back.
2025-06-01 03:09:35 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'contact_email'.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert demo Users
INSERT INTO users (username, password, role, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

2025-06-01 03:09:35 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 03:09:35 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 03:09:35 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 03:09:35 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 03:09:35 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'contact_email'.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert demo Users
INSERT INTO users (username, password, role, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'contact_email'.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert demo Users
INSERT INTO users (username, password, role, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.database.sqlserver.SQLServerApplicationLockTemplate.execute(SQLServerApplicationLockTemplate.java:61)
	at org.flywaydb.database.sqlserver.SQLServerConnection.lock(SQLServerConnection.java:93)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:144)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:188)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:213)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:140)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 25 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'contact_email'.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert demo Users
INSERT INTO users (username, password, role, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:267)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:222)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:126)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:68)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 41 common frames omitted
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: Invalid column name 'contact_email'.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.doExecuteStatement(SQLServerStatement.java:920)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement$StmtExecCmd.doExecute(SQLServerStatement.java:814)
	at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:7675)
	at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:4137)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLServerStatement.java:272)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLServerStatement.java:246)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.execute(SQLServerStatement.java:787)
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:94)
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:201)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:95)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:210)
	... 47 common frames omitted
2025-06-01 03:15:14 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 03:15:14 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 32609 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 03:15:14 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 03:15:15 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 03:15:15 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 76 ms. Found 6 JPA repository interfaces.
2025-06-01 03:15:16 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 03:15:16 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 03:15:16 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 03:15:16 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 03:15:16 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 03:15:16 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 2160 ms
2025-06-01 03:15:16 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 03:15:17 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 799e8fae-c278-4ade-8c22-679acfbda581
2025-06-01 03:15:17 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 03:15:17 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 03:15:17 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 03:15:17 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 03:15:17 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 03:15:17 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Schema history table [clickhealthpharma].[dbo].[flyway_schema_history] does not exist yet
2025-06-01 03:15:17 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.028s)
2025-06-01 03:15:17 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Creating Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] ...
2025-06-01 03:15:17 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: << Empty Schema >>
2025-06-01 03:15:17 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "1 - init schema"
2025-06-01 03:15:17 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "2 - insert demo data"
2025-06-01 03:15:17 [main] INFO  o.f.core.internal.command.DbMigrate - Successfully applied 2 migrations to schema [dbo], now at version v2 (execution time 00:00.063s)
2025-06-01 03:15:17 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 03:15:17 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 03:15:17 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 03:15:18 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 03:15:18 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 03:15:21 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 03:15:21 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 03:15:23 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 03:15:24 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 03:15:24 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 03:15:24 [main] INFO  com.clickhealth.pharma.Application - Started Application in 11.167 seconds (process running for 11.597)
2025-06-01 03:16:53 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 03:16:53 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 03:16:53 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 03:18:10 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 03:18:10 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 33040 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 03:18:10 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 03:18:11 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 03:18:11 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 71 ms. Found 6 JPA repository interfaces.
2025-06-01 03:18:12 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 03:18:12 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 03:18:12 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 03:18:12 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 03:18:12 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 03:18:12 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1692 ms
2025-06-01 03:18:12 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 03:18:12 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 4430a579-c826-48c4-8640-d517eeb89b3b
2025-06-01 03:18:12 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 03:18:12 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 03:18:12 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 03:18:12 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 03:18:12 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 03:18:12 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 03:18:12 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 03:18:12 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 03:18:12 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 03:18:12 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 03:18:12 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 03:18:12 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 03:18:12 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__insert_demo_data.sql
2025-06-01 03:18:12 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 03:18:12 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 03:18:12 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__insert_demo_data.sql
2025-06-01 03:18:12 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 03:18:12 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 03:18:12 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 03:18:12 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 03:18:12 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 03:18:12 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 03:18:12 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 03:18:12 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 03:18:12 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 03:18:12 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 03:18:13 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 03:18:13 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 03:18:13 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 03:18:13 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 03:18:13 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 03:18:13 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 03:18:13 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Schema history table [clickhealthpharma].[dbo].[flyway_schema_history] does not exist yet
2025-06-01 03:18:13 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.037s)
2025-06-01 03:18:13 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 03:18:13 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Creating Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] with baseline ...
2025-06-01 03:18:13 [main] DEBUG o.f.core.internal.parser.Parser - Parsing  ...
2025-06-01 03:18:13 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 1: CREATE TABLE [clickhealthpharma].[dbo].[flyway_schema_history] (
    [installed_rank] INT NOT NULL,
    [version] NVARCHAR(50),
    [description] NVARCHAR(200),
    [type] NVARCHAR(20) NOT NULL,
    [script] NVARCHAR(1000) NOT NULL,
    [checksum] INT,
    [installed_by] NVARCHAR(100) NOT NULL,
    [installed_on] DATETIME NOT NULL DEFAULT GETDATE(),
    [execution_time] INT NOT NULL,
    [success] BIT NOT NULL
);
INSERT INTO [clickhealthpharma].[dbo].[flyway_schema_history] ([installed_rank], [version], [description], [type], [script], [checksum], [installed_by], [execution_time], [success]) VALUES (1, '1', '<< Flyway Baseline >>', 'BASELINE', '<< Flyway Baseline >>', NULL, 'pharma_user', 0, 1);
ALTER TABLE [clickhealthpharma].[dbo].[flyway_schema_history] ADD CONSTRAINT [flyway_schema_history_pk] PRIMARY KEY ([installed_rank]);
CREATE INDEX [flyway_schema_history_s_idx] ON [clickhealthpharma].[dbo].[flyway_schema_history] ([success]);
2025-06-01 03:18:13 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: CREATE TABLE [clickhealthpharma].[dbo].[flyway_schema_history] (
    [installed_rank] INT NOT NULL,
    [version] NVARCHAR(50),
    [description] NVARCHAR(200),
    [type] NVARCHAR(20) NOT NULL,
    [script] NVARCHAR(1000) NOT NULL,
    [checksum] INT,
    [installed_by] NVARCHAR(100) NOT NULL,
    [installed_on] DATETIME NOT NULL DEFAULT GETDATE(),
    [execution_time] INT NOT NULL,
    [success] BIT NOT NULL
);
INSERT INTO [clickhealthpharma].[dbo].[flyway_schema_history] ([installed_rank], [version], [description], [type], [script], [checksum], [installed_by], [execution_time], [success]) VALUES (1, '1', '<< Flyway Baseline >>', 'BASELINE', '<< Flyway Baseline >>', NULL, 'pharma_user', 0, 1);
ALTER TABLE [clickhealthpharma].[dbo].[flyway_schema_history] ADD CONSTRAINT [flyway_schema_history_pk] PRIMARY KEY ([installed_rank]);
CREATE INDEX [flyway_schema_history_s_idx] ON [clickhealthpharma].[dbo].[flyway_schema_history] ([success]);
2025-06-01 03:18:13 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 03:18:13 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 1 row affected
2025-06-01 03:18:13 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 03:18:13 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 03:18:13 [main] DEBUG o.f.c.i.s.JdbcTableSchemaHistory - Created Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] with baseline
2025-06-01 03:18:13 [main] INFO  o.f.core.internal.command.DbBaseline - Successfully baselined schema with version: 1
2025-06-01 03:18:13 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 1
2025-06-01 03:18:13 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V2__insert_demo_data.sql ...
2025-06-01 03:18:13 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert demo Users
INSERT INTO users (username, password, role, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2
2025-06-01 03:18:13 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "2 - insert demo data" ...
2025-06-01 03:18:13 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "2 - insert demo data"
2025-06-01 03:18:13 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert demo Users
INSERT INTO users (username, password, role, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2
2025-06-01 03:18:13 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Rolling back transaction...
2025-06-01 03:18:13 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Transaction rolled back
2025-06-01 03:18:13 [main] ERROR o.f.core.internal.command.DbMigrate - Migration of schema [dbo] to version "2 - insert demo data" failed! Changes successfully rolled back.
2025-06-01 03:18:13 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 24 of 80M
2025-06-01 03:18:13 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : 23000
Error Code : 2627
Message    : Violation of UNIQUE KEY constraint 'UQ__users__F3DBC5727DE0AC3B'. Cannot insert duplicate key in object 'dbo.users'. The duplicate key value is (admin).
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert demo Users
INSERT INTO users (username, password, role, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

2025-06-01 03:18:13 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 03:18:13 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 03:18:13 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 03:18:13 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 03:18:13 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : 23000
Error Code : 2627
Message    : Violation of UNIQUE KEY constraint 'UQ__users__F3DBC5727DE0AC3B'. Cannot insert duplicate key in object 'dbo.users'. The duplicate key value is (admin).
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert demo Users
INSERT INTO users (username, password, role, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : 23000
Error Code : 2627
Message    : Violation of UNIQUE KEY constraint 'UQ__users__F3DBC5727DE0AC3B'. Cannot insert duplicate key in object 'dbo.users'. The duplicate key value is (admin).
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert demo Users
INSERT INTO users (username, password, role, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.database.sqlserver.SQLServerApplicationLockTemplate.execute(SQLServerApplicationLockTemplate.java:61)
	at org.flywaydb.database.sqlserver.SQLServerConnection.lock(SQLServerConnection.java:93)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:144)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:188)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:213)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:140)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 25 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : 23000
Error Code : 2627
Message    : Violation of UNIQUE KEY constraint 'UQ__users__F3DBC5727DE0AC3B'. Cannot insert duplicate key in object 'dbo.users'. The duplicate key value is (admin).
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert demo Users
INSERT INTO users (username, password, role, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:267)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:222)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:126)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:68)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 41 common frames omitted
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: Violation of UNIQUE KEY constraint 'UQ__users__F3DBC5727DE0AC3B'. Cannot insert duplicate key in object 'dbo.users'. The duplicate key value is (admin).
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getMoreResults(SQLServerStatement.java:1406)
	at com.zaxxer.hikari.pool.HikariProxyStatement.getMoreResults(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.extractResults(JdbcTemplate.java:270)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:202)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:95)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:210)
	... 47 common frames omitted
2025-06-01 03:22:02 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 03:22:02 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 33531 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 03:22:02 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 03:22:05 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 03:22:05 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 163 ms. Found 6 JPA repository interfaces.
2025-06-01 03:22:07 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 03:22:07 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 03:22:07 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 03:22:07 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 03:22:07 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 03:22:07 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4109 ms
2025-06-01 03:22:07 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 03:22:08 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 34b67b1d-c020-4b1d-8db7-751834295981
2025-06-01 03:22:08 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 03:22:08 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 03:22:08 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 03:22:08 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 03:22:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 03:22:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 03:22:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 03:22:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 03:22:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 03:22:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 03:22:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 03:22:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 03:22:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__insert_demo_data.sql
2025-06-01 03:22:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 03:22:08 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 03:22:08 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__insert_demo_data.sql
2025-06-01 03:22:08 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 03:22:09 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 03:22:09 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 03:22:09 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 03:22:09 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 03:22:09 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 03:22:09 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 03:22:09 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 03:22:09 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 03:22:09 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 03:22:09 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 03:22:09 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 03:22:09 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 03:22:09 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Schema history table [clickhealthpharma].[dbo].[flyway_schema_history] does not exist yet
2025-06-01 03:22:09 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.072s)
2025-06-01 03:22:09 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 03:22:09 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Creating Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] ...
2025-06-01 03:22:09 [main] DEBUG o.f.core.internal.parser.Parser - Parsing  ...
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 1: CREATE TABLE [clickhealthpharma].[dbo].[flyway_schema_history] (
    [installed_rank] INT NOT NULL,
    [version] NVARCHAR(50),
    [description] NVARCHAR(200),
    [type] NVARCHAR(20) NOT NULL,
    [script] NVARCHAR(1000) NOT NULL,
    [checksum] INT,
    [installed_by] NVARCHAR(100) NOT NULL,
    [installed_on] DATETIME NOT NULL DEFAULT GETDATE(),
    [execution_time] INT NOT NULL,
    [success] BIT NOT NULL
);
ALTER TABLE [clickhealthpharma].[dbo].[flyway_schema_history] ADD CONSTRAINT [flyway_schema_history_pk] PRIMARY KEY ([installed_rank]);
CREATE INDEX [flyway_schema_history_s_idx] ON [clickhealthpharma].[dbo].[flyway_schema_history] ([success]);
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: CREATE TABLE [clickhealthpharma].[dbo].[flyway_schema_history] (
    [installed_rank] INT NOT NULL,
    [version] NVARCHAR(50),
    [description] NVARCHAR(200),
    [type] NVARCHAR(20) NOT NULL,
    [script] NVARCHAR(1000) NOT NULL,
    [checksum] INT,
    [installed_by] NVARCHAR(100) NOT NULL,
    [installed_on] DATETIME NOT NULL DEFAULT GETDATE(),
    [execution_time] INT NOT NULL,
    [success] BIT NOT NULL
);
ALTER TABLE [clickhealthpharma].[dbo].[flyway_schema_history] ADD CONSTRAINT [flyway_schema_history_pk] PRIMARY KEY ([installed_rank]);
CREATE INDEX [flyway_schema_history_s_idx] ON [clickhealthpharma].[dbo].[flyway_schema_history] ([success]);
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.JdbcTableSchemaHistory - Created Schema History table [clickhealthpharma].[dbo].[flyway_schema_history]
2025-06-01 03:22:09 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: << Empty Schema >>
2025-06-01 03:22:09 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V1__init_schema.sql ...
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Drop existing tables in reverse order of dependencies to avoid FK conflicts
IF OBJECT_ID('sale_items', 'U') IS NOT NULL DROP TABLE sale_items;
IF OBJECT_ID('sales', 'U') IS NOT NULL DROP TABLE sales;
IF OBJECT_ID('purchase_items', 'U') IS NOT NULL DROP TABLE purchase_items;
IF OBJECT_ID('purchases', 'U') IS NOT NULL DROP TABLE purchases;
IF OBJECT_ID('medicines', 'U') IS NOT NULL DROP TABLE medicines;
IF OBJECT_ID('suppliers', 'U') IS NOT NULL DROP TABLE suppliers;
IF OBJECT_ID('customers', 'U') IS NOT NULL DROP TABLE customers;
IF OBJECT_ID('users', 'U') IS NOT NULL DROP TABLE users;

-- Customers
CREATE TABLE customers (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255),
    phone VARCHAR(50) NOT NULL,
    address VARCHAR(255),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100)
);

-- Suppliers
CREATE TABLE suppliers (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    contact_email VARCHAR(255) NOT NULL,
    phone VARCHAR(50) NOT NULL,
    address VARCHAR(255),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100)
);

-- Medicines
CREATE TABLE medicines (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    batch_number VARCHAR(255) NOT NULL,
    expiry_date DATE NOT NULL,
    quantity INT NOT NULL CHECK (quantity >= 0),
    price DECIMAL(10, 2) NOT NULL CHECK (price > 0),
    supplier_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
);

-- Purchases
CREATE TABLE purchases (
    id INT IDENTITY PRIMARY KEY,
    supplier_id INT NOT NULL,
    purchase_date DATETIME2 NOT NULL,
    total_amount DECIMAL(10, 2),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
);

-- Purchase Items
CREATE TABLE purchase_items (
    id BIGINT IDENTITY PRIMARY KEY,
    medicine_id INT NOT NULL,
    quantity INT NOT NULL,
    cost DECIMAL(10, 2) NOT NULL,
    purchase_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (medicine_id) REFERENCES medicines(id),
    FOREIGN KEY (purchase_id) REFERENCES purchases(id)
);

-- Sales
CREATE TABLE sales (
    id INT IDENTITY PRIMARY KEY,
    customer_id INT NOT NULL,
    sale_date DATETIMEOFFSET NOT NULL,
    total_amount DECIMAL(10, 2),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (customer_id) REFERENCES customers(id)
);

-- Sale Items
CREATE TABLE sale_items (
    id BIGINT IDENTITY PRIMARY KEY,
    medicine_id INT NOT NULL,
    quantity INT NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    sale_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (medicine_id) REFERENCES medicines(id),
    FOREIGN KEY (sale_id) REFERENCES sales(id)
);

-- Users
CREATE TABLE users (
    id INT IDENTITY PRIMARY KEY,
    username VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(50) NOT NULL,
    status VARCHAR(50),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100)
);
2025-06-01 03:22:09 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "1 - init schema" ...
2025-06-01 03:22:09 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "1 - init schema"
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Drop existing tables in reverse order of dependencies to avoid FK conflicts
IF OBJECT_ID('sale_items', 'U') IS NOT NULL DROP TABLE sale_items;
IF OBJECT_ID('sales', 'U') IS NOT NULL DROP TABLE sales;
IF OBJECT_ID('purchase_items', 'U') IS NOT NULL DROP TABLE purchase_items;
IF OBJECT_ID('purchases', 'U') IS NOT NULL DROP TABLE purchases;
IF OBJECT_ID('medicines', 'U') IS NOT NULL DROP TABLE medicines;
IF OBJECT_ID('suppliers', 'U') IS NOT NULL DROP TABLE suppliers;
IF OBJECT_ID('customers', 'U') IS NOT NULL DROP TABLE customers;
IF OBJECT_ID('users', 'U') IS NOT NULL DROP TABLE users;

-- Customers
CREATE TABLE customers (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255),
    phone VARCHAR(50) NOT NULL,
    address VARCHAR(255),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100)
);

-- Suppliers
CREATE TABLE suppliers (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    contact_email VARCHAR(255) NOT NULL,
    phone VARCHAR(50) NOT NULL,
    address VARCHAR(255),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100)
);

-- Medicines
CREATE TABLE medicines (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    batch_number VARCHAR(255) NOT NULL,
    expiry_date DATE NOT NULL,
    quantity INT NOT NULL CHECK (quantity >= 0),
    price DECIMAL(10, 2) NOT NULL CHECK (price > 0),
    supplier_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
);

-- Purchases
CREATE TABLE purchases (
    id INT IDENTITY PRIMARY KEY,
    supplier_id INT NOT NULL,
    purchase_date DATETIME2 NOT NULL,
    total_amount DECIMAL(10, 2),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
);

-- Purchase Items
CREATE TABLE purchase_items (
    id BIGINT IDENTITY PRIMARY KEY,
    medicine_id INT NOT NULL,
    quantity INT NOT NULL,
    cost DECIMAL(10, 2) NOT NULL,
    purchase_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (medicine_id) REFERENCES medicines(id),
    FOREIGN KEY (purchase_id) REFERENCES purchases(id)
);

-- Sales
CREATE TABLE sales (
    id INT IDENTITY PRIMARY KEY,
    customer_id INT NOT NULL,
    sale_date DATETIMEOFFSET NOT NULL,
    total_amount DECIMAL(10, 2),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (customer_id) REFERENCES customers(id)
);

-- Sale Items
CREATE TABLE sale_items (
    id BIGINT IDENTITY PRIMARY KEY,
    medicine_id INT NOT NULL,
    quantity INT NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    sale_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (medicine_id) REFERENCES medicines(id),
    FOREIGN KEY (sale_id) REFERENCES sales(id)
);

-- Users
CREATE TABLE users (
    id INT IDENTITY PRIMARY KEY,
    username VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(50) NOT NULL,
    status VARCHAR(50),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100)
);
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 03:22:09 [main] DEBUG o.f.core.internal.command.DbMigrate - Successfully completed migration of schema [dbo] to version "1 - init schema"
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.JdbcTableSchemaHistory - Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] successfully updated to reflect changes
2025-06-01 03:22:09 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V2__insert_demo_data.sql ...
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert demo Users
INSERT INTO users (username, password, role, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2
2025-06-01 03:22:09 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "2 - insert demo data" ...
2025-06-01 03:22:09 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "2 - insert demo data"
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert demo Users
INSERT INTO users (username, password, role, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 2 rows affected
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 2 rows affected
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 2 rows affected
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 2 rows affected
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 2 rows affected
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 2 rows affected
2025-06-01 03:22:09 [main] DEBUG o.f.core.internal.command.DbMigrate - Successfully completed migration of schema [dbo] to version "2 - insert demo data"
2025-06-01 03:22:09 [main] DEBUG o.f.c.i.s.JdbcTableSchemaHistory - Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] successfully updated to reflect changes
2025-06-01 03:22:09 [main] INFO  o.f.core.internal.command.DbMigrate - Successfully applied 2 migrations to schema [dbo], now at version v2 (execution time 00:00.167s)
2025-06-01 03:22:09 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 22 of 88M
2025-06-01 03:22:10 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 03:22:10 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 03:22:10 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 03:22:11 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 03:22:11 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 03:22:13 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 03:22:13 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 03:22:14 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 03:22:15 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 03:22:15 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 03:22:16 [main] INFO  com.clickhealth.pharma.Application - Started Application in 14.18 seconds (process running for 14.581)
2025-06-01 03:22:46 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-01 03:22:46 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-01 03:22:46 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-01 03:22:46 [http-nio-8080-exec-1] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@672945702 wrapping ConnectionID:1 ClientConnectionId: 34b67b1d-c020-4b1d-8db7-751834295981] read-only
2025-06-01 03:22:46 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - select me1_0.id,me1_0.batch_number,me1_0.created_at,me1_0.created_by,me1_0.expiry_date,me1_0.name,me1_0.price,me1_0.quantity,me1_0.supplier_id,me1_0.updated_at,me1_0.updated_by from medicines me1_0 where me1_0.id=?
2025-06-01 03:22:46 [http-nio-8080-exec-1] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@672945702 wrapping ConnectionID:1 ClientConnectionId: 34b67b1d-c020-4b1d-8db7-751834295981]
2025-06-01 03:23:12 [http-nio-8080-exec-2] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1681630212 wrapping ConnectionID:1 ClientConnectionId: 34b67b1d-c020-4b1d-8db7-751834295981] read-only
2025-06-01 03:23:12 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - select me1_0.id,me1_0.batch_number,me1_0.created_at,me1_0.created_by,me1_0.expiry_date,me1_0.name,me1_0.price,me1_0.quantity,me1_0.supplier_id,me1_0.updated_at,me1_0.updated_by from medicines me1_0
2025-06-01 03:23:12 [http-nio-8080-exec-2] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1681630212 wrapping ConnectionID:1 ClientConnectionId: 34b67b1d-c020-4b1d-8db7-751834295981]
2025-06-01 03:33:34 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 03:33:34 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 03:33:34 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 03:33:58 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 03:33:58 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 34813 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 03:33:58 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 03:34:01 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 03:34:01 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 200 ms. Found 6 JPA repository interfaces.
2025-06-01 03:34:03 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 03:34:03 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 03:34:03 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 03:34:03 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 03:34:03 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 03:34:03 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4038 ms
2025-06-01 03:34:03 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 03:34:04 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: d3bee378-d605-435c-a913-aaf002ac7e19
2025-06-01 03:34:04 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 03:34:04 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 03:34:04 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 03:34:04 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 03:34:04 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 03:34:04 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 03:34:04 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 03:34:04 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 03:34:04 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 03:34:04 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 03:34:04 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 03:34:04 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 03:34:04 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__insert_demo_data.sql
2025-06-01 03:34:04 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 03:34:04 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 03:34:04 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__insert_demo_data.sql
2025-06-01 03:34:04 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 03:34:04 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 03:34:04 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 03:34:04 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 03:34:04 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 03:34:04 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 03:34:04 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 03:34:04 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 03:34:04 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 03:34:04 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 03:34:04 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 03:34:04 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 03:34:04 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 03:34:04 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 03:34:04 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 03:34:04 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 03:34:04 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.111s)
2025-06-01 03:34:04 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 03:34:04 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 2
2025-06-01 03:34:04 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 03:34:04 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 22 of 80M
2025-06-01 03:34:05 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 03:34:05 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 03:34:05 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 03:34:05 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 03:34:06 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 03:34:08 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 03:34:08 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 03:34:09 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 03:34:10 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 03:34:10 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 03:34:10 [main] INFO  com.clickhealth.pharma.Application - Started Application in 12.922 seconds (process running for 13.362)
2025-06-01 03:34:15 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-01 03:34:15 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-01 03:34:15 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 3 ms
2025-06-01 03:34:17 [http-nio-8080-exec-9] INFO  o.s.api.AbstractOpenApiResource - Init duration for springdoc-openapi is: 1506 ms
2025-06-01 03:34:56 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - insert into medicines (batch_number,created_at,created_by,expiry_date,name,price,quantity,supplier_id,updated_at,updated_by) values (?,?,?,?,?,?,?,?,?,?)
2025-06-01 03:34:56 [http-nio-8080-exec-10] INFO  c.c.p.s.impl.MedicineServiceImpl - Created medicine: Dolo
2025-06-01 03:38:51 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1841508272 wrapping ConnectionID:1 ClientConnectionId: d3bee378-d605-435c-a913-aaf002ac7e19] read-only
2025-06-01 03:38:51 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - select me1_0.id,me1_0.batch_number,me1_0.created_at,me1_0.created_by,me1_0.expiry_date,me1_0.name,me1_0.price,me1_0.quantity,me1_0.supplier_id,me1_0.updated_at,me1_0.updated_by from medicines me1_0
2025-06-01 03:38:51 [http-nio-8080-exec-3] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1841508272 wrapping ConnectionID:1 ClientConnectionId: d3bee378-d605-435c-a913-aaf002ac7e19]
2025-06-01 03:39:02 [http-nio-8080-exec-4] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@2123845822 wrapping ConnectionID:1 ClientConnectionId: d3bee378-d605-435c-a913-aaf002ac7e19] read-only
2025-06-01 03:39:02 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - select me1_0.id,me1_0.batch_number,me1_0.created_at,me1_0.created_by,me1_0.expiry_date,me1_0.name,me1_0.price,me1_0.quantity,me1_0.supplier_id,me1_0.updated_at,me1_0.updated_by from medicines me1_0 where me1_0.id=?
2025-06-01 03:39:02 [http-nio-8080-exec-4] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@2123845822 wrapping ConnectionID:1 ClientConnectionId: d3bee378-d605-435c-a913-aaf002ac7e19]
2025-06-01 04:07:08 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 04:07:08 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 04:07:08 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 04:07:27 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 04:07:27 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 38399 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 04:07:27 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 04:07:30 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 04:07:30 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 154 ms. Found 6 JPA repository interfaces.
2025-06-01 04:07:31 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 04:07:31 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 04:07:31 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 04:07:31 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 04:07:31 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 04:07:31 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3789 ms
2025-06-01 04:07:32 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 04:07:32 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: ff8c9295-2774-42c1-8e9c-f1b89381b844
2025-06-01 04:07:32 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 04:07:33 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 04:07:33 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 04:07:33 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__insert_demo_data.sql
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__add_pharmacy_and_link_users.sql
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 04:07:33 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__insert_demo_data.sql
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__add_pharmacy_and_link_users.sql
2025-06-01 04:07:33 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 04:07:33 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 04:07:33 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 04:07:33 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:07:33 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 04:07:33 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:07:33 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:07:33 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:07:33 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:07:33 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:07:33 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:07:33 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:07:33 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:07:33 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:07:33 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.110s)
2025-06-01 04:07:33 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 04:07:33 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 2
2025-06-01 04:07:33 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V3__add_pharmacy_and_link_users.sql ...
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Step 1: Create pharmacies table
CREATE TABLE pharmacies (
    id INT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Step 2: Insert default pharmacy with ID 0
SET IDENTITY_INSERT pharmacies ON;
INSERT INTO pharmacies (id, name, address, created_by, updated_by)
VALUES (0, 'Default Pharmacy', 'N/A', 'system', 'system');
SET IDENTITY_INSERT pharmacies OFF;

-- Step 3: Add pharmacy_id to users table with default 0
ALTER TABLE users
ADD pharmacy_id INT NOT NULL DEFAULT 0;

-- Step 4: Add foreign key constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy
FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);
2025-06-01 04:07:33 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "3 - add pharmacy and link users" ...
2025-06-01 04:07:33 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "3 - add pharmacy and link users"
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Step 1: Create pharmacies table
CREATE TABLE pharmacies (
    id INT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Step 2: Insert default pharmacy with ID 0
SET IDENTITY_INSERT pharmacies ON;
INSERT INTO pharmacies (id, name, address, created_by, updated_by)
VALUES (0, 'Default Pharmacy', 'N/A', 'system', 'system');
SET IDENTITY_INSERT pharmacies OFF;

-- Step 3: Add pharmacy_id to users table with default 0
ALTER TABLE users
ADD pharmacy_id INT NOT NULL DEFAULT 0;

-- Step 4: Add foreign key constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy
FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Rolling back transaction...
2025-06-01 04:07:33 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Transaction rolled back
2025-06-01 04:07:33 [main] ERROR o.f.core.internal.command.DbMigrate - Migration of schema [dbo] to version "3 - add pharmacy and link users" failed! Changes successfully rolled back.
2025-06-01 04:07:33 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 21 of 88M
2025-06-01 04:07:33 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 8106
Message    : Table 'pharmacies' does not have the identity property. Cannot perform SET operation.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Step 1: Create pharmacies table
CREATE TABLE pharmacies (
    id INT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Step 2: Insert default pharmacy with ID 0
SET IDENTITY_INSERT pharmacies ON;
INSERT INTO pharmacies (id, name, address, created_by, updated_by)
VALUES (0, 'Default Pharmacy', 'N/A', 'system', 'system');
SET IDENTITY_INSERT pharmacies OFF;

-- Step 3: Add pharmacy_id to users table with default 0
ALTER TABLE users
ADD pharmacy_id INT NOT NULL DEFAULT 0;

-- Step 4: Add foreign key constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy
FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

2025-06-01 04:07:33 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 04:07:33 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 04:07:33 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 04:07:33 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 04:07:33 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 8106
Message    : Table 'pharmacies' does not have the identity property. Cannot perform SET operation.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Step 1: Create pharmacies table
CREATE TABLE pharmacies (
    id INT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Step 2: Insert default pharmacy with ID 0
SET IDENTITY_INSERT pharmacies ON;
INSERT INTO pharmacies (id, name, address, created_by, updated_by)
VALUES (0, 'Default Pharmacy', 'N/A', 'system', 'system');
SET IDENTITY_INSERT pharmacies OFF;

-- Step 3: Add pharmacy_id to users table with default 0
ALTER TABLE users
ADD pharmacy_id INT NOT NULL DEFAULT 0;

-- Step 4: Add foreign key constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy
FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 8106
Message    : Table 'pharmacies' does not have the identity property. Cannot perform SET operation.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Step 1: Create pharmacies table
CREATE TABLE pharmacies (
    id INT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Step 2: Insert default pharmacy with ID 0
SET IDENTITY_INSERT pharmacies ON;
INSERT INTO pharmacies (id, name, address, created_by, updated_by)
VALUES (0, 'Default Pharmacy', 'N/A', 'system', 'system');
SET IDENTITY_INSERT pharmacies OFF;

-- Step 3: Add pharmacy_id to users table with default 0
ALTER TABLE users
ADD pharmacy_id INT NOT NULL DEFAULT 0;

-- Step 4: Add foreign key constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy
FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.database.sqlserver.SQLServerApplicationLockTemplate.execute(SQLServerApplicationLockTemplate.java:61)
	at org.flywaydb.database.sqlserver.SQLServerConnection.lock(SQLServerConnection.java:93)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:144)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:188)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:213)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:140)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 25 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 8106
Message    : Table 'pharmacies' does not have the identity property. Cannot perform SET operation.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Step 1: Create pharmacies table
CREATE TABLE pharmacies (
    id INT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Step 2: Insert default pharmacy with ID 0
SET IDENTITY_INSERT pharmacies ON;
INSERT INTO pharmacies (id, name, address, created_by, updated_by)
VALUES (0, 'Default Pharmacy', 'N/A', 'system', 'system');
SET IDENTITY_INSERT pharmacies OFF;

-- Step 3: Add pharmacy_id to users table with default 0
ALTER TABLE users
ADD pharmacy_id INT NOT NULL DEFAULT 0;

-- Step 4: Add foreign key constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy
FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:267)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:222)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:126)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:68)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 41 common frames omitted
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: Table 'pharmacies' does not have the identity property. Cannot perform SET operation.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getMoreResults(SQLServerStatement.java:1406)
	at com.zaxxer.hikari.pool.HikariProxyStatement.getMoreResults(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.extractResults(JdbcTemplate.java:270)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:202)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:95)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:210)
	... 47 common frames omitted
2025-06-01 04:10:34 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 04:10:34 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 38706 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 04:10:34 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 04:10:35 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 04:10:35 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 73 ms. Found 6 JPA repository interfaces.
2025-06-01 04:10:36 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 04:10:36 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 04:10:36 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 04:10:36 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 04:10:36 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 04:10:36 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1676 ms
2025-06-01 04:10:36 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 04:10:36 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: eab81027-debf-40a5-8808-227c61a798c1
2025-06-01 04:10:36 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 04:10:36 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 04:10:36 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 04:10:36 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 04:10:36 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 04:10:36 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:10:36 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 04:10:36 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 04:10:36 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:10:36 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 04:10:36 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 04:10:36 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 04:10:36 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__insert_demo_data.sql
2025-06-01 04:10:36 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__add_pharmacy_and_link_users.sql
2025-06-01 04:10:36 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 04:10:36 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:10:36 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__insert_demo_data.sql
2025-06-01 04:10:36 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 04:10:36 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__add_pharmacy_and_link_users.sql
2025-06-01 04:10:36 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 04:10:36 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 04:10:36 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 04:10:36 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 04:10:36 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 04:10:36 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 04:10:36 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:10:37 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 04:10:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:10:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:10:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:10:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:10:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:10:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:10:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:10:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:10:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:10:37 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.047s)
2025-06-01 04:10:37 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 04:10:37 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 2
2025-06-01 04:10:37 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V3__add_pharmacy_and_link_users.sql ...
2025-06-01 04:10:37 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Step 1: Create pharmacies table
CREATE TABLE pharmacies (
    id INT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Step 2: Insert default pharmacy with ID 0
SET IDENTITY_INSERT pharmacies ON;
INSERT INTO pharmacies (id, name, address, created_by, updated_by)
VALUES (0, 'Default Pharmacy', 'N/A', 'system', 'system');
SET IDENTITY_INSERT pharmacies OFF;

-- Step 3: Add pharmacy_id to users table with default 0
ALTER TABLE users
ADD pharmacy_id INT NOT NULL DEFAULT 0;

-- Step 4: Add foreign key constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy
FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);
2025-06-01 04:10:37 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "3 - add pharmacy and link users" ...
2025-06-01 04:10:37 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "3 - add pharmacy and link users"
2025-06-01 04:10:37 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Step 1: Create pharmacies table
CREATE TABLE pharmacies (
    id INT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Step 2: Insert default pharmacy with ID 0
SET IDENTITY_INSERT pharmacies ON;
INSERT INTO pharmacies (id, name, address, created_by, updated_by)
VALUES (0, 'Default Pharmacy', 'N/A', 'system', 'system');
SET IDENTITY_INSERT pharmacies OFF;

-- Step 3: Add pharmacy_id to users table with default 0
ALTER TABLE users
ADD pharmacy_id INT NOT NULL DEFAULT 0;

-- Step 4: Add foreign key constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy
FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);
2025-06-01 04:10:37 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Rolling back transaction...
2025-06-01 04:10:37 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Transaction rolled back
2025-06-01 04:10:37 [main] ERROR o.f.core.internal.command.DbMigrate - Migration of schema [dbo] to version "3 - add pharmacy and link users" failed! Changes successfully rolled back.
2025-06-01 04:10:37 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 21 of 80M
2025-06-01 04:10:37 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 8106
Message    : Table 'pharmacies' does not have the identity property. Cannot perform SET operation.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Step 1: Create pharmacies table
CREATE TABLE pharmacies (
    id INT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Step 2: Insert default pharmacy with ID 0
SET IDENTITY_INSERT pharmacies ON;
INSERT INTO pharmacies (id, name, address, created_by, updated_by)
VALUES (0, 'Default Pharmacy', 'N/A', 'system', 'system');
SET IDENTITY_INSERT pharmacies OFF;

-- Step 3: Add pharmacy_id to users table with default 0
ALTER TABLE users
ADD pharmacy_id INT NOT NULL DEFAULT 0;

-- Step 4: Add foreign key constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy
FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

2025-06-01 04:10:37 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 04:10:37 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 04:10:37 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 04:10:37 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 04:10:37 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 8106
Message    : Table 'pharmacies' does not have the identity property. Cannot perform SET operation.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Step 1: Create pharmacies table
CREATE TABLE pharmacies (
    id INT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Step 2: Insert default pharmacy with ID 0
SET IDENTITY_INSERT pharmacies ON;
INSERT INTO pharmacies (id, name, address, created_by, updated_by)
VALUES (0, 'Default Pharmacy', 'N/A', 'system', 'system');
SET IDENTITY_INSERT pharmacies OFF;

-- Step 3: Add pharmacy_id to users table with default 0
ALTER TABLE users
ADD pharmacy_id INT NOT NULL DEFAULT 0;

-- Step 4: Add foreign key constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy
FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 8106
Message    : Table 'pharmacies' does not have the identity property. Cannot perform SET operation.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Step 1: Create pharmacies table
CREATE TABLE pharmacies (
    id INT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Step 2: Insert default pharmacy with ID 0
SET IDENTITY_INSERT pharmacies ON;
INSERT INTO pharmacies (id, name, address, created_by, updated_by)
VALUES (0, 'Default Pharmacy', 'N/A', 'system', 'system');
SET IDENTITY_INSERT pharmacies OFF;

-- Step 3: Add pharmacy_id to users table with default 0
ALTER TABLE users
ADD pharmacy_id INT NOT NULL DEFAULT 0;

-- Step 4: Add foreign key constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy
FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.database.sqlserver.SQLServerApplicationLockTemplate.execute(SQLServerApplicationLockTemplate.java:61)
	at org.flywaydb.database.sqlserver.SQLServerConnection.lock(SQLServerConnection.java:93)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:144)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:188)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:213)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:140)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 25 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 8106
Message    : Table 'pharmacies' does not have the identity property. Cannot perform SET operation.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Step 1: Create pharmacies table
CREATE TABLE pharmacies (
    id INT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Step 2: Insert default pharmacy with ID 0
SET IDENTITY_INSERT pharmacies ON;
INSERT INTO pharmacies (id, name, address, created_by, updated_by)
VALUES (0, 'Default Pharmacy', 'N/A', 'system', 'system');
SET IDENTITY_INSERT pharmacies OFF;

-- Step 3: Add pharmacy_id to users table with default 0
ALTER TABLE users
ADD pharmacy_id INT NOT NULL DEFAULT 0;

-- Step 4: Add foreign key constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy
FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:267)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:222)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:126)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:68)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 41 common frames omitted
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: Table 'pharmacies' does not have the identity property. Cannot perform SET operation.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getMoreResults(SQLServerStatement.java:1406)
	at com.zaxxer.hikari.pool.HikariProxyStatement.getMoreResults(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.extractResults(JdbcTemplate.java:270)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:202)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:95)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:210)
	... 47 common frames omitted
2025-06-01 04:12:11 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 04:12:11 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 38960 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 04:12:11 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 04:12:14 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 04:12:14 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 181 ms. Found 6 JPA repository interfaces.
2025-06-01 04:12:15 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 04:12:15 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 04:12:15 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 04:12:15 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 04:12:16 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 04:12:16 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4179 ms
2025-06-01 04:12:16 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 04:12:17 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: eb715a6e-2f04-4d2a-9f4a-336200e6bed2
2025-06-01 04:12:17 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 04:12:17 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 04:12:17 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 04:12:17 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__insert_demo_data.sql
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__add_pharmacy_and_link_users.sql
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 04:12:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__insert_demo_data.sql
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__add_pharmacy_and_link_users.sql
2025-06-01 04:12:17 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 04:12:17 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 04:12:17 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 04:12:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:12:17 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 04:12:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:12:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:12:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:12:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:12:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:12:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:12:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:12:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:12:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:12:17 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.113s)
2025-06-01 04:12:17 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 04:12:17 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 2
2025-06-01 04:12:17 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V3__add_pharmacy_and_link_users.sql ...
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 1: CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert dummy row with ID = 0 (only if needed)
-- You CANNOT insert 0 into an IDENTITY column by default
-- So either:
--    - start identity at 0 (not supported directly in SQL Server)
--    - or avoid inserting ID = 0 and use a real ID

-- Simplest: insert a real pharmacy (not id = 0)
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

ALTER TABLE users
ADD pharmacy_id INT;

UPDATE users SET pharmacy_id = 1; -- Or whatever the new inserted pharmacy ID is

ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);
2025-06-01 04:12:17 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "3 - add pharmacy and link users" ...
2025-06-01 04:12:17 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "3 - add pharmacy and link users"
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert dummy row with ID = 0 (only if needed)
-- You CANNOT insert 0 into an IDENTITY column by default
-- So either:
--    - start identity at 0 (not supported directly in SQL Server)
--    - or avoid inserting ID = 0 and use a real ID

-- Simplest: insert a real pharmacy (not id = 0)
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

ALTER TABLE users
ADD pharmacy_id INT;

UPDATE users SET pharmacy_id = 1; -- Or whatever the new inserted pharmacy ID is

ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Rolling back transaction...
2025-06-01 04:12:17 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Transaction rolled back
2025-06-01 04:12:17 [main] ERROR o.f.core.internal.command.DbMigrate - Migration of schema [dbo] to version "3 - add pharmacy and link users" failed! Changes successfully rolled back.
2025-06-01 04:12:17 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 22 of 80M
2025-06-01 04:12:17 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'pharmacy_id'.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 1
Statement  : CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert dummy row with ID = 0 (only if needed)
-- You CANNOT insert 0 into an IDENTITY column by default
-- So either:
--    - start identity at 0 (not supported directly in SQL Server)
--    - or avoid inserting ID = 0 and use a real ID

-- Simplest: insert a real pharmacy (not id = 0)
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

ALTER TABLE users
ADD pharmacy_id INT;

UPDATE users SET pharmacy_id = 1; -- Or whatever the new inserted pharmacy ID is

ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

2025-06-01 04:12:17 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 04:12:17 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 04:12:17 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 04:12:17 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 04:12:18 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'pharmacy_id'.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 1
Statement  : CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert dummy row with ID = 0 (only if needed)
-- You CANNOT insert 0 into an IDENTITY column by default
-- So either:
--    - start identity at 0 (not supported directly in SQL Server)
--    - or avoid inserting ID = 0 and use a real ID

-- Simplest: insert a real pharmacy (not id = 0)
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

ALTER TABLE users
ADD pharmacy_id INT;

UPDATE users SET pharmacy_id = 1; -- Or whatever the new inserted pharmacy ID is

ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'pharmacy_id'.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 1
Statement  : CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert dummy row with ID = 0 (only if needed)
-- You CANNOT insert 0 into an IDENTITY column by default
-- So either:
--    - start identity at 0 (not supported directly in SQL Server)
--    - or avoid inserting ID = 0 and use a real ID

-- Simplest: insert a real pharmacy (not id = 0)
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

ALTER TABLE users
ADD pharmacy_id INT;

UPDATE users SET pharmacy_id = 1; -- Or whatever the new inserted pharmacy ID is

ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.database.sqlserver.SQLServerApplicationLockTemplate.execute(SQLServerApplicationLockTemplate.java:61)
	at org.flywaydb.database.sqlserver.SQLServerConnection.lock(SQLServerConnection.java:93)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:144)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:188)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:213)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:140)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 25 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'pharmacy_id'.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 1
Statement  : CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert dummy row with ID = 0 (only if needed)
-- You CANNOT insert 0 into an IDENTITY column by default
-- So either:
--    - start identity at 0 (not supported directly in SQL Server)
--    - or avoid inserting ID = 0 and use a real ID

-- Simplest: insert a real pharmacy (not id = 0)
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

ALTER TABLE users
ADD pharmacy_id INT;

UPDATE users SET pharmacy_id = 1; -- Or whatever the new inserted pharmacy ID is

ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:267)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:222)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:126)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:68)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 41 common frames omitted
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: Invalid column name 'pharmacy_id'.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.doExecuteStatement(SQLServerStatement.java:920)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement$StmtExecCmd.doExecute(SQLServerStatement.java:814)
	at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:7675)
	at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:4137)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLServerStatement.java:272)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLServerStatement.java:246)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.execute(SQLServerStatement.java:787)
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:94)
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:201)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:95)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:210)
	... 47 common frames omitted
2025-06-01 04:15:02 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 04:15:02 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 39319 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 04:15:02 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 04:15:05 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 04:15:05 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 200 ms. Found 6 JPA repository interfaces.
2025-06-01 04:15:07 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 04:15:07 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 04:15:07 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 04:15:07 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 04:15:07 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 04:15:07 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4072 ms
2025-06-01 04:15:07 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 04:15:08 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 61c6a314-a7cb-440d-a863-244de7d54a3b
2025-06-01 04:15:08 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 04:15:08 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 04:15:08 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 04:15:08 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__insert_demo_data.sql
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__add_pharmacy_and_link_users.sql
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 04:15:08 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__insert_demo_data.sql
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__add_pharmacy_and_link_users.sql
2025-06-01 04:15:08 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 04:15:08 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 04:15:08 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 04:15:08 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:15:08 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 04:15:08 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:15:08 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:15:08 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:15:08 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:15:08 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:15:08 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:15:08 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:15:08 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:15:08 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:15:08 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.091s)
2025-06-01 04:15:08 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 04:15:08 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 2
2025-06-01 04:15:08 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V3__add_pharmacy_and_link_users.sql ...
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

-- Add FK constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);
2025-06-01 04:15:08 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "3 - add pharmacy and link users" ...
2025-06-01 04:15:08 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "3 - add pharmacy and link users"
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

-- Add FK constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Rolling back transaction...
2025-06-01 04:15:08 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Transaction rolled back
2025-06-01 04:15:08 [main] ERROR o.f.core.internal.command.DbMigrate - Migration of schema [dbo] to version "3 - add pharmacy and link users" failed! Changes successfully rolled back.
2025-06-01 04:15:08 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 21 of 80M
2025-06-01 04:15:08 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'pharmacy_id'.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

-- Add FK constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

2025-06-01 04:15:08 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 04:15:08 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 04:15:08 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 04:15:08 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 04:15:08 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'pharmacy_id'.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

-- Add FK constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'pharmacy_id'.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

-- Add FK constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.database.sqlserver.SQLServerApplicationLockTemplate.execute(SQLServerApplicationLockTemplate.java:61)
	at org.flywaydb.database.sqlserver.SQLServerConnection.lock(SQLServerConnection.java:93)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:144)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:188)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:213)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:140)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 25 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'pharmacy_id'.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

-- Add FK constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:267)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:222)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:126)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:68)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 41 common frames omitted
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: Invalid column name 'pharmacy_id'.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.doExecuteStatement(SQLServerStatement.java:920)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement$StmtExecCmd.doExecute(SQLServerStatement.java:814)
	at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:7675)
	at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:4137)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLServerStatement.java:272)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLServerStatement.java:246)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.execute(SQLServerStatement.java:787)
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:94)
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:201)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:95)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:210)
	... 47 common frames omitted
2025-06-01 04:15:38 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 04:15:38 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 39436 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 04:15:38 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 04:15:39 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 04:15:40 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 75 ms. Found 6 JPA repository interfaces.
2025-06-01 04:15:40 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 04:15:40 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 04:15:40 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 04:15:40 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 04:15:40 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 04:15:40 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1757 ms
2025-06-01 04:15:40 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 04:15:41 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 71279a78-0bde-4a97-92cf-3d748889358c
2025-06-01 04:15:41 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 04:15:41 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 04:15:41 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 04:15:41 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__insert_demo_data.sql
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__add_pharmacy_and_link_users.sql
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 04:15:41 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__insert_demo_data.sql
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__add_pharmacy_and_link_users.sql
2025-06-01 04:15:41 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 04:15:41 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 04:15:41 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 04:15:41 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:15:41 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 04:15:41 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:15:41 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:15:41 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:15:41 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:15:41 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:15:41 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:15:41 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:15:41 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:15:41 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:15:41 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.049s)
2025-06-01 04:15:41 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 04:15:41 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 2
2025-06-01 04:15:41 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V3__add_pharmacy_and_link_users.sql ...
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

-- Add FK constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);
2025-06-01 04:15:41 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "3 - add pharmacy and link users" ...
2025-06-01 04:15:41 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "3 - add pharmacy and link users"
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

-- Add FK constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Rolling back transaction...
2025-06-01 04:15:41 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Transaction rolled back
2025-06-01 04:15:41 [main] ERROR o.f.core.internal.command.DbMigrate - Migration of schema [dbo] to version "3 - add pharmacy and link users" failed! Changes successfully rolled back.
2025-06-01 04:15:41 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 24 of 80M
2025-06-01 04:15:41 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'pharmacy_id'.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

-- Add FK constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

2025-06-01 04:15:41 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 04:15:41 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 04:15:41 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 04:15:41 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 04:15:41 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'pharmacy_id'.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

-- Add FK constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'pharmacy_id'.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

-- Add FK constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.database.sqlserver.SQLServerApplicationLockTemplate.execute(SQLServerApplicationLockTemplate.java:61)
	at org.flywaydb.database.sqlserver.SQLServerConnection.lock(SQLServerConnection.java:93)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:144)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:188)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:213)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:140)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 25 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'pharmacy_id'.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

-- Add FK constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:267)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:222)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:126)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:68)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 41 common frames omitted
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: Invalid column name 'pharmacy_id'.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.doExecuteStatement(SQLServerStatement.java:920)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement$StmtExecCmd.doExecute(SQLServerStatement.java:814)
	at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:7675)
	at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:4137)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLServerStatement.java:272)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLServerStatement.java:246)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.execute(SQLServerStatement.java:787)
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:94)
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:201)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:95)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:210)
	... 47 common frames omitted
2025-06-01 04:16:09 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 04:16:10 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 39600 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 04:16:10 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 04:16:12 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 04:16:12 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 158 ms. Found 6 JPA repository interfaces.
2025-06-01 04:16:14 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 04:16:14 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 04:16:14 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 04:16:14 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 04:16:14 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 04:16:14 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3944 ms
2025-06-01 04:16:14 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 04:16:15 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 299aa789-c100-4470-864d-2a6a285ef172
2025-06-01 04:16:15 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 04:16:15 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 04:16:15 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 04:16:15 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__insert_demo_data.sql
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__add_pharmacy_and_link_users.sql
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 04:16:15 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__insert_demo_data.sql
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__add_pharmacy_and_link_users.sql
2025-06-01 04:16:15 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 04:16:15 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 04:16:15 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 04:16:15 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:16:15 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 04:16:15 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:16:15 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:16:15 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:16:15 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:16:15 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:16:15 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:16:15 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:16:15 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:16:15 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:16:15 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.099s)
2025-06-01 04:16:15 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 04:16:15 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 2
2025-06-01 04:16:15 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V3__add_pharmacy_and_link_users.sql ...
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;
2025-06-01 04:16:15 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "3 - add pharmacy and link users" ...
2025-06-01 04:16:15 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "3 - add pharmacy and link users"
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Rolling back transaction...
2025-06-01 04:16:15 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Transaction rolled back
2025-06-01 04:16:15 [main] ERROR o.f.core.internal.command.DbMigrate - Migration of schema [dbo] to version "3 - add pharmacy and link users" failed! Changes successfully rolled back.
2025-06-01 04:16:16 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 61 of 88M
2025-06-01 04:16:16 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'pharmacy_id'.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

2025-06-01 04:16:16 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 04:16:16 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 04:16:16 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 04:16:16 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 04:16:16 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'pharmacy_id'.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'pharmacy_id'.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.database.sqlserver.SQLServerApplicationLockTemplate.execute(SQLServerApplicationLockTemplate.java:61)
	at org.flywaydb.database.sqlserver.SQLServerConnection.lock(SQLServerConnection.java:93)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:144)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:188)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:213)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:140)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 25 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V3__add_pharmacy_and_link_users.sql failed
----------------------------------------------------
SQL State  : S0001
Error Code : 207
Message    : Invalid column name 'pharmacy_id'.
Location   : db/migration/V3__add_pharmacy_and_link_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__add_pharmacy_and_link_users.sql)
Line       : 2
Statement  : -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;

-- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:267)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:222)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:126)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:68)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 41 common frames omitted
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: Invalid column name 'pharmacy_id'.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.doExecuteStatement(SQLServerStatement.java:920)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement$StmtExecCmd.doExecute(SQLServerStatement.java:814)
	at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:7675)
	at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:4137)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLServerStatement.java:272)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLServerStatement.java:246)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.execute(SQLServerStatement.java:787)
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:94)
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:201)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:95)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:210)
	... 47 common frames omitted
2025-06-01 04:18:00 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 04:18:00 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 39878 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 04:18:00 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 04:18:03 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 04:18:03 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 157 ms. Found 6 JPA repository interfaces.
2025-06-01 04:18:04 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 04:18:04 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 04:18:04 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 04:18:04 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 04:18:04 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 04:18:04 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3839 ms
2025-06-01 04:18:05 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 04:18:05 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 6cbab34d-0763-402a-b8f0-cd9c5de792e8
2025-06-01 04:18:05 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 04:18:06 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 04:18:06 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 04:18:06 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__insert_demo_data.sql
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__add_pharmacy_and_link_users.sql
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V4__add_FK_users.sql
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__insert_demo_data.sql
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V4__add_FK_users.sql
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__add_pharmacy_and_link_users.sql
2025-06-01 04:18:06 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 04:18:06 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 04:18:06 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__add_FK_users.sql (filename: V4__add_FK_users.sql)
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__add_FK_users.sql (filename: V4__add_FK_users.sql)
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:18:06 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.118s)
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 04:18:06 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 2
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V3__add_pharmacy_and_link_users.sql ...
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "3 - add pharmacy and link users" ...
2025-06-01 04:18:06 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "3 - add pharmacy and link users"
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');

-- Add pharmacy_id column to users
ALTER TABLE users
ADD pharmacy_id INT;
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 1 row affected
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.command.DbMigrate - Successfully completed migration of schema [dbo] to version "3 - add pharmacy and link users"
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.JdbcTableSchemaHistory - Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] successfully updated to reflect changes
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V4__add_FK_users.sql ...
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 3: -- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

-- Add FK constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "4 - add FK users" ...
2025-06-01 04:18:06 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "4 - add FK users"
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Now, update the column with default pharmacy id (assuming it's 1)
-- Make sure the inserted row has id = 1 (identity starts at 1)
UPDATE users SET pharmacy_id = 1;

-- Make the column NOT NULL after update
ALTER TABLE users
ALTER COLUMN pharmacy_id INT NOT NULL;

-- Add FK constraint
ALTER TABLE users
ADD CONSTRAINT fk_users_pharmacy FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id);
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 2 rows affected
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 04:18:06 [main] DEBUG o.f.core.internal.command.DbMigrate - Successfully completed migration of schema [dbo] to version "4 - add FK users"
2025-06-01 04:18:06 [main] DEBUG o.f.c.i.s.JdbcTableSchemaHistory - Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] successfully updated to reflect changes
2025-06-01 04:18:06 [main] INFO  o.f.core.internal.command.DbMigrate - Successfully applied 2 migrations to schema [dbo], now at version v4 (execution time 00:00.086s)
2025-06-01 04:18:06 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 62 of 88M
2025-06-01 04:18:07 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 04:18:07 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 04:18:07 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 04:18:09 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 04:18:09 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 04:18:13 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 04:18:13 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 04:18:14 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 04:18:15 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 04:18:15 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 04:18:15 [main] INFO  com.clickhealth.pharma.Application - Started Application in 16.331 seconds (process running for 16.915)
2025-06-01 04:36:28 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 04:36:28 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 04:36:28 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 04:42:11 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 04:42:11 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 42562 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 04:42:11 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 04:42:12 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 04:42:12 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 74 ms. Found 6 JPA repository interfaces.
2025-06-01 04:42:14 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 04:42:14 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 2251 ms
2025-06-01 04:42:14 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 04:42:19 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: bd03874a-32e9-4f9b-bf42-5d997e36cf42
2025-06-01 04:42:19 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 04:42:19 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 04:42:19 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 04:42:19 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__insert_demo_data.sql
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__add_pharmacy_and_link_users.sql
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V4__add_FK_users.sql
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 04:42:19 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__insert_demo_data.sql
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V4__add_FK_users.sql
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__add_pharmacy_and_link_users.sql
2025-06-01 04:42:19 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 04:42:19 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 04:42:19 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 04:42:19 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 04:42:19 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:42:19 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 04:42:19 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:42:19 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:42:19 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:42:19 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__add_FK_users.sql (filename: V4__add_FK_users.sql)
2025-06-01 04:42:19 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:42:19 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:42:19 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:42:19 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:42:19 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__add_FK_users.sql (filename: V4__add_FK_users.sql)
2025-06-01 04:42:19 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:42:19 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:42:19 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.044s)
2025-06-01 04:42:19 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 04:42:19 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 4
2025-06-01 04:42:19 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 04:42:19 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 25 of 88M
2025-06-01 04:42:19 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 04:42:20 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 04:42:20 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 04:42:20 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 04:42:20 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 04:42:21 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 04:42:21 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 04:42:22 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 04:42:22 [main] WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: 44d46997-2fe4-4796-8f95-6bdba7984231

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-06-01 04:42:22 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@68d1f4e2, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@72769bf5, org.springframework.security.web.context.SecurityContextHolderFilter@ab5954d, org.springframework.security.web.header.HeaderWriterFilter@571360b2, org.springframework.web.filter.CorsFilter@5a63de07, org.springframework.security.web.authentication.logout.LogoutFilter@4adb2b87, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@13482361, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@47c06b1a, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@7d364bce, org.springframework.security.web.access.ExceptionTranslationFilter@5e8f1db2, org.springframework.security.web.access.intercept.AuthorizationFilter@c34fd2]
2025-06-01 04:42:22 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 04:42:22 [main] INFO  com.clickhealth.pharma.Application - Started Application in 11.685 seconds (process running for 12.097)
2025-06-01 04:42:22 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 04:42:22 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 04:42:22 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 04:44:03 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 04:44:03 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 42868 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 04:44:03 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 04:44:04 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 04:44:04 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 68 ms. Found 6 JPA repository interfaces.
2025-06-01 04:44:05 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 04:44:05 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 04:44:05 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 04:44:05 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 04:44:05 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 04:44:05 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1815 ms
2025-06-01 04:44:05 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 04:44:05 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: b2a57a09-40ef-494f-b3c6-5ba2554b4e5f
2025-06-01 04:44:05 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 04:44:05 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 04:44:05 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 04:44:05 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__insert_demo_data.sql
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__add_pharmacy_and_link_users.sql
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V4__add_FK_users.sql
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 04:44:05 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__insert_demo_data.sql
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V4__add_FK_users.sql
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__add_pharmacy_and_link_users.sql
2025-06-01 04:44:05 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 04:44:05 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 04:44:05 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 04:44:05 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 04:44:05 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:44:05 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 04:44:05 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:44:05 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:44:05 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:44:05 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__add_FK_users.sql (filename: V4__add_FK_users.sql)
2025-06-01 04:44:05 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:44:05 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:44:05 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 04:44:05 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 04:44:05 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__add_FK_users.sql (filename: V4__add_FK_users.sql)
2025-06-01 04:44:05 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 04:44:05 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__add_pharmacy_and_link_users.sql (filename: V3__add_pharmacy_and_link_users.sql)
2025-06-01 04:44:05 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.047s)
2025-06-01 04:44:05 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 04:44:05 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 4
2025-06-01 04:44:05 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 04:44:05 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 23 of 88M
2025-06-01 04:44:06 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 04:44:06 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 04:44:06 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 04:44:06 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 04:44:06 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 04:44:07 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 04:44:07 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 04:44:08 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 04:44:08 [main] WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: 4eb80a89-342f-4aa5-ab10-3ae8adf7084f

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-06-01 04:44:08 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@1131fcfd, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@46d2be66, org.springframework.security.web.context.SecurityContextHolderFilter@3d94b49d, org.springframework.security.web.header.HeaderWriterFilter@753cfae3, org.springframework.web.filter.CorsFilter@119de68f, org.springframework.security.web.authentication.logout.LogoutFilter@5cc85ffc, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@4203190, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@6add8aac, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@529cd3ba, org.springframework.security.web.access.ExceptionTranslationFilter@25a81f28, org.springframework.security.web.access.intercept.AuthorizationFilter@66d62c59]
2025-06-01 04:44:09 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 04:44:09 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 04:44:09 [main] INFO  com.clickhealth.pharma.Application - Started Application in 6.472 seconds (process running for 6.874)
2025-06-01 04:44:35 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-01 04:44:35 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-01 04:44:35 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-06-01 04:44:37 [http-nio-8080-exec-8] INFO  o.s.api.AbstractOpenApiResource - Init duration for springdoc-openapi is: 1117 ms
2025-06-01 04:47:27 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 04:47:27 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 04:47:27 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 05:45:58 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 05:45:58 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 49929 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 05:45:58 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 05:45:59 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanDefinitionStoreException: Failed to parse configuration class [com.clickhealth.pharma.Application]
2025-06-01 05:45:59 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanDefinitionStoreException: Failed to parse configuration class [com.clickhealth.pharma.Application]
	at org.springframework.context.annotation.ConfigurationClassParser.parse(ConfigurationClassParser.java:179)
	at org.springframework.context.annotation.ConfigurationClassPostProcessor.processConfigBeanDefinitions(ConfigurationClassPostProcessor.java:416)
	at org.springframework.context.annotation.ConfigurationClassPostProcessor.postProcessBeanDefinitionRegistry(ConfigurationClassPostProcessor.java:289)
	at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanDefinitionRegistryPostProcessors(PostProcessorRegistrationDelegate.java:349)
	at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(PostProcessorRegistrationDelegate.java:118)
	at org.springframework.context.support.AbstractApplicationContext.invokeBeanFactoryPostProcessors(AbstractApplicationContext.java:788)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:606)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.springframework.context.annotation.ConflictingBeanDefinitionException: Annotation-specified bean name 'securityConfig' for bean class [com.clickhealth.pharma.security.SecurityConfig] conflicts with existing, non-compatible bean definition of same name and class [com.clickhealth.pharma.config.SecurityConfig]
	at org.springframework.context.annotation.ClassPathBeanDefinitionScanner.checkCandidate(ClassPathBeanDefinitionScanner.java:361)
	at org.springframework.context.annotation.ClassPathBeanDefinitionScanner.doScan(ClassPathBeanDefinitionScanner.java:288)
	at org.springframework.context.annotation.ComponentScanAnnotationParser.parse(ComponentScanAnnotationParser.java:128)
	at org.springframework.context.annotation.ConfigurationClassParser.doProcessConfigurationClass(ConfigurationClassParser.java:306)
	at org.springframework.context.annotation.ConfigurationClassParser.processConfigurationClass(ConfigurationClassParser.java:246)
	at org.springframework.context.annotation.ConfigurationClassParser.parse(ConfigurationClassParser.java:197)
	at org.springframework.context.annotation.ConfigurationClassParser.parse(ConfigurationClassParser.java:165)
	... 20 common frames omitted
2025-06-01 05:50:32 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 05:50:33 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 50478 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 05:50:33 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 05:50:34 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 05:50:34 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 152 ms. Found 6 JPA repository interfaces.
2025-06-01 05:50:36 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 05:50:36 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 05:50:36 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 05:50:36 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 05:50:36 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 05:50:36 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3314 ms
2025-06-01 05:50:37 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 05:50:38 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 32d84052-7b79-42bc-9005-fae1a1430973
2025-06-01 05:50:38 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 05:50:39 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 05:50:39 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 05:50:39 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__insert_demo_data.sql
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 05:50:39 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__insert_demo_data.sql
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 05:50:39 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 05:50:39 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 05:50:39 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 05:50:39 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:50:39 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 05:50:39 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:50:39 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:50:39 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 05:50:39 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 05:50:39 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:50:39 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 05:50:39 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 05:50:39 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Schema history table [clickhealthpharma].[dbo].[flyway_schema_history] does not exist yet
2025-06-01 05:50:39 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.093s)
2025-06-01 05:50:39 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 05:50:39 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Creating Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] ...
2025-06-01 05:50:39 [main] DEBUG o.f.core.internal.parser.Parser - Parsing  ...
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 1: CREATE TABLE [clickhealthpharma].[dbo].[flyway_schema_history] (
    [installed_rank] INT NOT NULL,
    [version] NVARCHAR(50),
    [description] NVARCHAR(200),
    [type] NVARCHAR(20) NOT NULL,
    [script] NVARCHAR(1000) NOT NULL,
    [checksum] INT,
    [installed_by] NVARCHAR(100) NOT NULL,
    [installed_on] DATETIME NOT NULL DEFAULT GETDATE(),
    [execution_time] INT NOT NULL,
    [success] BIT NOT NULL
);
ALTER TABLE [clickhealthpharma].[dbo].[flyway_schema_history] ADD CONSTRAINT [flyway_schema_history_pk] PRIMARY KEY ([installed_rank]);
CREATE INDEX [flyway_schema_history_s_idx] ON [clickhealthpharma].[dbo].[flyway_schema_history] ([success]);
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: CREATE TABLE [clickhealthpharma].[dbo].[flyway_schema_history] (
    [installed_rank] INT NOT NULL,
    [version] NVARCHAR(50),
    [description] NVARCHAR(200),
    [type] NVARCHAR(20) NOT NULL,
    [script] NVARCHAR(1000) NOT NULL,
    [checksum] INT,
    [installed_by] NVARCHAR(100) NOT NULL,
    [installed_on] DATETIME NOT NULL DEFAULT GETDATE(),
    [execution_time] INT NOT NULL,
    [success] BIT NOT NULL
);
ALTER TABLE [clickhealthpharma].[dbo].[flyway_schema_history] ADD CONSTRAINT [flyway_schema_history_pk] PRIMARY KEY ([installed_rank]);
CREATE INDEX [flyway_schema_history_s_idx] ON [clickhealthpharma].[dbo].[flyway_schema_history] ([success]);
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.JdbcTableSchemaHistory - Created Schema History table [clickhealthpharma].[dbo].[flyway_schema_history]
2025-06-01 05:50:39 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: << Empty Schema >>
2025-06-01 05:50:39 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V1__init_schema.sql ...
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Drop existing tables in reverse order of dependencies to avoid FK conflicts
IF OBJECT_ID('sale_items', 'U') IS NOT NULL DROP TABLE sale_items;
IF OBJECT_ID('sales', 'U') IS NOT NULL DROP TABLE sales;
IF OBJECT_ID('purchase_items', 'U') IS NOT NULL DROP TABLE purchase_items;
IF OBJECT_ID('purchases', 'U') IS NOT NULL DROP TABLE purchases;
IF OBJECT_ID('medicines', 'U') IS NOT NULL DROP TABLE medicines;
IF OBJECT_ID('suppliers', 'U') IS NOT NULL DROP TABLE suppliers;
IF OBJECT_ID('customers', 'U') IS NOT NULL DROP TABLE customers;
IF OBJECT_ID('users', 'U') IS NOT NULL DROP TABLE users;
IF OBJECT_ID('pharmacies', 'U') IS NOT NULL DROP TABLE pharmacies;

-- Customers
CREATE TABLE customers (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255),
    phone VARCHAR(50) NOT NULL,
    address VARCHAR(255),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100)
);

-- Suppliers
CREATE TABLE suppliers (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    contact_email VARCHAR(255) NOT NULL,
    phone VARCHAR(50) NOT NULL,
    address VARCHAR(255),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100)
);

-- Medicines
CREATE TABLE medicines (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    batch_number VARCHAR(255) NOT NULL,
    expiry_date DATE NOT NULL,
    quantity INT NOT NULL CHECK (quantity >= 0),
    price DECIMAL(10, 2) NOT NULL CHECK (price > 0),
    supplier_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
);

-- Purchases
CREATE TABLE purchases (
    id INT IDENTITY PRIMARY KEY,
    supplier_id INT NOT NULL,
    purchase_date DATETIME2 NOT NULL,
    total_amount DECIMAL(10, 2),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
);

-- Purchase Items
CREATE TABLE purchase_items (
    id BIGINT IDENTITY PRIMARY KEY,
    medicine_id INT NOT NULL,
    quantity INT NOT NULL,
    cost DECIMAL(10, 2) NOT NULL,
    purchase_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (medicine_id) REFERENCES medicines(id),
    FOREIGN KEY (purchase_id) REFERENCES purchases(id)
);

-- Sales
CREATE TABLE sales (
    id INT IDENTITY PRIMARY KEY,
    customer_id INT NOT NULL,
    sale_date DATETIMEOFFSET NOT NULL,
    total_amount DECIMAL(10, 2),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (customer_id) REFERENCES customers(id)
);

-- Sale Items
CREATE TABLE sale_items (
    id BIGINT IDENTITY PRIMARY KEY,
    medicine_id INT NOT NULL,
    quantity INT NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    sale_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (medicine_id) REFERENCES medicines(id),
    FOREIGN KEY (sale_id) REFERENCES sales(id)
);

-- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Users
CREATE TABLE users (
    id INT IDENTITY PRIMARY KEY,
    username VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(50) NOT NULL,
    status VARCHAR(50) NOT NULL DEFAULT 'ACTIVE',
    pharmacy_id INT NOT NULL,
    last_login_at DATETIMEOFFSET NULL,
    failed_login_attempts INT NOT NULL DEFAULT 0,
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET() NOT NULL,
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100),
    FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id)
);
2025-06-01 05:50:39 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "1 - init schema" ...
2025-06-01 05:50:39 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "1 - init schema"
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Drop existing tables in reverse order of dependencies to avoid FK conflicts
IF OBJECT_ID('sale_items', 'U') IS NOT NULL DROP TABLE sale_items;
IF OBJECT_ID('sales', 'U') IS NOT NULL DROP TABLE sales;
IF OBJECT_ID('purchase_items', 'U') IS NOT NULL DROP TABLE purchase_items;
IF OBJECT_ID('purchases', 'U') IS NOT NULL DROP TABLE purchases;
IF OBJECT_ID('medicines', 'U') IS NOT NULL DROP TABLE medicines;
IF OBJECT_ID('suppliers', 'U') IS NOT NULL DROP TABLE suppliers;
IF OBJECT_ID('customers', 'U') IS NOT NULL DROP TABLE customers;
IF OBJECT_ID('users', 'U') IS NOT NULL DROP TABLE users;
IF OBJECT_ID('pharmacies', 'U') IS NOT NULL DROP TABLE pharmacies;

-- Customers
CREATE TABLE customers (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255),
    phone VARCHAR(50) NOT NULL,
    address VARCHAR(255),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100)
);

-- Suppliers
CREATE TABLE suppliers (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    contact_email VARCHAR(255) NOT NULL,
    phone VARCHAR(50) NOT NULL,
    address VARCHAR(255),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100)
);

-- Medicines
CREATE TABLE medicines (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    batch_number VARCHAR(255) NOT NULL,
    expiry_date DATE NOT NULL,
    quantity INT NOT NULL CHECK (quantity >= 0),
    price DECIMAL(10, 2) NOT NULL CHECK (price > 0),
    supplier_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
);

-- Purchases
CREATE TABLE purchases (
    id INT IDENTITY PRIMARY KEY,
    supplier_id INT NOT NULL,
    purchase_date DATETIME2 NOT NULL,
    total_amount DECIMAL(10, 2),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
);

-- Purchase Items
CREATE TABLE purchase_items (
    id BIGINT IDENTITY PRIMARY KEY,
    medicine_id INT NOT NULL,
    quantity INT NOT NULL,
    cost DECIMAL(10, 2) NOT NULL,
    purchase_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (medicine_id) REFERENCES medicines(id),
    FOREIGN KEY (purchase_id) REFERENCES purchases(id)
);

-- Sales
CREATE TABLE sales (
    id INT IDENTITY PRIMARY KEY,
    customer_id INT NOT NULL,
    sale_date DATETIMEOFFSET NOT NULL,
    total_amount DECIMAL(10, 2),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (customer_id) REFERENCES customers(id)
);

-- Sale Items
CREATE TABLE sale_items (
    id BIGINT IDENTITY PRIMARY KEY,
    medicine_id INT NOT NULL,
    quantity INT NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    sale_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (medicine_id) REFERENCES medicines(id),
    FOREIGN KEY (sale_id) REFERENCES sales(id)
);

-- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Users
CREATE TABLE users (
    id INT IDENTITY PRIMARY KEY,
    username VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(50) NOT NULL,
    status VARCHAR(50) NOT NULL DEFAULT 'ACTIVE',
    pharmacy_id INT NOT NULL,
    last_login_at DATETIMEOFFSET NULL,
    failed_login_attempts INT NOT NULL DEFAULT 0,
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET() NOT NULL,
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100),
    FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id)
);
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 05:50:39 [main] DEBUG o.f.core.internal.command.DbMigrate - Successfully completed migration of schema [dbo] to version "1 - init schema"
2025-06-01 05:50:39 [main] DEBUG o.f.c.i.s.JdbcTableSchemaHistory - Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] successfully updated to reflect changes
2025-06-01 05:50:39 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V2__insert_demo_data.sql ...
2025-06-01 05:50:40 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 1, 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2
2025-06-01 05:50:40 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "2 - insert demo data" ...
2025-06-01 05:50:40 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "2 - insert demo data"
2025-06-01 05:50:40 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 1, 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2
2025-06-01 05:50:40 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Rolling back transaction...
2025-06-01 05:50:40 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Transaction rolled back
2025-06-01 05:50:40 [main] ERROR o.f.core.internal.command.DbMigrate - Migration of schema [dbo] to version "2 - insert demo data" failed! Changes successfully rolled back.
2025-06-01 05:50:40 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 30 of 88M
2025-06-01 05:50:40 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : S0001
Error Code : 245
Message    : Conversion failed when converting the varchar value 'ACTIVE' to data type int.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 1, 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

2025-06-01 05:50:40 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 05:50:40 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 05:50:40 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 05:50:40 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 05:50:40 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : S0001
Error Code : 245
Message    : Conversion failed when converting the varchar value 'ACTIVE' to data type int.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 1, 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : S0001
Error Code : 245
Message    : Conversion failed when converting the varchar value 'ACTIVE' to data type int.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 1, 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.database.sqlserver.SQLServerApplicationLockTemplate.execute(SQLServerApplicationLockTemplate.java:61)
	at org.flywaydb.database.sqlserver.SQLServerConnection.lock(SQLServerConnection.java:93)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:144)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:188)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:213)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:140)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 25 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : S0001
Error Code : 245
Message    : Conversion failed when converting the varchar value 'ACTIVE' to data type int.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 1, 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:267)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:222)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:126)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:68)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 41 common frames omitted
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: Conversion failed when converting the varchar value 'ACTIVE' to data type int.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getMoreResults(SQLServerStatement.java:1406)
	at com.zaxxer.hikari.pool.HikariProxyStatement.getMoreResults(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.extractResults(JdbcTemplate.java:270)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:202)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:95)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:210)
	... 47 common frames omitted
2025-06-01 05:52:00 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 05:52:01 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 50714 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 05:52:01 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 05:52:02 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 05:52:02 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 76 ms. Found 6 JPA repository interfaces.
2025-06-01 05:52:02 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 05:52:02 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 05:52:02 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 05:52:02 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 05:52:02 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 05:52:02 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1783 ms
2025-06-01 05:52:03 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 05:52:03 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: b24edd1a-b149-441b-840f-c2e9039bd88e
2025-06-01 05:52:03 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 05:52:03 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 05:52:03 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 05:52:03 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__insert_demo_data.sql
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 05:52:03 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__insert_demo_data.sql
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 05:52:03 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 05:52:03 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 05:52:03 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 05:52:03 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:52:03 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 05:52:03 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:52:03 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:52:03 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 05:52:03 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 05:52:03 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:52:03 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 05:52:03 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 05:52:03 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.054s)
2025-06-01 05:52:03 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 05:52:03 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 1
2025-06-01 05:52:03 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V2__insert_demo_data.sql ...
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 1, 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2
2025-06-01 05:52:03 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "2 - insert demo data" ...
2025-06-01 05:52:03 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "2 - insert demo data"
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 1, 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Rolling back transaction...
2025-06-01 05:52:03 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Transaction rolled back
2025-06-01 05:52:03 [main] ERROR o.f.core.internal.command.DbMigrate - Migration of schema [dbo] to version "2 - insert demo data" failed! Changes successfully rolled back.
2025-06-01 05:52:03 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 26 of 88M
2025-06-01 05:52:03 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : 23000
Error Code : 547
Message    : The INSERT statement conflicted with the FOREIGN KEY constraint "FK__medicines__suppl__58D1301D". The conflict occurred in database "clickhealthpharma", table "dbo.suppliers", column 'id'.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 1, 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

2025-06-01 05:52:03 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 05:52:03 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 05:52:03 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 05:52:03 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 05:52:03 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : 23000
Error Code : 547
Message    : The INSERT statement conflicted with the FOREIGN KEY constraint "FK__medicines__suppl__58D1301D". The conflict occurred in database "clickhealthpharma", table "dbo.suppliers", column 'id'.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 1, 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : 23000
Error Code : 547
Message    : The INSERT statement conflicted with the FOREIGN KEY constraint "FK__medicines__suppl__58D1301D". The conflict occurred in database "clickhealthpharma", table "dbo.suppliers", column 'id'.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 1, 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.database.sqlserver.SQLServerApplicationLockTemplate.execute(SQLServerApplicationLockTemplate.java:61)
	at org.flywaydb.database.sqlserver.SQLServerConnection.lock(SQLServerConnection.java:93)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:144)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:188)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:213)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:140)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 25 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : 23000
Error Code : 547
Message    : The INSERT statement conflicted with the FOREIGN KEY constraint "FK__medicines__suppl__58D1301D". The conflict occurred in database "clickhealthpharma", table "dbo.suppliers", column 'id'.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 1, 'ACTIVE', 'system', 'system');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:267)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:222)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:126)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:68)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 41 common frames omitted
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: The INSERT statement conflicted with the FOREIGN KEY constraint "FK__medicines__suppl__58D1301D". The conflict occurred in database "clickhealthpharma", table "dbo.suppliers", column 'id'.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getMoreResults(SQLServerStatement.java:1406)
	at com.zaxxer.hikari.pool.HikariProxyStatement.getMoreResults(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.extractResults(JdbcTemplate.java:270)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:202)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:95)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:210)
	... 47 common frames omitted
2025-06-01 05:56:57 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 05:56:57 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 51293 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 05:56:57 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 05:56:59 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 05:56:59 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 194 ms. Found 6 JPA repository interfaces.
2025-06-01 05:57:01 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 05:57:01 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 05:57:01 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 05:57:01 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 05:57:01 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 05:57:01 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3978 ms
2025-06-01 05:57:01 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 05:57:02 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 151087ca-1ef9-407c-870c-7da9cd9ad499
2025-06-01 05:57:02 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 05:57:02 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 05:57:02 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 05:57:02 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 05:57:02 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 05:57:02 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 05:57:02 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 05:57:02 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 05:57:02 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 05:57:02 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 05:57:02 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 05:57:02 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 05:57:02 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__insert_demo_data.sql
2025-06-01 05:57:02 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 05:57:02 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:57:02 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__insert_demo_data.sql
2025-06-01 05:57:02 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 05:57:02 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 05:57:02 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 05:57:02 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 05:57:02 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 05:57:02 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 05:57:02 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 05:57:02 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:57:02 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 05:57:02 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:57:02 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:57:02 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 05:57:02 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 05:57:02 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:57:02 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 05:57:02 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 05:57:03 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.095s)
2025-06-01 05:57:03 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 05:57:03 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 1
2025-06-01 05:57:03 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V2__insert_demo_data.sql ...
2025-06-01 05:57:03 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 1, 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2
2025-06-01 05:57:03 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "2 - insert demo data" ...
2025-06-01 05:57:03 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "2 - insert demo data"
2025-06-01 05:57:03 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 1, 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2
2025-06-01 05:57:03 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Rolling back transaction...
2025-06-01 05:57:03 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Transaction rolled back
2025-06-01 05:57:03 [main] ERROR o.f.core.internal.command.DbMigrate - Migration of schema [dbo] to version "2 - insert demo data" failed! Changes successfully rolled back.
2025-06-01 05:57:03 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 28 of 88M
2025-06-01 05:57:03 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : S0001
Error Code : 245
Message    : Conversion failed when converting the varchar value 'ACTIVE' to data type int.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 1, 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

2025-06-01 05:57:03 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 05:57:03 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 05:57:03 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 05:57:03 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 05:57:03 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : S0001
Error Code : 245
Message    : Conversion failed when converting the varchar value 'ACTIVE' to data type int.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 1, 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : S0001
Error Code : 245
Message    : Conversion failed when converting the varchar value 'ACTIVE' to data type int.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 1, 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.database.sqlserver.SQLServerApplicationLockTemplate.execute(SQLServerApplicationLockTemplate.java:61)
	at org.flywaydb.database.sqlserver.SQLServerConnection.lock(SQLServerConnection.java:93)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:144)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:188)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:213)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:140)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 25 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : S0001
Error Code : 245
Message    : Conversion failed when converting the varchar value 'ACTIVE' to data type int.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 1, 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:267)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:222)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:126)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:68)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 41 common frames omitted
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: Conversion failed when converting the varchar value 'ACTIVE' to data type int.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getMoreResults(SQLServerStatement.java:1406)
	at com.zaxxer.hikari.pool.HikariProxyStatement.getMoreResults(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.extractResults(JdbcTemplate.java:270)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:202)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:95)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:210)
	... 47 common frames omitted
2025-06-01 05:57:44 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 05:57:44 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 51378 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 05:57:44 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 05:57:46 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 05:57:46 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 85 ms. Found 6 JPA repository interfaces.
2025-06-01 05:57:46 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 05:57:46 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 05:57:46 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 05:57:46 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 05:57:46 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 05:57:46 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 2020 ms
2025-06-01 05:57:47 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 05:57:47 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: c336ebe4-8b62-49d1-ba85-cb3ef62e4dd3
2025-06-01 05:57:47 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 05:57:47 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 05:57:47 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 05:57:47 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__insert_demo_data.sql
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 05:57:47 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__insert_demo_data.sql
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 05:57:47 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 05:57:47 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 05:57:47 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 05:57:47 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:57:47 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 05:57:47 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:57:47 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:57:47 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 05:57:47 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 05:57:47 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:57:47 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 05:57:47 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 05:57:47 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.038s)
2025-06-01 05:57:47 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 05:57:47 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 1
2025-06-01 05:57:47 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V2__insert_demo_data.sql ...
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 1, 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2
2025-06-01 05:57:47 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "2 - insert demo data" ...
2025-06-01 05:57:47 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "2 - insert demo data"
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 1, 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Rolling back transaction...
2025-06-01 05:57:47 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Transaction rolled back
2025-06-01 05:57:47 [main] ERROR o.f.core.internal.command.DbMigrate - Migration of schema [dbo] to version "2 - insert demo data" failed! Changes successfully rolled back.
2025-06-01 05:57:47 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 30 of 80M
2025-06-01 05:57:47 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : S0001
Error Code : 245
Message    : Conversion failed when converting the varchar value 'ACTIVE' to data type int.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 1, 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

2025-06-01 05:57:47 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 05:57:47 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 05:57:47 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 05:57:47 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 05:57:47 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : S0001
Error Code : 245
Message    : Conversion failed when converting the varchar value 'ACTIVE' to data type int.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 1, 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : S0001
Error Code : 245
Message    : Conversion failed when converting the varchar value 'ACTIVE' to data type int.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 1, 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.database.sqlserver.SQLServerApplicationLockTemplate.execute(SQLServerApplicationLockTemplate.java:61)
	at org.flywaydb.database.sqlserver.SQLServerConnection.lock(SQLServerConnection.java:93)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:144)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:188)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:213)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:140)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 25 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : S0001
Error Code : 245
Message    : Conversion failed when converting the varchar value 'ACTIVE' to data type int.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 'ACTIVE', 1, 'system', 'system'),
('cashier1', 'cashier123', 'CASHIER', 'ACTIVE', 1, 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:267)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:222)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:126)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:68)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 41 common frames omitted
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: Conversion failed when converting the varchar value 'ACTIVE' to data type int.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getMoreResults(SQLServerStatement.java:1406)
	at com.zaxxer.hikari.pool.HikariProxyStatement.getMoreResults(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.extractResults(JdbcTemplate.java:270)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:202)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:95)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:210)
	... 47 common frames omitted
2025-06-01 05:58:20 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 05:58:20 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 51545 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 05:58:20 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 05:58:23 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 05:58:23 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 187 ms. Found 6 JPA repository interfaces.
2025-06-01 05:58:24 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 05:58:24 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 05:58:24 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 05:58:24 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 05:58:24 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 05:58:24 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4256 ms
2025-06-01 05:58:25 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 05:58:26 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: e83faec3-2407-437c-a758-5aa4a2ce9a27
2025-06-01 05:58:26 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 05:58:26 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 05:58:26 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 05:58:26 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 05:58:26 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 05:58:26 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 05:58:26 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 05:58:26 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 05:58:26 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 05:58:26 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 05:58:26 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 05:58:26 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 05:58:26 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__insert_demo_data.sql
2025-06-01 05:58:26 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 05:58:26 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:58:26 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__insert_demo_data.sql
2025-06-01 05:58:26 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 05:58:26 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 05:58:26 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 05:58:26 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 05:58:26 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 05:58:26 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 05:58:26 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 05:58:26 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:58:26 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 05:58:26 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:58:26 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:58:26 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 05:58:26 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 05:58:26 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 05:58:26 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__insert_demo_data.sql (filename: V2__insert_demo_data.sql)
2025-06-01 05:58:26 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 05:58:26 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.115s)
2025-06-01 05:58:26 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 05:58:26 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 1
2025-06-01 05:58:26 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V2__insert_demo_data.sql ...
2025-06-01 05:58:27 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2
2025-06-01 05:58:27 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "2 - insert demo data" ...
2025-06-01 05:58:27 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "2 - insert demo data"
2025-06-01 05:58:27 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2
2025-06-01 05:58:27 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Rolling back transaction...
2025-06-01 05:58:27 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Transaction rolled back
2025-06-01 05:58:27 [main] ERROR o.f.core.internal.command.DbMigrate - Migration of schema [dbo] to version "2 - insert demo data" failed! Changes successfully rolled back.
2025-06-01 05:58:27 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 31 of 80M
2025-06-01 05:58:27 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : 23000
Error Code : 547
Message    : The INSERT statement conflicted with the FOREIGN KEY constraint "FK__users__pharmacy___793DFFAF". The conflict occurred in database "clickhealthpharma", table "dbo.pharmacies", column 'id'.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

2025-06-01 05:58:27 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 05:58:27 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 05:58:27 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 05:58:27 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 05:58:27 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : 23000
Error Code : 547
Message    : The INSERT statement conflicted with the FOREIGN KEY constraint "FK__users__pharmacy___793DFFAF". The conflict occurred in database "clickhealthpharma", table "dbo.pharmacies", column 'id'.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : 23000
Error Code : 547
Message    : The INSERT statement conflicted with the FOREIGN KEY constraint "FK__users__pharmacy___793DFFAF". The conflict occurred in database "clickhealthpharma", table "dbo.pharmacies", column 'id'.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.database.sqlserver.SQLServerApplicationLockTemplate.execute(SQLServerApplicationLockTemplate.java:61)
	at org.flywaydb.database.sqlserver.SQLServerConnection.lock(SQLServerConnection.java:93)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:144)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:188)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:213)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:140)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 25 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V2__insert_demo_data.sql failed
-----------------------------------------
SQL State  : 23000
Error Code : 547
Message    : The INSERT statement conflicted with the FOREIGN KEY constraint "FK__users__pharmacy___793DFFAF". The conflict occurred in database "clickhealthpharma", table "dbo.pharmacies", column 'id'.
Location   : db/migration/V2__insert_demo_data.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V2__insert_demo_data.sql)
Line       : 2
Statement  : -- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

-- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');


-- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');


-- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');



-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:267)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:222)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:126)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:68)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 41 common frames omitted
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: The INSERT statement conflicted with the FOREIGN KEY constraint "FK__users__pharmacy___793DFFAF". The conflict occurred in database "clickhealthpharma", table "dbo.pharmacies", column 'id'.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.TDSTokenHandler.onEOF(tdsparser.java:304)
	at com.microsoft.sqlserver.jdbc.TDSParser.parse(tdsparser.java:137)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1691)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getMoreResults(SQLServerStatement.java:1406)
	at com.zaxxer.hikari.pool.HikariProxyStatement.getMoreResults(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.extractResults(JdbcTemplate.java:270)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:202)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:95)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:210)
	... 47 common frames omitted
2025-06-01 06:09:42 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 06:09:42 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 52716 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 06:09:42 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 06:09:45 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 06:09:45 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 201 ms. Found 6 JPA repository interfaces.
2025-06-01 06:09:47 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 06:09:47 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 06:09:47 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 06:09:47 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 06:09:47 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 06:09:47 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4645 ms
2025-06-01 06:09:48 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 06:09:49 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 36878247-b432-42c6-84f8-3b05a14131ba
2025-06-01 06:09:49 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 06:09:49 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 06:09:49 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 06:09:49 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2_create_dummy_pharmacy.sql
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__create_dummy_users.sql
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V4__create_dummy_supplier.sql
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 06:09:49 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__create_dummy_users.sql
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2_create_dummy_pharmacy.sql
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V4__create_dummy_supplier.sql
2025-06-01 06:09:49 [main] INFO  o.f.c.i.r.ResourceNameValidator - 1 SQL migrations were detected but not run because they did not follow the filename convention.
2025-06-01 06:09:49 [main] INFO  o.f.c.i.r.ResourceNameValidator - Set 'validateMigrationNaming' to true to fail fast and see a list of the invalid file names.
2025-06-01 06:09:49 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 06:09:49 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 06:09:49 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 06:09:49 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 06:09:49 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:09:49 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 06:09:49 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:09:49 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:09:49 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 06:09:49 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:09:49 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2_create_dummy_pharmacy.sql (filename: V2_create_dummy_pharmacy.sql)
2025-06-01 06:09:49 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplier.sql (filename: V4__create_dummy_supplier.sql)
2025-06-01 06:09:49 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:09:49 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 06:09:49 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:09:49 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2_create_dummy_pharmacy.sql (filename: V2_create_dummy_pharmacy.sql)
2025-06-01 06:09:49 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplier.sql (filename: V4__create_dummy_supplier.sql)
2025-06-01 06:09:50 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.115s)
2025-06-01 06:09:50 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 06:09:50 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 1
2025-06-01 06:09:50 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V3__create_dummy_users.sql ...
2025-06-01 06:09:50 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 3: -- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');
2025-06-01 06:09:50 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "3 - create dummy users" ...
2025-06-01 06:09:50 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "3 - create dummy users"
2025-06-01 06:09:50 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');
2025-06-01 06:09:50 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Rolling back transaction...
2025-06-01 06:09:50 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Transaction rolled back
2025-06-01 06:09:50 [main] ERROR o.f.core.internal.command.DbMigrate - Migration of schema [dbo] to version "3 - create dummy users" failed! Changes successfully rolled back.
2025-06-01 06:09:50 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 27 of 88M
2025-06-01 06:09:50 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V3__create_dummy_users.sql failed
-------------------------------------------
SQL State  : 23000
Error Code : 547
Message    : The INSERT statement conflicted with the FOREIGN KEY constraint "FK__users__pharmacy___793DFFAF". The conflict occurred in database "clickhealthpharma", table "dbo.pharmacies", column 'id'.
Location   : db/migration/V3__create_dummy_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__create_dummy_users.sql)
Line       : 3
Statement  : -- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

2025-06-01 06:09:50 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 06:09:50 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 06:09:50 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 06:09:50 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 06:09:50 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V3__create_dummy_users.sql failed
-------------------------------------------
SQL State  : 23000
Error Code : 547
Message    : The INSERT statement conflicted with the FOREIGN KEY constraint "FK__users__pharmacy___793DFFAF". The conflict occurred in database "clickhealthpharma", table "dbo.pharmacies", column 'id'.
Location   : db/migration/V3__create_dummy_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__create_dummy_users.sql)
Line       : 3
Statement  : -- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V3__create_dummy_users.sql failed
-------------------------------------------
SQL State  : 23000
Error Code : 547
Message    : The INSERT statement conflicted with the FOREIGN KEY constraint "FK__users__pharmacy___793DFFAF". The conflict occurred in database "clickhealthpharma", table "dbo.pharmacies", column 'id'.
Location   : db/migration/V3__create_dummy_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__create_dummy_users.sql)
Line       : 3
Statement  : -- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.database.sqlserver.SQLServerApplicationLockTemplate.execute(SQLServerApplicationLockTemplate.java:61)
	at org.flywaydb.database.sqlserver.SQLServerConnection.lock(SQLServerConnection.java:93)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:144)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:188)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:213)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:140)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 25 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V3__create_dummy_users.sql failed
-------------------------------------------
SQL State  : 23000
Error Code : 547
Message    : The INSERT statement conflicted with the FOREIGN KEY constraint "FK__users__pharmacy___793DFFAF". The conflict occurred in database "clickhealthpharma", table "dbo.pharmacies", column 'id'.
Location   : db/migration/V3__create_dummy_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__create_dummy_users.sql)
Line       : 3
Statement  : -- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:267)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:222)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:126)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:68)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 41 common frames omitted
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: The INSERT statement conflicted with the FOREIGN KEY constraint "FK__users__pharmacy___793DFFAF". The conflict occurred in database "clickhealthpharma", table "dbo.pharmacies", column 'id'.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.doExecuteStatement(SQLServerStatement.java:920)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement$StmtExecCmd.doExecute(SQLServerStatement.java:814)
	at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:7675)
	at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:4137)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLServerStatement.java:272)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLServerStatement.java:246)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.execute(SQLServerStatement.java:787)
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:94)
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:201)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:95)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:210)
	... 47 common frames omitted
2025-06-01 06:11:24 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 06:11:24 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 53009 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 06:11:24 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 06:11:27 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 06:11:27 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 210 ms. Found 6 JPA repository interfaces.
2025-06-01 06:11:28 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 06:11:28 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 06:11:28 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 06:11:28 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 06:11:28 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 06:11:28 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4273 ms
2025-06-01 06:11:29 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 06:11:29 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: c0a32334-06c4-4577-9f06-ce1d3d95757b
2025-06-01 06:11:29 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 06:11:30 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 06:11:30 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 06:11:30 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/1_V3__create_dummy_users.sql
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2_create_dummy_pharmacy.sql
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/_1V4__create_dummy_supplier.sql
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 06:11:30 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating _1V4__create_dummy_supplier.sql
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2_create_dummy_pharmacy.sql
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating 1_V3__create_dummy_users.sql
2025-06-01 06:11:30 [main] INFO  o.f.c.i.r.ResourceNameValidator - 3 SQL migrations were detected but not run because they did not follow the filename convention.
2025-06-01 06:11:30 [main] INFO  o.f.c.i.r.ResourceNameValidator - Set 'validateMigrationNaming' to true to fail fast and see a list of the invalid file names.
2025-06-01 06:11:30 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 06:11:30 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 06:11:30 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 06:11:30 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 06:11:30 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:11:30 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 06:11:30 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:11:30 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:11:30 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:11:30 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:11:30 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:11:30 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:11:30 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2_create_dummy_pharmacy.sql (filename: V2_create_dummy_pharmacy.sql)
2025-06-01 06:11:30 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:11:30 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:11:30 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:11:30 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:11:30 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2_create_dummy_pharmacy.sql (filename: V2_create_dummy_pharmacy.sql)
2025-06-01 06:11:30 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:11:30 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 1 migration (execution time 00:00.088s)
2025-06-01 06:11:30 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 06:11:30 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 1
2025-06-01 06:11:30 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 06:11:30 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 26 of 88M
2025-06-01 06:11:30 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 06:11:30 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 06:11:31 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 06:11:31 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 06:11:31 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 06:11:35 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 06:11:35 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 06:11:36 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'roleController' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/controller/RoleController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userServiceImpl' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/services/impl/UserServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 1: Error creating bean with name 'securityConfig' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/security/SecurityConfig.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'jwtTokenProvider': Injection of autowired dependencies failed
2025-06-01 06:11:36 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 06:11:36 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 06:11:36 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 06:11:36 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 06:11:36 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 06:11:36 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'roleController' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/controller/RoleController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userServiceImpl' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/services/impl/UserServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 1: Error creating bean with name 'securityConfig' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/security/SecurityConfig.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'jwtTokenProvider': Injection of autowired dependencies failed
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1355)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1192)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:975)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:962)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userServiceImpl' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/services/impl/UserServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 1: Error creating bean with name 'securityConfig' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/security/SecurityConfig.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'jwtTokenProvider': Injection of autowired dependencies failed
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1355)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1192)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 26 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'securityConfig' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/security/SecurityConfig.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'jwtTokenProvider': Injection of autowired dependencies failed
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1355)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1192)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:409)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1335)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1165)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 40 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jwtTokenProvider': Injection of autowired dependencies failed
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:514)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1419)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:599)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 63 common frames omitted
Caused by: java.lang.IllegalArgumentException: Could not resolve placeholder 'app.jwt.expiration-ms' in value "${app.jwt.expiration-ms}"
	at org.springframework.util.PropertyPlaceholderHelper.parseStringValue(PropertyPlaceholderHelper.java:180)
	at org.springframework.util.PropertyPlaceholderHelper.replacePlaceholders(PropertyPlaceholderHelper.java:126)
	at org.springframework.core.env.AbstractPropertyResolver.doResolvePlaceholders(AbstractPropertyResolver.java:239)
	at org.springframework.core.env.AbstractPropertyResolver.resolveRequiredPlaceholders(AbstractPropertyResolver.java:210)
	at org.springframework.context.support.PropertySourcesPlaceholderConfigurer.lambda$processProperties$0(PropertySourcesPlaceholderConfigurer.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.resolveEmbeddedValue(AbstractBeanFactory.java:953)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1374)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:784)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:767)
	at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:145)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:508)
	... 75 common frames omitted
2025-06-01 06:14:29 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 06:14:29 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 53432 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 06:14:29 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 06:14:30 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 06:14:30 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 92 ms. Found 6 JPA repository interfaces.
2025-06-01 06:14:31 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 06:14:31 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 06:14:31 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 06:14:31 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 06:14:31 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 06:14:31 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1808 ms
2025-06-01 06:14:31 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 06:14:31 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: d8eb5eb1-e412-4fe3-8fd2-fab447ef3323
2025-06-01 06:14:31 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 06:14:31 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 06:14:31 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 06:14:31 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2_create_dummy_pharmacy.sql
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/extra/
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/extra/1_V3__create_dummy_users.sql
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/extra/_1V4__create_dummy_supplier.sql
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 06:14:31 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:14:31 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating _1V4__create_dummy_supplier.sql
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2_create_dummy_pharmacy.sql
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating 1_V3__create_dummy_users.sql
2025-06-01 06:14:31 [main] INFO  o.f.c.i.r.ResourceNameValidator - 3 SQL migrations were detected but not run because they did not follow the filename convention.
2025-06-01 06:14:31 [main] INFO  o.f.c.i.r.ResourceNameValidator - Set 'validateMigrationNaming' to true to fail fast and see a list of the invalid file names.
2025-06-01 06:14:31 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 06:14:31 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 06:14:31 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 06:14:31 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 06:14:31 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:14:31 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2_create_dummy_pharmacy.sql (filename: V2_create_dummy_pharmacy.sql)
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2_create_dummy_pharmacy.sql (filename: V2_create_dummy_pharmacy.sql)
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:14:32 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 1 migration (execution time 00:00.056s)
2025-06-01 06:14:32 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 06:14:32 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 1
2025-06-01 06:14:32 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 06:14:32 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 24 of 88M
2025-06-01 06:14:32 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 06:14:32 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 06:14:32 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 06:14:32 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 06:14:32 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 06:14:33 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 06:14:33 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 06:14:34 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'roleController' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/controller/RoleController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userServiceImpl' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/services/impl/UserServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 1: Error creating bean with name 'securityConfig' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/security/SecurityConfig.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'jwtTokenProvider': Injection of autowired dependencies failed
2025-06-01 06:14:34 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 06:14:34 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 06:14:34 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 06:14:34 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 06:14:34 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 06:14:34 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'roleController' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/controller/RoleController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userServiceImpl' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/services/impl/UserServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 1: Error creating bean with name 'securityConfig' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/security/SecurityConfig.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'jwtTokenProvider': Injection of autowired dependencies failed
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1355)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1192)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:975)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:962)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'userServiceImpl' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/services/impl/UserServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 1: Error creating bean with name 'securityConfig' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/security/SecurityConfig.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'jwtTokenProvider': Injection of autowired dependencies failed
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1355)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1192)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 26 common frames omitted
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'securityConfig' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/security/SecurityConfig.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'jwtTokenProvider': Injection of autowired dependencies failed
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:795)
	at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:237)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1355)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1192)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:409)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1335)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1165)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 40 common frames omitted
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jwtTokenProvider': Injection of autowired dependencies failed
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:514)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1419)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:599)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:904)
	at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:782)
	... 63 common frames omitted
Caused by: java.lang.IllegalArgumentException: Could not resolve placeholder 'app.jwt.expiration-ms' in value "${app.jwt.expiration-ms}"
	at org.springframework.util.PropertyPlaceholderHelper.parseStringValue(PropertyPlaceholderHelper.java:180)
	at org.springframework.util.PropertyPlaceholderHelper.replacePlaceholders(PropertyPlaceholderHelper.java:126)
	at org.springframework.core.env.AbstractPropertyResolver.doResolvePlaceholders(AbstractPropertyResolver.java:239)
	at org.springframework.core.env.AbstractPropertyResolver.resolveRequiredPlaceholders(AbstractPropertyResolver.java:210)
	at org.springframework.context.support.PropertySourcesPlaceholderConfigurer.lambda$processProperties$0(PropertySourcesPlaceholderConfigurer.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.resolveEmbeddedValue(AbstractBeanFactory.java:953)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1374)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:784)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:767)
	at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:145)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:508)
	... 75 common frames omitted
2025-06-01 06:19:16 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 06:19:16 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 54003 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 06:19:16 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 06:19:17 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 06:19:17 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 81 ms. Found 6 JPA repository interfaces.
2025-06-01 06:19:18 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 06:19:18 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 06:19:18 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 06:19:18 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 06:19:18 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 06:19:18 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1803 ms
2025-06-01 06:19:18 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 06:19:18 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: c2625316-a5b2-4ef6-aed1-c874e7730925
2025-06-01 06:19:18 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 06:19:18 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 06:19:18 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 06:19:18 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2_create_dummy_pharmacy.sql
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/extra/
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/extra/1_V3__create_dummy_users.sql
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/extra/_1V4__create_dummy_supplier.sql
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating _1V4__create_dummy_supplier.sql
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2_create_dummy_pharmacy.sql
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating 1_V3__create_dummy_users.sql
2025-06-01 06:19:18 [main] INFO  o.f.c.i.r.ResourceNameValidator - 3 SQL migrations were detected but not run because they did not follow the filename convention.
2025-06-01 06:19:18 [main] INFO  o.f.c.i.r.ResourceNameValidator - Set 'validateMigrationNaming' to true to fail fast and see a list of the invalid file names.
2025-06-01 06:19:18 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 06:19:18 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 06:19:18 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 06:19:18 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2_create_dummy_pharmacy.sql (filename: V2_create_dummy_pharmacy.sql)
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2_create_dummy_pharmacy.sql (filename: V2_create_dummy_pharmacy.sql)
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:19:18 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 1 migration (execution time 00:00.050s)
2025-06-01 06:19:18 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 06:19:18 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 1
2025-06-01 06:19:18 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 06:19:18 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 25 of 88M
2025-06-01 06:19:19 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 06:19:19 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 06:19:19 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 06:19:19 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 06:19:19 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 06:19:20 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 06:19:20 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 06:19:21 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 06:19:22 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@75c5ab79, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@3e7c66b3, org.springframework.security.web.context.SecurityContextHolderFilter@50e7d8ba, org.springframework.security.web.header.HeaderWriterFilter@45cce4c2, org.springframework.web.filter.CorsFilter@502f6f6a, org.springframework.security.web.authentication.logout.LogoutFilter@2453cbb7, com.clickhealth.pharma.security.JwtAuthFilter@64a0ee65, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@4548bfc7, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@557c0b65, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@3ce60feb, org.springframework.security.web.session.SessionManagementFilter@57e9cd2, org.springframework.security.web.access.ExceptionTranslationFilter@238cac6, org.springframework.security.web.access.intercept.AuthorizationFilter@e38b953]
2025-06-01 06:19:22 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'authenticationManager' defined in class path resource [com/clickhealth/pharma/security/SecurityConfig.class]: Unsatisfied dependency expressed through method 'authenticationManager' parameter 0: No qualifying bean of type 'org.springframework.security.authentication.AuthenticationProvider' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
2025-06-01 06:19:22 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 06:19:22 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 06:19:22 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 06:19:22 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 06:19:22 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 06:19:22 [main] ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

Parameter 0 of method authenticationManager in com.clickhealth.pharma.security.SecurityConfig required a bean of type 'org.springframework.security.authentication.AuthenticationProvider' that could not be found.


Action:

Consider defining a bean of type 'org.springframework.security.authentication.AuthenticationProvider' in your configuration.

2025-06-01 06:24:46 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 06:24:46 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 54657 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 06:24:46 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 06:24:48 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 06:24:48 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 274 ms. Found 6 JPA repository interfaces.
2025-06-01 06:24:50 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 06:24:51 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 06:24:51 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 06:24:51 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 06:24:51 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 06:24:51 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4598 ms
2025-06-01 06:24:51 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 06:24:52 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 742af381-e2bf-4010-8b34-8ae0c02c492c
2025-06-01 06:24:52 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 06:24:52 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 06:24:52 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 06:24:52 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2_create_dummy_pharmacy.sql
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/extra/
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/extra/1_V3__create_dummy_users.sql
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/extra/_1V4__create_dummy_supplier.sql
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating _1V4__create_dummy_supplier.sql
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2_create_dummy_pharmacy.sql
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating 1_V3__create_dummy_users.sql
2025-06-01 06:24:52 [main] INFO  o.f.c.i.r.ResourceNameValidator - 3 SQL migrations were detected but not run because they did not follow the filename convention.
2025-06-01 06:24:52 [main] INFO  o.f.c.i.r.ResourceNameValidator - Set 'validateMigrationNaming' to true to fail fast and see a list of the invalid file names.
2025-06-01 06:24:52 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 06:24:52 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 06:24:52 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 06:24:52 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2_create_dummy_pharmacy.sql (filename: V2_create_dummy_pharmacy.sql)
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2_create_dummy_pharmacy.sql (filename: V2_create_dummy_pharmacy.sql)
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:24:52 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 1 migration (execution time 00:00.102s)
2025-06-01 06:24:52 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 06:24:52 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 1
2025-06-01 06:24:52 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 06:24:52 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 22 of 94M
2025-06-01 06:24:53 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 06:24:53 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 06:24:53 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 06:24:54 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 06:24:54 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 06:24:57 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 06:24:57 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 06:24:58 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'roleController' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/controller/RoleController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'userServiceImpl' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/services/impl/UserServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 1: Error creating bean with name 'securityConfig' defined in URL [jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/com/clickhealth/pharma/security/SecurityConfig.class]: Unsatisfied dependency expressed through constructor parameter 1: No qualifying bean of type 'org.springframework.security.core.userdetails.UserDetailsService' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
2025-06-01 06:24:58 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 06:24:58 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 06:24:58 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 06:24:58 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 06:24:58 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 06:24:58 [main] ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

Parameter 1 of constructor in com.clickhealth.pharma.security.SecurityConfig required a bean of type 'org.springframework.security.core.userdetails.UserDetailsService' that could not be found.


Action:

Consider defining a bean of type 'org.springframework.security.core.userdetails.UserDetailsService' in your configuration.

2025-06-01 06:35:04 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 06:35:04 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 56029 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 06:35:04 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 06:35:05 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 06:35:05 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 81 ms. Found 6 JPA repository interfaces.
2025-06-01 06:35:06 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 06:35:06 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 06:35:06 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 06:35:06 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 06:35:06 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 06:35:06 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1857 ms
2025-06-01 06:35:06 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 06:35:06 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: dd69c580-f2c2-4e52-9e87-33d0e2698873
2025-06-01 06:35:06 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 06:35:06 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 06:35:06 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 06:35:06 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2_create_dummy_pharmacy.sql
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/extra/
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/extra/1_V3__create_dummy_users.sql
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/extra/_1V4__create_dummy_supplier.sql
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 06:35:06 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:35:06 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating _1V4__create_dummy_supplier.sql
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2_create_dummy_pharmacy.sql
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating 1_V3__create_dummy_users.sql
2025-06-01 06:35:06 [main] INFO  o.f.c.i.r.ResourceNameValidator - 3 SQL migrations were detected but not run because they did not follow the filename convention.
2025-06-01 06:35:06 [main] INFO  o.f.c.i.r.ResourceNameValidator - Set 'validateMigrationNaming' to true to fail fast and see a list of the invalid file names.
2025-06-01 06:35:06 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 06:35:06 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 06:35:06 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 06:35:06 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 06:35:06 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:35:06 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2_create_dummy_pharmacy.sql (filename: V2_create_dummy_pharmacy.sql)
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2_create_dummy_pharmacy.sql (filename: V2_create_dummy_pharmacy.sql)
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:35:07 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 1 migration (execution time 00:00.190s)
2025-06-01 06:35:07 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 06:35:07 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 1
2025-06-01 06:35:07 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 06:35:07 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 24 of 94M
2025-06-01 06:35:07 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 06:35:07 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 06:35:07 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 06:35:08 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 06:35:08 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 06:35:11 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 06:35:11 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 06:35:13 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 06:35:13 [main] WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: 6deb968e-56be-4956-9b3f-61c2ffc1d579

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-06-01 06:35:14 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@524945e2, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@73b63917, org.springframework.security.web.context.SecurityContextHolderFilter@47a05ad8, org.springframework.security.web.header.HeaderWriterFilter@5852605c, org.springframework.web.filter.CorsFilter@2292e793, org.springframework.security.web.authentication.logout.LogoutFilter@4fd8aefe, com.clickhealth.pharma.security.JwtAuthFilter@58dd584a, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@5275d709, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@21523e1b, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@40a360e6, org.springframework.security.web.session.SessionManagementFilter@3aa4d595, org.springframework.security.web.access.ExceptionTranslationFilter@20ed6de, org.springframework.security.web.access.intercept.AuthorizationFilter@519e0814]
2025-06-01 06:35:15 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 06:35:15 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 06:35:15 [main] INFO  com.clickhealth.pharma.Application - Started Application in 11.532 seconds (process running for 11.944)
2025-06-01 06:35:31 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-01 06:35:31 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-01 06:35:31 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-01 06:35:33 [http-nio-8080-exec-8] INFO  o.s.api.AbstractOpenApiResource - Init duration for springdoc-openapi is: 1173 ms
2025-06-01 06:36:22 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 06:36:22 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 06:36:22 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 06:36:44 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 06:36:44 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 56394 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 06:36:44 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 06:36:47 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 06:36:47 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 164 ms. Found 6 JPA repository interfaces.
2025-06-01 06:36:49 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 06:36:49 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 06:36:49 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 06:36:49 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 06:36:49 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 06:36:49 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4480 ms
2025-06-01 06:36:49 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 06:36:50 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 25d9f3d3-53f0-4781-b0ff-8b4eada9ba90
2025-06-01 06:36:50 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 06:36:50 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 06:36:50 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 06:36:50 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__create_dummy_pharmacy.sql
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/extra/
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/extra/1_V3__create_dummy_users.sql
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/extra/_1V4__create_dummy_supplier.sql
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 06:36:50 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:36:50 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating _1V4__create_dummy_supplier.sql
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__create_dummy_pharmacy.sql
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating 1_V3__create_dummy_users.sql
2025-06-01 06:36:50 [main] INFO  o.f.c.i.r.ResourceNameValidator - 2 SQL migrations were detected but not run because they did not follow the filename convention.
2025-06-01 06:36:50 [main] INFO  o.f.c.i.r.ResourceNameValidator - Set 'validateMigrationNaming' to true to fail fast and see a list of the invalid file names.
2025-06-01 06:36:50 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 06:36:50 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 06:36:50 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 06:36:50 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 06:36:50 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:36:50 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:36:50 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/1_V3__create_dummy_users.sql (filename: 1_V3__create_dummy_users.sql)
2025-06-01 06:36:51 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 2 migrations (execution time 00:00.160s)
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 06:36:51 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 1
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V2__create_dummy_pharmacy.sql ...
2025-06-01 06:36:51 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "2 - create dummy pharmacy" ...
2025-06-01 06:36:51 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "2 - create dummy pharmacy"
2025-06-01 06:36:51 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');
2025-06-01 06:36:51 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 1 row affected
2025-06-01 06:36:51 [main] DEBUG o.f.core.internal.command.DbMigrate - Successfully completed migration of schema [dbo] to version "2 - create dummy pharmacy"
2025-06-01 06:36:51 [main] DEBUG o.f.c.i.s.JdbcTableSchemaHistory - Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] successfully updated to reflect changes
2025-06-01 06:36:51 [main] INFO  o.f.core.internal.command.DbMigrate - Successfully applied 1 migration to schema [dbo], now at version v2 (execution time 00:00.041s)
2025-06-01 06:36:51 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 28 of 88M
2025-06-01 06:36:51 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 06:36:52 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 06:36:52 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 06:36:53 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 06:36:53 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 06:36:55 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 06:36:55 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 06:36:56 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 06:36:56 [main] WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: 45008b63-7e02-49ed-86e3-a81972163210

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-06-01 06:36:57 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@63f609a4, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@11fb4f69, org.springframework.security.web.context.SecurityContextHolderFilter@1b7648f, org.springframework.security.web.header.HeaderWriterFilter@73625632, org.springframework.web.filter.CorsFilter@618d2191, org.springframework.security.web.authentication.logout.LogoutFilter@3ef2f84c, com.clickhealth.pharma.security.JwtAuthFilter@4b1ef6a, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@1b87f7cd, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@306f439c, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@57596d71, org.springframework.security.web.session.SessionManagementFilter@70c68e4e, org.springframework.security.web.access.ExceptionTranslationFilter@54c2cfc9, org.springframework.security.web.access.intercept.AuthorizationFilter@4a571516]
2025-06-01 06:36:58 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 06:36:58 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 06:36:58 [main] INFO  com.clickhealth.pharma.Application - Started Application in 14.998 seconds (process running for 15.695)
2025-06-01 06:37:44 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 06:37:44 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 06:37:44 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 06:38:04 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 06:38:04 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 56622 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 06:38:04 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 06:38:07 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 06:38:07 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 166 ms. Found 6 JPA repository interfaces.
2025-06-01 06:38:09 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 06:38:09 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 06:38:09 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 06:38:09 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 06:38:09 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 06:38:09 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4232 ms
2025-06-01 06:38:09 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 06:38:10 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 0321ddfe-4731-4713-9bde-9618373ab52d
2025-06-01 06:38:10 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 06:38:10 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 06:38:10 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 06:38:10 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 06:38:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 06:38:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:38:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 06:38:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 06:38:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:38:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 06:38:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 06:38:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 06:38:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__create_dummy_pharmacy.sql
2025-06-01 06:38:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__create_dummy_users.sql
2025-06-01 06:38:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/extra/
2025-06-01 06:38:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/extra/_1V4__create_dummy_supplier.sql
2025-06-01 06:38:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 06:38:10 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:38:10 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:38:10 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__create_dummy_users.sql
2025-06-01 06:38:10 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating _1V4__create_dummy_supplier.sql
2025-06-01 06:38:10 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 06:38:10 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__create_dummy_pharmacy.sql
2025-06-01 06:38:10 [main] INFO  o.f.c.i.r.ResourceNameValidator - 1 SQL migrations were detected but not run because they did not follow the filename convention.
2025-06-01 06:38:10 [main] INFO  o.f.c.i.r.ResourceNameValidator - Set 'validateMigrationNaming' to true to fail fast and see a list of the invalid file names.
2025-06-01 06:38:11 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 06:38:11 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 06:38:11 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 06:38:11 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 06:38:11 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 06:38:11 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/_1V4__create_dummy_supplier.sql (filename: _1V4__create_dummy_supplier.sql)
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/extra/ (filename: )
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 06:38:11 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 3 migrations (execution time 00:00.100s)
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 06:38:11 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 2
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V3__create_dummy_users.sql ...
2025-06-01 06:38:11 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 3: -- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');
2025-06-01 06:38:11 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "3 - create dummy users" ...
2025-06-01 06:38:11 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "3 - create dummy users"
2025-06-01 06:38:11 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');
2025-06-01 06:38:11 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Rolling back transaction...
2025-06-01 06:38:11 [main] DEBUG o.f.c.i.j.TransactionalExecutionTemplate - Transaction rolled back
2025-06-01 06:38:11 [main] ERROR o.f.core.internal.command.DbMigrate - Migration of schema [dbo] to version "3 - create dummy users" failed! Changes successfully rolled back.
2025-06-01 06:38:11 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 30 of 80M
2025-06-01 06:38:11 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V3__create_dummy_users.sql failed
-------------------------------------------
SQL State  : 23000
Error Code : 547
Message    : The INSERT statement conflicted with the FOREIGN KEY constraint "FK__users__pharmacy___793DFFAF". The conflict occurred in database "clickhealthpharma", table "dbo.pharmacies", column 'id'.
Location   : db/migration/V3__create_dummy_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__create_dummy_users.sql)
Line       : 3
Statement  : -- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

2025-06-01 06:38:11 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 06:38:11 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 06:38:11 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-06-01 06:38:11 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-06-01 06:38:11 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'flywayInitializer' defined in class path resource [org/springframework/boot/autoconfigure/flyway/FlywayAutoConfiguration$FlywayConfiguration.class]: Migration V3__create_dummy_users.sql failed
-------------------------------------------
SQL State  : 23000
Error Code : 547
Message    : The INSERT statement conflicted with the FOREIGN KEY constraint "FK__users__pharmacy___793DFFAF". The conflict occurred in database "clickhealthpharma", table "dbo.pharmacies", column 'id'.
Location   : db/migration/V3__create_dummy_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__create_dummy_users.sql)
Line       : 3
Statement  : -- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:313)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.clickhealth.pharma.Application.main(Application.java:10)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:569)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:91)
	at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:53)
	at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:58)
Caused by: org.flywaydb.core.internal.command.DbMigrate$FlywayMigrateException: Migration V3__create_dummy_users.sql failed
-------------------------------------------
SQL State  : 23000
Error Code : 547
Message    : The INSERT statement conflicted with the FOREIGN KEY constraint "FK__users__pharmacy___793DFFAF". The conflict occurred in database "clickhealthpharma", table "dbo.pharmacies", column 'id'.
Location   : db/migration/V3__create_dummy_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__create_dummy_users.sql)
Line       : 3
Statement  : -- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:382)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$applyMigrations$1(DbMigrate.java:272)
	at org.flywaydb.core.internal.jdbc.TransactionalExecutionTemplate.execute(TransactionalExecutionTemplate.java:55)
	at org.flywaydb.core.internal.command.DbMigrate.applyMigrations(DbMigrate.java:271)
	at org.flywaydb.core.internal.command.DbMigrate.migrateGroup(DbMigrate.java:244)
	at org.flywaydb.core.internal.command.DbMigrate.lambda$migrateAll$0(DbMigrate.java:139)
	at org.flywaydb.database.sqlserver.SQLServerApplicationLockTemplate.execute(SQLServerApplicationLockTemplate.java:61)
	at org.flywaydb.database.sqlserver.SQLServerConnection.lock(SQLServerConnection.java:93)
	at org.flywaydb.core.internal.schemahistory.JdbcTableSchemaHistory.lock(JdbcTableSchemaHistory.java:144)
	at org.flywaydb.core.internal.command.DbMigrate.migrateAll(DbMigrate.java:139)
	at org.flywaydb.core.internal.command.DbMigrate.migrate(DbMigrate.java:97)
	at org.flywaydb.core.Flyway.lambda$migrate$0(Flyway.java:188)
	at org.flywaydb.core.FlywayExecutor.execute(FlywayExecutor.java:213)
	at org.flywaydb.core.Flyway.migrate(Flyway.java:140)
	at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:66)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 25 common frames omitted
Caused by: org.flywaydb.core.internal.sqlscript.FlywaySqlScriptException: Migration V3__create_dummy_users.sql failed
-------------------------------------------
SQL State  : 23000
Error Code : 547
Message    : The INSERT statement conflicted with the FOREIGN KEY constraint "FK__users__pharmacy___793DFFAF". The conflict occurred in database "clickhealthpharma", table "dbo.pharmacies", column 'id'.
Location   : db/migration/V3__create_dummy_users.sql (/opt/theatro/source/clickhealthpharma/nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration/V3__create_dummy_users.sql)
Line       : 3
Statement  : -- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');

	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.handleException(DefaultSqlScriptExecutor.java:267)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:222)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.execute(DefaultSqlScriptExecutor.java:126)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.executeOnce(SqlMigrationExecutor.java:68)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.lambda$execute$0(SqlMigrationExecutor.java:57)
	at org.flywaydb.core.internal.database.DefaultExecutionStrategy.execute(DefaultExecutionStrategy.java:27)
	at org.flywaydb.core.internal.resolver.sql.SqlMigrationExecutor.execute(SqlMigrationExecutor.java:56)
	at org.flywaydb.core.internal.command.DbMigrate.doMigrateGroup(DbMigrate.java:374)
	... 41 common frames omitted
Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: The INSERT statement conflicted with the FOREIGN KEY constraint "FK__users__pharmacy___793DFFAF". The conflict occurred in database "clickhealthpharma", table "dbo.pharmacies", column 'id'.
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:259)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1695)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.doExecuteStatement(SQLServerStatement.java:920)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement$StmtExecCmd.doExecute(SQLServerStatement.java:814)
	at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:7675)
	at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:4137)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLServerStatement.java:272)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLServerStatement.java:246)
	at com.microsoft.sqlserver.jdbc.SQLServerStatement.execute(SQLServerStatement.java:787)
	at com.zaxxer.hikari.pool.ProxyStatement.execute(ProxyStatement.java:94)
	at com.zaxxer.hikari.pool.HikariProxyStatement.execute(HikariProxyStatement.java)
	at org.flywaydb.core.internal.jdbc.JdbcTemplate.executeStatement(JdbcTemplate.java:201)
	at org.flywaydb.core.internal.sqlscript.ParsedSqlStatement.execute(ParsedSqlStatement.java:95)
	at org.flywaydb.core.internal.sqlscript.DefaultSqlScriptExecutor.executeStatement(DefaultSqlScriptExecutor.java:210)
	... 47 common frames omitted
2025-06-01 06:48:03 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 06:48:04 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 57726 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 06:48:04 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 06:48:06 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 06:48:07 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 160 ms. Found 6 JPA repository interfaces.
2025-06-01 06:48:08 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 06:48:08 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 06:48:08 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 06:48:08 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 06:48:08 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 06:48:08 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4449 ms
2025-06-01 06:48:09 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 06:48:09 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 0a15a310-ca3a-4d01-98e0-0e7594093588
2025-06-01 06:48:09 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 06:48:10 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 06:48:10 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 06:48:10 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__create_dummy_pharmacy.sql
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__create_dummy_users.sql
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V4__create_dummy_supplierand others.sql
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__create_dummy_users.sql
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__create_dummy_pharmacy.sql
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V4__create_dummy_supplierand others.sql
2025-06-01 06:48:10 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 06:48:10 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 06:48:10 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplierand others.sql (filename: V4__create_dummy_supplierand others.sql)
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplierand others.sql (filename: V4__create_dummy_supplierand others.sql)
2025-06-01 06:48:10 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Schema history table [clickhealthpharma].[dbo].[flyway_schema_history] does not exist yet
2025-06-01 06:48:10 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.088s)
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 06:48:10 [main] INFO  o.f.c.i.s.JdbcTableSchemaHistory - Creating Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] ...
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.parser.Parser - Parsing  ...
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 1: CREATE TABLE [clickhealthpharma].[dbo].[flyway_schema_history] (
    [installed_rank] INT NOT NULL,
    [version] NVARCHAR(50),
    [description] NVARCHAR(200),
    [type] NVARCHAR(20) NOT NULL,
    [script] NVARCHAR(1000) NOT NULL,
    [checksum] INT,
    [installed_by] NVARCHAR(100) NOT NULL,
    [installed_on] DATETIME NOT NULL DEFAULT GETDATE(),
    [execution_time] INT NOT NULL,
    [success] BIT NOT NULL
);
ALTER TABLE [clickhealthpharma].[dbo].[flyway_schema_history] ADD CONSTRAINT [flyway_schema_history_pk] PRIMARY KEY ([installed_rank]);
CREATE INDEX [flyway_schema_history_s_idx] ON [clickhealthpharma].[dbo].[flyway_schema_history] ([success]);
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: CREATE TABLE [clickhealthpharma].[dbo].[flyway_schema_history] (
    [installed_rank] INT NOT NULL,
    [version] NVARCHAR(50),
    [description] NVARCHAR(200),
    [type] NVARCHAR(20) NOT NULL,
    [script] NVARCHAR(1000) NOT NULL,
    [checksum] INT,
    [installed_by] NVARCHAR(100) NOT NULL,
    [installed_on] DATETIME NOT NULL DEFAULT GETDATE(),
    [execution_time] INT NOT NULL,
    [success] BIT NOT NULL
);
ALTER TABLE [clickhealthpharma].[dbo].[flyway_schema_history] ADD CONSTRAINT [flyway_schema_history_pk] PRIMARY KEY ([installed_rank]);
CREATE INDEX [flyway_schema_history_s_idx] ON [clickhealthpharma].[dbo].[flyway_schema_history] ([success]);
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.JdbcTableSchemaHistory - Created Schema History table [clickhealthpharma].[dbo].[flyway_schema_history]
2025-06-01 06:48:10 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: << Empty Schema >>
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V1__init_schema.sql ...
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Drop existing tables in reverse order of dependencies to avoid FK conflicts
IF OBJECT_ID('sale_items', 'U') IS NOT NULL DROP TABLE sale_items;
IF OBJECT_ID('sales', 'U') IS NOT NULL DROP TABLE sales;
IF OBJECT_ID('purchase_items', 'U') IS NOT NULL DROP TABLE purchase_items;
IF OBJECT_ID('purchases', 'U') IS NOT NULL DROP TABLE purchases;
IF OBJECT_ID('medicines', 'U') IS NOT NULL DROP TABLE medicines;
IF OBJECT_ID('suppliers', 'U') IS NOT NULL DROP TABLE suppliers;
IF OBJECT_ID('customers', 'U') IS NOT NULL DROP TABLE customers;
IF OBJECT_ID('users', 'U') IS NOT NULL DROP TABLE users;
IF OBJECT_ID('pharmacies', 'U') IS NOT NULL DROP TABLE pharmacies;

-- Customers
CREATE TABLE customers (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255),
    phone VARCHAR(50) NOT NULL,
    address VARCHAR(255),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100)
);

-- Suppliers
CREATE TABLE suppliers (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    contact_email VARCHAR(255) NOT NULL,
    phone VARCHAR(50) NOT NULL,
    address VARCHAR(255),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100)
);

-- Medicines
CREATE TABLE medicines (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    batch_number VARCHAR(255) NOT NULL,
    expiry_date DATE NOT NULL,
    quantity INT NOT NULL CHECK (quantity >= 0),
    price DECIMAL(10, 2) NOT NULL CHECK (price > 0),
    supplier_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
);

-- Purchases
CREATE TABLE purchases (
    id INT IDENTITY PRIMARY KEY,
    supplier_id INT NOT NULL,
    purchase_date DATETIME2 NOT NULL,
    total_amount DECIMAL(10, 2),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
);

-- Purchase Items
CREATE TABLE purchase_items (
    id BIGINT IDENTITY PRIMARY KEY,
    medicine_id INT NOT NULL,
    quantity INT NOT NULL,
    cost DECIMAL(10, 2) NOT NULL,
    purchase_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (medicine_id) REFERENCES medicines(id),
    FOREIGN KEY (purchase_id) REFERENCES purchases(id)
);

-- Sales
CREATE TABLE sales (
    id INT IDENTITY PRIMARY KEY,
    customer_id INT NOT NULL,
    sale_date DATETIMEOFFSET NOT NULL,
    total_amount DECIMAL(10, 2),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (customer_id) REFERENCES customers(id)
);

-- Sale Items
CREATE TABLE sale_items (
    id BIGINT IDENTITY PRIMARY KEY,
    medicine_id INT NOT NULL,
    quantity INT NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    sale_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (medicine_id) REFERENCES medicines(id),
    FOREIGN KEY (sale_id) REFERENCES sales(id)
);

-- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Users
CREATE TABLE users (
    id INT IDENTITY PRIMARY KEY,
    username VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(50) NOT NULL,
    status VARCHAR(50) NOT NULL DEFAULT 'ACTIVE',
    pharmacy_id INT NOT NULL,
    last_login_at DATETIMEOFFSET NULL,
    failed_login_attempts INT NOT NULL DEFAULT 0,
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET() NOT NULL,
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100),
    FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id)
);
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "1 - init schema" ...
2025-06-01 06:48:10 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "1 - init schema"
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Drop existing tables in reverse order of dependencies to avoid FK conflicts
IF OBJECT_ID('sale_items', 'U') IS NOT NULL DROP TABLE sale_items;
IF OBJECT_ID('sales', 'U') IS NOT NULL DROP TABLE sales;
IF OBJECT_ID('purchase_items', 'U') IS NOT NULL DROP TABLE purchase_items;
IF OBJECT_ID('purchases', 'U') IS NOT NULL DROP TABLE purchases;
IF OBJECT_ID('medicines', 'U') IS NOT NULL DROP TABLE medicines;
IF OBJECT_ID('suppliers', 'U') IS NOT NULL DROP TABLE suppliers;
IF OBJECT_ID('customers', 'U') IS NOT NULL DROP TABLE customers;
IF OBJECT_ID('users', 'U') IS NOT NULL DROP TABLE users;
IF OBJECT_ID('pharmacies', 'U') IS NOT NULL DROP TABLE pharmacies;

-- Customers
CREATE TABLE customers (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255),
    phone VARCHAR(50) NOT NULL,
    address VARCHAR(255),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100)
);

-- Suppliers
CREATE TABLE suppliers (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    contact_email VARCHAR(255) NOT NULL,
    phone VARCHAR(50) NOT NULL,
    address VARCHAR(255),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100)
);

-- Medicines
CREATE TABLE medicines (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    batch_number VARCHAR(255) NOT NULL,
    expiry_date DATE NOT NULL,
    quantity INT NOT NULL CHECK (quantity >= 0),
    price DECIMAL(10, 2) NOT NULL CHECK (price > 0),
    supplier_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
);

-- Purchases
CREATE TABLE purchases (
    id INT IDENTITY PRIMARY KEY,
    supplier_id INT NOT NULL,
    purchase_date DATETIME2 NOT NULL,
    total_amount DECIMAL(10, 2),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (supplier_id) REFERENCES suppliers(id)
);

-- Purchase Items
CREATE TABLE purchase_items (
    id BIGINT IDENTITY PRIMARY KEY,
    medicine_id INT NOT NULL,
    quantity INT NOT NULL,
    cost DECIMAL(10, 2) NOT NULL,
    purchase_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (medicine_id) REFERENCES medicines(id),
    FOREIGN KEY (purchase_id) REFERENCES purchases(id)
);

-- Sales
CREATE TABLE sales (
    id INT IDENTITY PRIMARY KEY,
    customer_id INT NOT NULL,
    sale_date DATETIMEOFFSET NOT NULL,
    total_amount DECIMAL(10, 2),
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (customer_id) REFERENCES customers(id)
);

-- Sale Items
CREATE TABLE sale_items (
    id BIGINT IDENTITY PRIMARY KEY,
    medicine_id INT NOT NULL,
    quantity INT NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    sale_id INT,
    created_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    created_by  VARCHAR(100),
    updated_at  DATETIME2 NOT NULL DEFAULT SYSDATETIME(),
    updated_by  VARCHAR(100),
    FOREIGN KEY (medicine_id) REFERENCES medicines(id),
    FOREIGN KEY (sale_id) REFERENCES sales(id)
);

-- Create pharmacies table
CREATE TABLE pharmacies (
    id INT IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    address VARCHAR(500),
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100)
);

-- Users
CREATE TABLE users (
    id INT IDENTITY PRIMARY KEY,
    username VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(50) NOT NULL,
    status VARCHAR(50) NOT NULL DEFAULT 'ACTIVE',
    pharmacy_id INT NOT NULL,
    last_login_at DATETIMEOFFSET NULL,
    failed_login_attempts INT NOT NULL DEFAULT 0,
    created_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET() NOT NULL,
    created_by VARCHAR(100),
    updated_at DATETIMEOFFSET DEFAULT SYSDATETIMEOFFSET(),
    updated_by VARCHAR(100),
    FOREIGN KEY (pharmacy_id) REFERENCES pharmacies(id)
);
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 0 rows affected
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.command.DbMigrate - Successfully completed migration of schema [dbo] to version "1 - init schema"
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.JdbcTableSchemaHistory - Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] successfully updated to reflect changes
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V2__create_dummy_pharmacy.sql ...
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 2: -- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');
2025-06-01 06:48:10 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "2 - create dummy pharmacy" ...
2025-06-01 06:48:10 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "2 - create dummy pharmacy"
2025-06-01 06:48:10 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Insert a default pharmacy
INSERT INTO pharmacies (name, address, created_by, updated_by)
VALUES ('Default Pharmacy', 'N/A', 'system', 'system');
2025-06-01 06:48:11 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 1 row affected
2025-06-01 06:48:11 [main] DEBUG o.f.core.internal.command.DbMigrate - Successfully completed migration of schema [dbo] to version "2 - create dummy pharmacy"
2025-06-01 06:48:11 [main] DEBUG o.f.c.i.s.JdbcTableSchemaHistory - Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] successfully updated to reflect changes
2025-06-01 06:48:11 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V3__create_dummy_users.sql ...
2025-06-01 06:48:11 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 3: -- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');
2025-06-01 06:48:11 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "3 - create dummy users" ...
2025-06-01 06:48:11 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "3 - create dummy users"
2025-06-01 06:48:11 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Insert demo Users
INSERT INTO users (username, password, role, pharmacy_id, status, created_by, updated_by)
VALUES
('admin', 'admin123', 'ADMIN', 1, 'ACTIVE',  'system', 'system'),
('cashier1', 'cashier123', 'CASHIER',1,  'ACTIVE', 'system', 'system');


-- Insert demo Customers
INSERT INTO customers (name, email, phone, address, created_by, updated_by)
VALUES
('John Doe', 'john@example.com', '1234567890', '123 Main St', 'admin', 'admin'),
('Jane Smith', 'jane@example.com', '9876543210', '456 Oak St', 'admin', 'admin');
2025-06-01 06:48:11 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 2 rows affected
2025-06-01 06:48:11 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 2 rows affected
2025-06-01 06:48:11 [main] DEBUG o.f.core.internal.command.DbMigrate - Successfully completed migration of schema [dbo] to version "3 - create dummy users"
2025-06-01 06:48:11 [main] DEBUG o.f.c.i.s.JdbcTableSchemaHistory - Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] successfully updated to reflect changes
2025-06-01 06:48:11 [main] DEBUG o.f.core.internal.parser.Parser - Parsing V4__create_dummy_supplierand others.sql ...
2025-06-01 06:48:11 [main] DEBUG o.f.c.i.sqlscript.ParserSqlScript - Found statement at line 3: -- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2
2025-06-01 06:48:11 [main] DEBUG o.f.core.internal.command.DbMigrate - Starting migration of schema [dbo] to version "4 - create dummy supplierand others" ...
2025-06-01 06:48:11 [main] INFO  o.f.core.internal.command.DbMigrate - Migrating schema [dbo] to version "4 - create dummy supplierand others"
2025-06-01 06:48:11 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - Executing SQL: -- Insert demo Suppliers
INSERT INTO suppliers (name, contact_email, phone, address, created_by, updated_by)
VALUES
('MediSupply Co', 'contact@medisupply.com', '1112223333', '789 Supplier Rd', 'admin', 'admin'),
('PharmaPlus Ltd', 'support@pharmaplus.com', '4445556666', '321 Health Ave', 'admin', 'admin');

-- Insert demo Medicines
INSERT INTO medicines (name, batch_number, expiry_date, quantity, price, supplier_id, created_by, updated_by)
VALUES
('Paracetamol 500mg', 'BATCH001', '2026-12-31', 100, 2.50, 1, 'admin', 'admin'),
('Ibuprofen 200mg', 'BATCH002', '2025-11-30', 200, 3.00, 2, 'admin', 'admin');

-- Insert demo Sales
INSERT INTO sales (customer_id, sale_date, total_amount, created_by, updated_by)
VALUES
(1, SYSDATETIMEOFFSET(), 10.00, 'admin', 'admin'),
(2, SYSDATETIMEOFFSET(), 6.00, 'admin', 'admin');

-- Insert demo Sale Items
INSERT INTO sale_items (medicine_id, quantity, price, sale_id, created_by, updated_by)
VALUES
(1, 2, 2.50, 1, 'admin', 'admin'),  -- 2 units of medicine_id 1
(2, 2, 3.00, 2, 'admin', 'admin');  -- 2 units of medicine_id 2
2025-06-01 06:48:11 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 2 rows affected
2025-06-01 06:48:11 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 2 rows affected
2025-06-01 06:48:11 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 2 rows affected
2025-06-01 06:48:11 [main] DEBUG o.f.c.i.s.DefaultSqlScriptExecutor - 2 rows affected
2025-06-01 06:48:11 [main] DEBUG o.f.core.internal.command.DbMigrate - Successfully completed migration of schema [dbo] to version "4 - create dummy supplierand others"
2025-06-01 06:48:11 [main] DEBUG o.f.c.i.s.JdbcTableSchemaHistory - Schema History table [clickhealthpharma].[dbo].[flyway_schema_history] successfully updated to reflect changes
2025-06-01 06:48:11 [main] INFO  o.f.core.internal.command.DbMigrate - Successfully applied 4 migrations to schema [dbo], now at version v4 (execution time 00:00.197s)
2025-06-01 06:48:11 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 35 of 80M
2025-06-01 06:48:11 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 06:48:11 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 06:48:11 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 06:48:12 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 06:48:12 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 06:48:16 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 06:48:16 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 06:48:17 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 06:48:17 [main] WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: 9829b5c9-df70-4580-9c24-b81052304402

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-06-01 06:48:18 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@3687f6b6, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@521e34d4, org.springframework.security.web.context.SecurityContextHolderFilter@35d31e1c, org.springframework.security.web.header.HeaderWriterFilter@6d13cd6d, org.springframework.web.filter.CorsFilter@49c74506, org.springframework.security.web.authentication.logout.LogoutFilter@3747877, com.clickhealth.pharma.security.JwtAuthFilter@2be9add0, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@644eed73, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@253a8bdb, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@2252dc5d, org.springframework.security.web.session.SessionManagementFilter@500d4de8, org.springframework.security.web.access.ExceptionTranslationFilter@24032706, org.springframework.security.web.access.intercept.AuthorizationFilter@4ff5711b]
2025-06-01 06:48:19 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 06:48:19 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 06:48:19 [main] INFO  com.clickhealth.pharma.Application - Started Application in 16.759 seconds (process running for 17.323)
2025-06-01 06:48:28 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-01 06:48:28 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-01 06:48:28 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 4 ms
2025-06-01 06:48:29 [http-nio-8080-exec-8] INFO  o.s.api.AbstractOpenApiResource - Init duration for springdoc-openapi is: 1041 ms
2025-06-01 06:48:45 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - select ue1_0.id,ue1_0.created_at,ue1_0.created_by,ue1_0.failed_login_attempts,ue1_0.last_login_at,ue1_0.password,ue1_0.role,ue1_0.status,ue1_0.updated_at,ue1_0.updated_by,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-06-01 06:48:45 [http-nio-8080-exec-9] ERROR c.c.p.services.impl.UserServiceImpl - Login Failed : Invalid Password for User ABS
2025-06-01 06:49:24 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - select ue1_0.id,ue1_0.created_at,ue1_0.created_by,ue1_0.failed_login_attempts,ue1_0.last_login_at,ue1_0.password,ue1_0.role,ue1_0.status,ue1_0.updated_at,ue1_0.updated_by,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-06-01 06:49:24 [http-nio-8080-exec-10] WARN  o.s.s.c.bcrypt.BCryptPasswordEncoder - Encoded password does not look like BCrypt
2025-06-01 06:49:24 [http-nio-8080-exec-10] ERROR c.c.p.services.impl.UserServiceImpl - Login Failed : Invalid Password for User admin
2025-06-01 06:53:27 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - select ue1_0.id,ue1_0.created_at,ue1_0.created_by,ue1_0.failed_login_attempts,ue1_0.last_login_at,ue1_0.password,ue1_0.role,ue1_0.status,ue1_0.updated_at,ue1_0.updated_by,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-06-01 06:53:28 [http-nio-8080-exec-4] ERROR c.c.p.services.impl.UserServiceImpl - Login Failed : Invalid Password for User admin
2025-06-01 06:53:43 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - select ue1_0.id,ue1_0.created_at,ue1_0.created_by,ue1_0.failed_login_attempts,ue1_0.last_login_at,ue1_0.password,ue1_0.role,ue1_0.status,ue1_0.updated_at,ue1_0.updated_by,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-06-01 06:53:43 [http-nio-8080-exec-5] ERROR c.c.p.services.impl.UserServiceImpl - Login Failed : Invalid Password for User admin
2025-06-01 06:56:48 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 06:56:48 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 06:56:48 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 06:57:11 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 06:57:11 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 58797 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 06:57:11 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 06:57:14 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 06:57:14 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 166 ms. Found 6 JPA repository interfaces.
2025-06-01 06:57:16 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 06:57:16 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 06:57:16 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 06:57:16 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 06:57:16 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 06:57:16 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3985 ms
2025-06-01 06:57:16 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 06:57:17 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 86741c76-d976-4bd8-b67a-ed88ff39cfd2
2025-06-01 06:57:17 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 06:57:17 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 06:57:17 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 06:57:17 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__create_dummy_pharmacy.sql
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__create_dummy_users.sql
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V4__create_dummy_supplierand others.sql
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 06:57:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__create_dummy_users.sql
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__create_dummy_pharmacy.sql
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V4__create_dummy_supplierand others.sql
2025-06-01 06:57:17 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 06:57:17 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 06:57:17 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 06:57:17 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 06:57:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:57:17 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 06:57:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:57:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:57:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 06:57:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:57:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 06:57:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplierand others.sql (filename: V4__create_dummy_supplierand others.sql)
2025-06-01 06:57:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 06:57:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 06:57:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 06:57:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 06:57:17 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplierand others.sql (filename: V4__create_dummy_supplierand others.sql)
2025-06-01 06:57:17 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.118s)
2025-06-01 06:57:17 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 06:57:17 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 4
2025-06-01 06:57:17 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 06:57:17 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 25 of 88M
2025-06-01 06:57:18 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 06:57:18 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 06:57:18 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 06:57:19 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 06:57:19 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 06:57:21 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 06:57:21 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 06:57:23 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 06:57:24 [main] WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: f25b2f08-5ff6-472a-9c1d-6d65985b840e

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-06-01 06:57:24 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@40a360e6, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@21f9764, org.springframework.security.web.context.SecurityContextHolderFilter@6461c673, org.springframework.security.web.header.HeaderWriterFilter@7d2d5625, org.springframework.web.filter.CorsFilter@378456cb, org.springframework.security.web.authentication.logout.LogoutFilter@2b43eb71, com.clickhealth.pharma.security.JwtAuthFilter@5295779, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@62a09668, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@5232cec1, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@5ed6a36a, org.springframework.security.web.session.SessionManagementFilter@5b3427c4, org.springframework.security.web.access.ExceptionTranslationFilter@5e8359da, org.springframework.security.web.access.intercept.AuthorizationFilter@73b63917]
2025-06-01 06:57:25 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 06:57:25 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 06:57:25 [main] INFO  com.clickhealth.pharma.Application - Started Application in 15.011 seconds (process running for 15.657)
2025-06-01 06:57:51 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-01 06:57:51 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-01 06:57:51 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-06-01 06:57:52 [http-nio-8080-exec-8] INFO  o.s.api.AbstractOpenApiResource - Init duration for springdoc-openapi is: 971 ms
2025-06-01 06:58:05 [http-nio-8080-exec-9] INFO  c.c.p.services.impl.UserServiceImpl - pass : $2a$10$t6IPzA8zY60.STxjJT6NWOHunzI16GWxkCpa8AuBc6Lz6lSftVDOi
2025-06-01 06:58:06 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - select ue1_0.id,ue1_0.created_at,ue1_0.created_by,ue1_0.failed_login_attempts,ue1_0.last_login_at,ue1_0.password,ue1_0.role,ue1_0.status,ue1_0.updated_at,ue1_0.updated_by,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-06-01 06:58:06 [http-nio-8080-exec-9] INFO  c.c.p.services.impl.UserServiceImpl - pass : $2a$10$g7Vk1WGR7Jo5Lm5kYo7W2enMb6dyBi3OcI7e2F.XG9opBf9ee0qGu
2025-06-01 06:58:06 [http-nio-8080-exec-9] ERROR c.c.p.services.impl.UserServiceImpl - Login Failed : Invalid Password for User admin
2025-06-01 06:58:38 [http-nio-8080-exec-10] INFO  c.c.p.services.impl.UserServiceImpl - pass : $2a$10$W4KPfJ7CrSV37Kh3B9vGAegL5TcYc0/dKIpydA456lcnJyxumHQtW
2025-06-01 06:58:39 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - select ue1_0.id,ue1_0.created_at,ue1_0.created_by,ue1_0.failed_login_attempts,ue1_0.last_login_at,ue1_0.password,ue1_0.role,ue1_0.status,ue1_0.updated_at,ue1_0.updated_by,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-06-01 06:58:39 [http-nio-8080-exec-10] INFO  c.c.p.services.impl.UserServiceImpl - pass : $2a$10$t6IPzA8zY60.STxjJT6NWOHunzI16GWxkCpa8AuBc6Lz6lSftVDOi
2025-06-01 07:02:28 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 07:02:28 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 07:02:28 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 07:03:30 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 07:03:31 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 59607 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 07:03:31 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 07:03:34 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 07:03:34 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 191 ms. Found 6 JPA repository interfaces.
2025-06-01 07:03:35 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 07:03:35 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 07:03:35 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 07:03:35 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 07:03:35 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 07:03:35 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 4347 ms
2025-06-01 07:03:36 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 07:03:36 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 77c41fcf-15bb-4e83-aa3c-ff2abe73bbab
2025-06-01 07:03:36 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 07:03:37 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 07:03:37 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 07:03:37 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__create_dummy_pharmacy.sql
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__create_dummy_users.sql
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V4__create_dummy_supplierand others.sql
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 07:03:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__create_dummy_users.sql
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__create_dummy_pharmacy.sql
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V4__create_dummy_supplierand others.sql
2025-06-01 07:03:37 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 07:03:37 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 07:03:37 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 07:03:37 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 07:03:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 07:03:37 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 07:03:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 07:03:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 07:03:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 07:03:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 07:03:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 07:03:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplierand others.sql (filename: V4__create_dummy_supplierand others.sql)
2025-06-01 07:03:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 07:03:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 07:03:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 07:03:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 07:03:37 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplierand others.sql (filename: V4__create_dummy_supplierand others.sql)
2025-06-01 07:03:37 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.137s)
2025-06-01 07:03:37 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 07:03:37 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 4
2025-06-01 07:03:37 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 07:03:37 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 23 of 94M
2025-06-01 07:03:37 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 07:03:38 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 07:03:38 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 07:03:38 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 07:03:39 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 07:03:42 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 07:03:42 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 07:03:43 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 07:03:43 [main] WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: c29fab56-768c-47d1-a6de-03aad01bfae0

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-06-01 07:03:44 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@7701b695, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@524945e2, org.springframework.security.web.context.SecurityContextHolderFilter@28ab7ffb, org.springframework.security.web.header.HeaderWriterFilter@6ea0dfaa, org.springframework.web.filter.CorsFilter@73b63917, org.springframework.security.web.authentication.logout.LogoutFilter@2e5dea22, com.clickhealth.pharma.security.JwtAuthFilter@2292e793, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@5b3427c4, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@5275d709, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@58dd584a, org.springframework.security.web.session.SessionManagementFilter@51c7d472, org.springframework.security.web.access.ExceptionTranslationFilter@32180efb, org.springframework.security.web.access.intercept.AuthorizationFilter@6829b897]
2025-06-01 07:03:45 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 07:03:45 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 07:03:45 [main] INFO  com.clickhealth.pharma.Application - Started Application in 16.499 seconds (process running for 17.159)
2025-06-01 07:03:56 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-01 07:03:56 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-01 07:03:56 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-06-01 07:03:57 [http-nio-8080-exec-8] INFO  o.s.api.AbstractOpenApiResource - Init duration for springdoc-openapi is: 1030 ms
2025-06-01 07:04:10 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - select ue1_0.id,ue1_0.created_at,ue1_0.created_by,ue1_0.failed_login_attempts,ue1_0.last_login_at,ue1_0.password,ue1_0.role,ue1_0.status,ue1_0.updated_at,ue1_0.updated_by,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-06-01 07:04:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - select ue1_0.id,ue1_0.created_at,ue1_0.created_by,ue1_0.failed_login_attempts,ue1_0.last_login_at,ue1_0.password,ue1_0.role,ue1_0.status,ue1_0.updated_at,ue1_0.updated_by,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-06-01 07:04:19 [http-nio-8080-exec-10] ERROR c.c.p.services.impl.UserServiceImpl - Login Failed : Invalid Password for User admin
2025-06-01 08:31:49 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 08:31:49 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 08:31:49 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 08:32:15 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 08:32:15 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 64283 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 08:32:15 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 08:32:16 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 08:32:16 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 94 ms. Found 6 JPA repository interfaces.
2025-06-01 08:32:17 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 08:32:17 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 08:32:17 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 08:32:17 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 08:32:17 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 08:32:17 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1855 ms
2025-06-01 08:32:17 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 08:32:22 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 702d5544-aeaf-4d98-9171-1a3f842db747
2025-06-01 08:32:22 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 08:32:23 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 08:32:23 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 08:32:23 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__create_dummy_pharmacy.sql
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__create_dummy_users.sql
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V4__create_dummy_supplierand others.sql
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 08:32:23 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__create_dummy_users.sql
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__create_dummy_pharmacy.sql
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V4__create_dummy_supplierand others.sql
2025-06-01 08:32:23 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 08:32:23 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 08:32:23 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 08:32:23 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 08:32:23 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:32:23 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 08:32:23 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:32:23 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:32:23 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 08:32:23 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 08:32:23 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 08:32:23 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplierand others.sql (filename: V4__create_dummy_supplierand others.sql)
2025-06-01 08:32:23 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:32:23 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 08:32:23 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 08:32:23 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 08:32:23 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplierand others.sql (filename: V4__create_dummy_supplierand others.sql)
2025-06-01 08:32:23 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.062s)
2025-06-01 08:32:23 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 08:32:23 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 4
2025-06-01 08:32:23 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 08:32:23 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 26 of 80M
2025-06-01 08:32:23 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 08:32:23 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 08:32:23 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 08:32:23 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 08:32:24 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 08:32:25 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 08:32:25 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 08:32:25 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 08:32:25 [main] WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: 41f4f022-1ded-4829-a34d-202ae490c17e

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-06-01 08:32:26 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@519e0814, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@d1b9dd7, org.springframework.security.web.context.SecurityContextHolderFilter@3aa4d595, org.springframework.security.web.header.HeaderWriterFilter@32180efb, org.springframework.web.filter.CorsFilter@7701b695, org.springframework.security.web.authentication.logout.LogoutFilter@1ff35ee7, com.clickhealth.pharma.security.JwtAuthFilter@524945e2, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@28ab7ffb, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@47a05ad8, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@73b63917, org.springframework.security.web.session.SessionManagementFilter@79c9a128, org.springframework.security.web.access.ExceptionTranslationFilter@25192b6e, org.springframework.security.web.access.intercept.AuthorizationFilter@1b68e626]
2025-06-01 08:32:26 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 08:32:26 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 08:32:26 [main] INFO  com.clickhealth.pharma.Application - Started Application in 11.953 seconds (process running for 12.359)
2025-06-01 08:32:33 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-01 08:32:33 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-01 08:32:33 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-06-01 08:32:34 [http-nio-8080-exec-8] INFO  o.s.api.AbstractOpenApiResource - Init duration for springdoc-openapi is: 1015 ms
2025-06-01 08:32:52 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@1675231584 wrapping ConnectionID:1 ClientConnectionId: 702d5544-aeaf-4d98-9171-1a3f842db747] read-only
2025-06-01 08:32:52 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - select me1_0.id,me1_0.batch_number,me1_0.created_at,me1_0.created_by,me1_0.expiry_date,me1_0.name,me1_0.price,me1_0.quantity,me1_0.supplier_id,me1_0.updated_at,me1_0.updated_by from medicines me1_0
2025-06-01 08:32:52 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@1675231584 wrapping ConnectionID:1 ClientConnectionId: 702d5544-aeaf-4d98-9171-1a3f842db747]
2025-06-01 08:39:45 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 08:39:45 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 08:39:45 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 08:40:31 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 08:40:31 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 65281 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 08:40:31 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 08:40:32 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 08:40:32 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 77 ms. Found 6 JPA repository interfaces.
2025-06-01 08:40:33 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 08:40:33 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 08:40:33 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 08:40:33 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 08:40:33 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 08:40:33 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1848 ms
2025-06-01 08:40:33 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 08:40:34 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: e1b3fb9a-c38f-45da-b487-21254366518a
2025-06-01 08:40:34 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 08:40:34 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 08:40:34 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 08:40:34 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__create_dummy_pharmacy.sql
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__create_dummy_users.sql
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V4__create_dummy_supplierand others.sql
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 08:40:34 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__create_dummy_users.sql
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__create_dummy_pharmacy.sql
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V4__create_dummy_supplierand others.sql
2025-06-01 08:40:34 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 08:40:34 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 08:40:34 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 08:40:34 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 08:40:34 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:40:34 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 08:40:34 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:40:34 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:40:34 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 08:40:34 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 08:40:34 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 08:40:34 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplierand others.sql (filename: V4__create_dummy_supplierand others.sql)
2025-06-01 08:40:34 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:40:34 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 08:40:34 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 08:40:34 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 08:40:34 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplierand others.sql (filename: V4__create_dummy_supplierand others.sql)
2025-06-01 08:40:34 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.056s)
2025-06-01 08:40:34 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 08:40:34 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 4
2025-06-01 08:40:34 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 08:40:34 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 24 of 88M
2025-06-01 08:40:34 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 08:40:34 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 08:40:34 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 08:40:34 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 08:40:34 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 08:40:36 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 08:40:36 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 08:40:36 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 08:40:36 [main] WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: d95f104f-4baf-478e-830f-5f0c4a4882a1

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-06-01 08:40:37 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@40a360e6, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@21f9764, org.springframework.security.web.context.SecurityContextHolderFilter@6461c673, org.springframework.security.web.header.HeaderWriterFilter@7d2d5625, org.springframework.web.filter.CorsFilter@378456cb, org.springframework.security.web.authentication.logout.LogoutFilter@2b43eb71, com.clickhealth.pharma.security.JwtAuthFilter@5295779, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@62a09668, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@5232cec1, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@5ed6a36a, org.springframework.security.web.session.SessionManagementFilter@5b3427c4, org.springframework.security.web.access.ExceptionTranslationFilter@5e8359da, org.springframework.security.web.access.intercept.AuthorizationFilter@73b63917]
2025-06-01 08:40:37 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 08:40:37 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 08:40:37 [main] INFO  com.clickhealth.pharma.Application - Started Application in 6.441 seconds (process running for 6.836)
2025-06-01 08:40:52 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-01 08:40:52 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-01 08:40:52 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 5 ms
2025-06-01 08:40:53 [http-nio-8080-exec-8] INFO  o.s.api.AbstractOpenApiResource - Init duration for springdoc-openapi is: 998 ms
2025-06-01 08:41:23 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@152369083 wrapping ConnectionID:1 ClientConnectionId: e1b3fb9a-c38f-45da-b487-21254366518a] read-only
2025-06-01 08:41:23 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - select me1_0.id,me1_0.batch_number,me1_0.created_at,me1_0.created_by,me1_0.expiry_date,me1_0.name,me1_0.price,me1_0.quantity,me1_0.supplier_id,me1_0.updated_at,me1_0.updated_by from medicines me1_0
2025-06-01 08:41:23 [http-nio-8080-exec-9] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@152369083 wrapping ConnectionID:1 ClientConnectionId: e1b3fb9a-c38f-45da-b487-21254366518a]
2025-06-01 08:50:15 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 08:50:15 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 08:50:15 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 08:50:43 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 08:50:43 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 66647 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 08:50:43 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 08:50:44 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 08:50:44 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 102 ms. Found 6 JPA repository interfaces.
2025-06-01 08:50:45 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 08:50:45 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 08:50:45 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 08:50:45 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 08:50:45 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 08:50:45 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 2003 ms
2025-06-01 08:50:45 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 08:50:45 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 3f294e47-f0a7-478d-b88e-251d0e4ba3b0
2025-06-01 08:50:45 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 08:50:45 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 08:50:45 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 08:50:45 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__create_dummy_pharmacy.sql
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__create_dummy_users.sql
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V4__create_dummy_supplierand others.sql
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 08:50:45 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__create_dummy_users.sql
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__create_dummy_pharmacy.sql
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V4__create_dummy_supplierand others.sql
2025-06-01 08:50:45 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 08:50:45 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 08:50:45 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 08:50:45 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 08:50:45 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:50:45 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 08:50:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:50:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:50:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 08:50:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 08:50:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 08:50:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplierand others.sql (filename: V4__create_dummy_supplierand others.sql)
2025-06-01 08:50:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:50:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 08:50:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 08:50:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 08:50:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplierand others.sql (filename: V4__create_dummy_supplierand others.sql)
2025-06-01 08:50:46 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.059s)
2025-06-01 08:50:46 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 08:50:46 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 4
2025-06-01 08:50:46 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 08:50:46 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 29 of 80M
2025-06-01 08:50:46 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 08:50:46 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 08:50:46 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 08:50:46 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 08:50:46 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 08:50:48 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 08:50:48 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 08:50:49 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 08:50:49 [main] WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: d934b193-b8d3-4df2-b208-bf2591628f99

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-06-01 08:50:49 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@40a360e6, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@21f9764, org.springframework.security.web.context.SecurityContextHolderFilter@6461c673, org.springframework.security.web.header.HeaderWriterFilter@7d2d5625, org.springframework.web.filter.CorsFilter@378456cb, org.springframework.security.web.authentication.logout.LogoutFilter@2b43eb71, com.clickhealth.pharma.security.JwtAuthFilter@5295779, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@62a09668, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@5232cec1, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@5ed6a36a, org.springframework.security.web.session.SessionManagementFilter@5b3427c4, org.springframework.security.web.access.ExceptionTranslationFilter@5e8359da, org.springframework.security.web.access.intercept.AuthorizationFilter@73b63917]
2025-06-01 08:50:49 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 08:50:49 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 08:50:49 [main] INFO  com.clickhealth.pharma.Application - Started Application in 7.384 seconds (process running for 7.79)
2025-06-01 08:50:53 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-01 08:50:53 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-01 08:50:53 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-06-01 08:50:55 [http-nio-8080-exec-8] INFO  o.s.api.AbstractOpenApiResource - Init duration for springdoc-openapi is: 1300 ms
2025-06-01 08:53:10 [http-nio-8080-exec-9] DEBUG o.s.api.AbstractOpenApiResource - Fetching openApi document from cache
2025-06-01 08:55:04 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 08:55:04 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 08:55:04 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 08:55:37 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 08:55:38 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 67409 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 08:55:38 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 08:55:40 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 08:55:41 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 225 ms. Found 6 JPA repository interfaces.
2025-06-01 08:55:43 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 08:55:43 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 08:55:43 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 08:55:43 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 08:55:43 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 08:55:43 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 5450 ms
2025-06-01 08:55:44 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 08:55:45 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: 2381475d-1641-45fc-9478-650aab443a35
2025-06-01 08:55:45 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 08:55:45 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 08:55:45 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 08:55:45 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__create_dummy_pharmacy.sql
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__create_dummy_users.sql
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V4__create_dummy_supplierand others.sql
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 08:55:45 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__create_dummy_users.sql
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__create_dummy_pharmacy.sql
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V4__create_dummy_supplierand others.sql
2025-06-01 08:55:45 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 08:55:45 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 08:55:45 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 08:55:45 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 08:55:46 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 08:55:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:55:46 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 08:55:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:55:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:55:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 08:55:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 08:55:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 08:55:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplierand others.sql (filename: V4__create_dummy_supplierand others.sql)
2025-06-01 08:55:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 08:55:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 08:55:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 08:55:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 08:55:46 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplierand others.sql (filename: V4__create_dummy_supplierand others.sql)
2025-06-01 08:55:46 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.123s)
2025-06-01 08:55:46 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 08:55:46 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 4
2025-06-01 08:55:46 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 08:55:46 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 27 of 88M
2025-06-01 08:55:46 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 08:55:46 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 08:55:46 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 08:55:48 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 08:55:48 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 08:55:51 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 08:55:51 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 08:55:53 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 08:55:53 [main] WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: ea0bb035-da35-458b-a10c-07d06147a8c1

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-06-01 08:55:54 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@1007954a, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@10770c1, org.springframework.security.web.context.SecurityContextHolderFilter@7d2d5625, org.springframework.security.web.header.HeaderWriterFilter@7e93e396, org.springframework.web.filter.CorsFilter@35ab0bf3, org.springframework.security.web.authentication.logout.LogoutFilter@5014ccf9, com.clickhealth.pharma.security.JwtAuthFilter@dd26290, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@6dacde96, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@6f999cf4, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@21d30ba5, org.springframework.security.web.session.SessionManagementFilter@2acfd27b, org.springframework.security.web.access.ExceptionTranslationFilter@39240aa3, org.springframework.security.web.access.intercept.AuthorizationFilter@21e60eed]
2025-06-01 08:55:55 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 08:55:55 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 08:55:55 [main] INFO  com.clickhealth.pharma.Application - Started Application in 19.142 seconds (process running for 20.033)
2025-06-01 08:56:50 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-01 08:56:50 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-01 08:56:50 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 2 ms
2025-06-01 08:56:51 [http-nio-8080-exec-8] INFO  o.s.api.AbstractOpenApiResource - Init duration for springdoc-openapi is: 1048 ms
2025-06-01 08:57:59 [http-nio-8080-exec-8] INFO  c.c.p.controller.CustomerController - Request recieved to fetch complete customer list
2025-06-01 08:57:59 [http-nio-8080-exec-8] DEBUG o.s.jdbc.datasource.DataSourceUtils - Setting JDBC Connection [HikariProxyConnection@704047408 wrapping ConnectionID:1 ClientConnectionId: 2381475d-1641-45fc-9478-650aab443a35] read-only
2025-06-01 08:57:59 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - select ce1_0.id,ce1_0.address,ce1_0.created_at,ce1_0.created_by,ce1_0.email,ce1_0.name,ce1_0.phone,ce1_0.updated_at,ce1_0.updated_by from customers ce1_0
2025-06-01 08:57:59 [http-nio-8080-exec-8] DEBUG o.s.jdbc.datasource.DataSourceUtils - Resetting read-only flag of JDBC Connection [HikariProxyConnection@704047408 wrapping ConnectionID:1 ClientConnectionId: 2381475d-1641-45fc-9478-650aab443a35]
2025-06-01 10:15:35 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 10:15:35 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 10:15:35 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-06-01 10:15:52 [background-preinit] INFO  o.h.validator.internal.util.Version - HV000001: Hibernate Validator 8.0.1.Final
2025-06-01 10:15:52 [main] INFO  com.clickhealth.pharma.Application - Starting Application using Java 17.0.15 with PID 70908 (/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar started by malay in /opt/theatro/source/clickhealthpharma)
2025-06-01 10:15:52 [main] INFO  com.clickhealth.pharma.Application - No active profile set, falling back to 1 default profile: "default"
2025-06-01 10:15:54 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-06-01 10:15:54 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 208 ms. Found 6 JPA repository interfaces.
2025-06-01 10:15:55 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-06-01 10:15:55 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8080"]
2025-06-01 10:15:55 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-06-01 10:15:55 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.20]
2025-06-01 10:15:56 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-06-01 10:15:56 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 3635 ms
2025-06-01 10:15:56 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-06-01 10:15:56 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection ConnectionID:1 ClientConnectionId: dfddd745-51c0-46fd-a0da-b863382686c5
2025-06-01 10:15:56 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-06-01 10:15:57 [main] INFO  o.f.c.i.license.VersionPrinter - Flyway Community Edition 9.22.3 by Redgate
2025-06-01 10:15:57 [main] INFO  o.f.c.i.license.VersionPrinter - See release notes here: https://rd.gt/416ObMi
2025-06-01 10:15:57 [main] INFO  o.f.c.i.license.VersionPrinter - 
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/callback' ...
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/callback using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Unable to resolve location classpath:db/callback.
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classpath resources at 'classpath:db/migration' ...
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Determining location urls for classpath:db/migration using ClassLoader org.springframework.boot.loader.launch.LaunchedClassLoader@54bedef2 ...
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning URL: jar:nested:/opt/theatro/source/clickhealthpharma/target/phrama-1.0.0-SNAPSHOT.jar/!BOOT-INF/classes/!/db/migration
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V1__init_schema.sql
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V2__create_dummy_pharmacy.sql
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V3__create_dummy_users.sql
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Found resource: db/migration/V4__create_dummy_supplierand others.sql
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.s.classpath.ClassPathScanner - Scanning for classes at classpath:db/migration
2025-06-01 10:15:57 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V3__create_dummy_users.sql
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V1__init_schema.sql
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V2__create_dummy_pharmacy.sql
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.r.ResourceNameValidator - Validating V4__create_dummy_supplierand others.sql
2025-06-01 10:15:57 [main] INFO  org.flywaydb.core.FlywayExecutor - Database: jdbc:sqlserver://localhost:1433;connectRetryInterval=10;connectRetryCount=1;maxResultBuffer=-1;sendTemporalDataTypesAsStringForBulkCopy=true;delayLoadingLobs=true;useFmtOnly=false;useBulkCopyForBatchInsert=false;cancelQueryTimeout=-1;sslProtocol=TLS;jaasConfigurationName=SQLJDBCDriver;statementPoolingCacheSize=0;serverPreparedStatementDiscardThreshold=10;enablePrepareOnFirstPreparedStatementCall=false;fips=false;socketTimeout=0;authentication=NotSpecified;authenticationScheme=nativeAuthentication;xopenStates=false;datetimeParameterType=datetime2;sendTimeAsDatetime=true;replication=false;trustStoreType=JKS;trustServerCertificate=true;TransparentNetworkIPResolution=true;iPAddressPreference=IPv4First;serverNameAsACE=false;sendStringParametersAsUnicode=true;selectMethod=direct;responseBuffering=adaptive;queryTimeout=-1;packetSize=8000;multiSubnetFailover=false;loginTimeout=30;lockTimeout=-1;lastUpdateCount=true;prepareMethod=prepexec;encrypt=true;disableStatementPooling=true;databaseName=clickhealthpharma;columnEncryptionSetting=Disabled;applicationName=Microsoft JDBC Driver for SQL Server;applicationIntent=readwrite; (Microsoft SQL Server 16.0)
2025-06-01 10:15:57 [main] DEBUG org.flywaydb.core.FlywayExecutor - Driver: Microsoft JDBC Driver 12.4 for SQL Server 12.4.2.0
2025-06-01 10:15:57 [main] DEBUG org.flywaydb.core.FlywayExecutor - DDL Transactions Supported: true
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Schemas: 
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.s.SchemaHistoryFactory - Default schema: null
2025-06-01 10:15:57 [main] DEBUG o.f.c.i.c.SqlScriptCallbackFactory - Scanning for SQL callbacks ...
2025-06-01 10:15:57 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 10:15:57 [main] DEBUG o.f.core.internal.command.DbValidate - Validating migrations ...
2025-06-01 10:15:57 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 10:15:57 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 10:15:57 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 10:15:57 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 10:15:57 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 10:15:57 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplierand others.sql (filename: V4__create_dummy_supplierand others.sql)
2025-06-01 10:15:57 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/ (filename: )
2025-06-01 10:15:57 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V3__create_dummy_users.sql (filename: V3__create_dummy_users.sql)
2025-06-01 10:15:57 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V1__init_schema.sql (filename: V1__init_schema.sql)
2025-06-01 10:15:57 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V2__create_dummy_pharmacy.sql (filename: V2__create_dummy_pharmacy.sql)
2025-06-01 10:15:57 [main] DEBUG o.f.core.internal.scanner.Scanner - Filtering out resource: db/migration/V4__create_dummy_supplierand others.sql (filename: V4__create_dummy_supplierand others.sql)
2025-06-01 10:15:57 [main] INFO  o.f.core.internal.command.DbValidate - Successfully validated 4 migrations (execution time 00:00.077s)
2025-06-01 10:15:57 [main] DEBUG o.f.core.internal.command.DbSchemas - Skipping creation of existing schema: [dbo]
2025-06-01 10:15:57 [main] INFO  o.f.core.internal.command.DbMigrate - Current version of schema [dbo]: 4
2025-06-01 10:15:57 [main] INFO  o.f.core.internal.command.DbMigrate - Schema [dbo] is up to date. No migration necessary.
2025-06-01 10:15:57 [main] DEBUG org.flywaydb.core.FlywayExecutor - Memory usage: 27 of 88M
2025-06-01 10:15:57 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-06-01 10:15:57 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-06-01 10:15:57 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-06-01 10:15:58 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-06-01 10:15:58 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: SQLServerDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-06-01 10:16:00 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-06-01 10:16:00 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 10:16:01 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-06-01 10:16:01 [main] WARN  o.s.b.a.s.s.UserDetailsServiceAutoConfiguration - 

Using generated security password: 09a799a0-e41d-48cc-b458-a1e9caccf81a

This generated password is for development use only. Your security configuration must be updated before running your application in production.

2025-06-01 10:16:02 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@5ed6a36a, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@200cbb63, org.springframework.security.web.context.SecurityContextHolderFilter@388ad8aa, org.springframework.security.web.header.HeaderWriterFilter@7892635c, org.springframework.web.filter.CorsFilter@35ab83a7, org.springframework.security.web.authentication.logout.LogoutFilter@35ab0bf3, com.clickhealth.pharma.security.JwtAuthFilter@7a7698f4, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@4ec78008, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@ac71bd7, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@1150b923, org.springframework.security.web.session.SessionManagementFilter@1e11d73c, org.springframework.security.web.access.ExceptionTranslationFilter@6dacde96, org.springframework.security.web.access.intercept.AuthorizationFilter@21f9764]
2025-06-01 10:16:03 [main] INFO  o.a.coyote.http11.Http11NioProtocol - Starting ProtocolHandler ["http-nio-8080"]
2025-06-01 10:16:03 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-06-01 10:16:03 [main] INFO  com.clickhealth.pharma.Application - Started Application in 11.857 seconds (process running for 12.439)
2025-06-01 10:16:12 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-06-01 10:16:12 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-06-01 10:16:12 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 5 ms
2025-06-01 10:16:14 [http-nio-8080-exec-9] INFO  o.s.api.AbstractOpenApiResource - Init duration for springdoc-openapi is: 1586 ms
2025-06-01 10:22:35 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - select ue1_0.id,ue1_0.created_at,ue1_0.created_by,ue1_0.failed_login_attempts,ue1_0.last_login_at,ue1_0.password,ue1_0.role,ue1_0.status,ue1_0.updated_at,ue1_0.updated_by,ue1_0.username from users ue1_0 where ue1_0.username=?
2025-06-01 23:36:55 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-06-01 23:36:55 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-06-01 23:36:55 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
